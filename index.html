<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>AlphaBot Pro v29 — Ultra</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --gold:#F0B90B; --gold2:#d4a009; --up:#0ecb81; --dn:#f6465d;
  --bl:#1890ff; --purple:#7c3aed; --transition:.2s ease;
}
[data-theme="dark"] {
  --bg:#0B0E13; --bg2:#111520; --bg3:#171d2e; --bg4:#1d2438;
  --bd:#232b3e; --bd2:#2d3752; --tx0:#e8ecf0; --tx1:#8b95a8; --tx2:#4a5568; --tx3:#2d3748;
  --shadow:0 8px 32px rgba(0,0,0,.5); --glow-gold:0 0 20px rgba(240,185,11,.15);
}
[data-theme="light"] {
  --bg:#f0f2f5; --bg2:#ffffff; --bg3:#f7f8fa; --bg4:#eef0f4;
  --bd:#e2e8f0; --bd2:#cbd5e0; --tx0:#1a202c; --tx1:#4a5568; --tx2:#a0aec0; --tx3:#e2e8f0;
  --shadow:0 4px 20px rgba(0,0,0,.08); --glow-gold:0 0 20px rgba(240,185,11,.1);
}
*{ margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html,body{ height:100%; background:var(--bg); color:var(--tx0); font-family:'Syne',sans-serif; overflow:hidden; }
::-webkit-scrollbar{ width:4px; height:4px; }
::-webkit-scrollbar-thumb{ background:var(--bd); border-radius:2px; }
::-webkit-scrollbar-track{ background:transparent; }

.shell{ display:flex; flex-direction:column; height:100vh; height:100dvh; }
.body-row{ display:flex; flex:1; overflow:hidden; }
.main{ flex:1; overflow-y:auto; overflow-x:hidden; background:var(--bg); }
.pad{ padding:14px; display:flex; flex-direction:column; gap:12px; }

/* TOPBAR */
.topbar{
  height:54px; min-height:54px; flex-shrink:0;
  background:var(--bg2); border-bottom:1px solid var(--bd);
  display:flex; align-items:center; padding:0 14px; gap:0; z-index:100;
}
.t-logo{ display:flex; align-items:center; gap:8px; padding-right:14px; border-right:1px solid var(--bd); margin-right:12px; flex-shrink:0; }
.t-hex{
  width:30px; height:30px; background:var(--gold);
  clip-path:polygon(50% 0%,100% 25%,100% 75%,50% 100%,0% 75%,0% 25%);
  display:flex; align-items:center; justify-content:center;
  font-size:13px; font-weight:800; color:#000;
}
.t-name{ font-family:'Rajdhani',sans-serif; font-size:19px; font-weight:700; letter-spacing:1.5px; }
.t-name span{ color:var(--gold); }
.t-ver{ font-size:8px; color:var(--tx2); font-family:'JetBrains Mono',monospace; align-self:flex-end; margin-bottom:2px; margin-left:3px; }
.t-stats{ display:flex; flex:1; overflow:hidden; gap:0; }
.tstat{ padding:0 12px; border-right:1px solid var(--bd); display:flex; flex-direction:column; justify-content:center; flex-shrink:0; }
.tstat-l{ font-size:7px; color:var(--tx2); letter-spacing:1.5px; text-transform:uppercase; }
.tstat-v{ font-family:'JetBrains Mono',monospace; font-size:12px; font-weight:600; margin-top:1px; }
.t-right{ display:flex; align-items:center; gap:8px; margin-left:auto; flex-shrink:0; }
.theme-btn{
  width:32px; height:32px; background:var(--bg3); border:1px solid var(--bd);
  border-radius:6px; cursor:pointer; display:flex; align-items:center; justify-content:center;
  font-size:15px; transition:var(--transition);
}
.theme-btn:hover{ border-color:var(--gold); }
.api-pill{
  display:flex; align-items:center; gap:5px; padding:5px 11px;
  border-radius:20px; font-size:10px; font-weight:600; cursor:pointer;
  border:1px solid; white-space:nowrap; font-family:'Rajdhani',sans-serif; letter-spacing:.5px;
  transition:var(--transition);
}
.api-on { background:rgba(14,203,129,.08); border-color:rgba(14,203,129,.3); color:var(--up); }
.api-off{ background:rgba(246,70,93,.06); border-color:rgba(246,70,93,.25); color:var(--dn); }
.apidot{ width:5px; height:5px; border-radius:50%; background:currentColor; }
.api-on .apidot{ animation:pulse-dot 2s infinite; }
@keyframes pulse-dot{ 0%,100%{opacity:1;} 50%{opacity:.3;} }
.user-chip{
  display:flex; align-items:center; gap:7px;
  background:var(--bg3); border:1px solid var(--bd); border-radius:6px;
  padding:5px 11px; cursor:pointer; transition:var(--transition);
}
.user-chip:hover{ border-color:var(--gold); }
.uav{ width:26px; height:26px; border-radius:50%; background:var(--gold); display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:700; color:#000; flex-shrink:0; }

/* HAMBURGER BUTTON */
.hamburger-btn{
  width:36px; height:36px; background:var(--bg3); border:1px solid var(--bd);
  border-radius:7px; cursor:pointer; display:flex; flex-direction:column;
  align-items:center; justify-content:center; gap:4px; transition:var(--transition);
  flex-shrink:0; margin-right:10px; position:relative; z-index:10;
}
.hamburger-btn:hover{ border-color:var(--gold); background:rgba(240,185,11,.08); }
.hb-line{ width:16px; height:2px; background:var(--tx0); border-radius:1px; transition:all .25s ease; }
.hamburger-btn.open .hb-line:nth-child(1){ transform:translateY(6px) rotate(45deg); }
.hamburger-btn.open .hb-line:nth-child(2){ opacity:0; transform:scaleX(0); }
.hamburger-btn.open .hb-line:nth-child(3){ transform:translateY(-6px) rotate(-45deg); }

/* SIDEBAR OVERLAY */
.sidebar-overlay{
  position:fixed; inset:0; background:rgba(0,0,0,.65); z-index:200;
  backdrop-filter:blur(2px); animation:fadeIn .2s ease;
}
@media(min-width:861px){ .sidebar-overlay{ display:none!important; } }

/* SIDEBAR */
.sidebar{
  width:230px; min-width:230px; flex-shrink:0;
  background:var(--bg2); border-right:1px solid var(--bd);
  display:flex; flex-direction:column; overflow-y:auto; overflow-x:hidden;
  transition:transform .28s cubic-bezier(.4,0,.2,1);
}
@media(max-width:860px){
  .sidebar{
    position:fixed; top:54px; left:0; bottom:0; z-index:210;
    transform:translateX(-110%);
    box-shadow:4px 0 30px rgba(0,0,0,.5);
    width:270px; min-width:270px;
  }
  .sidebar.open{ transform:translateX(0); }
  .hamburger-btn{ display:flex!important; }
}
@media(min-width:861px){
  .hamburger-btn{ display:none!important; }
}
.sgroup{ padding:6px 8px 0; }
.sgroup-lbl{ font-size:7px; color:var(--tx2); letter-spacing:2.5px; padding:8px 6px 3px; text-transform:uppercase; }
.sitem{
  display:flex; align-items:center; gap:9px; padding:9px 10px;
  border-radius:7px; cursor:pointer; font-size:13px; font-weight:600;
  color:var(--tx1); transition:var(--transition);
  border:1px solid transparent; margin-bottom:2px;
}
.sitem:hover{ background:var(--bg3); color:var(--tx0); }
.sitem.act{ background:rgba(240,185,11,.1); border-color:rgba(240,185,11,.18); color:var(--gold); }
.sitem-icon{ font-size:15px; width:18px; text-align:center; flex-shrink:0; }
.sitem-lbl{ white-space:nowrap; overflow:hidden; }
.sitem-badge{ margin-left:auto; font-size:8px; font-weight:700; padding:2px 6px; border-radius:10px; font-family:'JetBrains Mono',monospace; background:rgba(14,203,129,.15); color:var(--up); }
.sitem-badge.warn{ background:rgba(240,185,11,.15); color:var(--gold); }
.sidebar-context{ padding:6px; display:flex; flex-direction:column; gap:5px; }
.ctx-mini{ background:var(--bg3); border:1px solid var(--bd); border-radius:7px; padding:9px 11px; }
.ctx-mini-lbl{ font-size:7px; color:var(--tx2); letter-spacing:1.5px; text-transform:uppercase; margin-bottom:5px; }

/* SIDEBAR BOT CONTROL - LEFT ALIGNED */
.sidebar-btm{ margin-top:auto; padding:8px; border-top:1px solid var(--bd); }
.bot-box{ background:var(--bg3); border:1px solid var(--bd); border-radius:7px; padding:11px; }
.bot-txt{ font-size:7px; color:var(--tx2); letter-spacing:2px; text-transform:uppercase; margin-bottom:7px; }
.score-row{ margin-bottom:8px; }
.score-label{ display:flex; justify-content:space-between; font-size:9px; color:var(--tx2); margin-bottom:3px; }
.score-label span:last-child{ color:var(--gold); font-family:'JetBrains Mono',monospace; }
.bot-toggle{
  width:100%; padding:9px; border-radius:7px; border:none; cursor:pointer;
  font-family:'Rajdhani',sans-serif; font-size:13px; font-weight:700; letter-spacing:1px; transition:var(--transition);
}
.bt-off{ background:rgba(14,203,129,.1); border:1px solid rgba(14,203,129,.25); color:var(--up); }
.bt-off:hover{ background:var(--up); color:#000; }
.bt-on{ background:rgba(246,70,93,.1); border:1px solid var(--dn); color:var(--dn); }
.bt-on:hover{ background:var(--dn); color:#fff; }
.bot-status{ font-size:8px; color:var(--tx2); text-align:center; margin-top:5px; font-family:'JetBrains Mono',monospace; }
.bot-status.live{ color:var(--up); }
.bot-mode-row{ display:flex; justify-content:space-between; align-items:center; margin-top:7px; }
.mode-btns{ display:flex; gap:3px; }
.mbtn{
  padding:3px 9px; font-size:9px; font-family:'Rajdhani',sans-serif; font-weight:700;
  border-radius:4px; cursor:pointer; transition:var(--transition); border:1px solid var(--bd);
  background:transparent; color:var(--tx1);
}
.mbtn.act{ background:var(--gold); border-color:var(--gold); color:#000; }

/* API SECTION - visible in sidebar */
.api-sidebar{
  background:var(--bg3); border:1px solid var(--bd); border-radius:7px;
  padding:10px; margin:6px 8px;
}
.api-sidebar-title{ font-size:7px; color:var(--tx2); letter-spacing:2px; text-transform:uppercase; margin-bottom:8px; }
.api-sidebar-status{
  display:flex; align-items:center; gap:6px; padding:7px 9px;
  border-radius:6px; margin-bottom:8px; font-size:10px; font-weight:700; border:1px solid;
}
.api-sb-on{ background:rgba(14,203,129,.08); border-color:rgba(14,203,129,.25); color:var(--up); }
.api-sb-off{ background:rgba(246,70,93,.05); border-color:rgba(246,70,93,.2); color:var(--dn); }
.api-sb-bal{ font-size:11px; font-weight:700; color:var(--gold); font-family:'JetBrains Mono',monospace; margin-top:3px; }

/* CONTEXT BAR */
.ctx-bar{ display:grid; grid-template-columns:repeat(4,1fr); gap:1px; background:var(--bd); border-radius:8px; overflow:hidden; border:1px solid var(--bd); }
.cbi{ background:var(--bg2); padding:11px 13px; }
.cbi-l{ font-size:7px; color:var(--tx2); letter-spacing:1.5px; text-transform:uppercase; margin-bottom:3px; }
.cbi-v{ font-family:'JetBrains Mono',monospace; font-size:15px; font-weight:700; }
.cbi-s{ font-size:9px; color:var(--tx2); margin-top:2px; }
@media(max-width:480px){ .ctx-bar{ grid-template-columns:repeat(2,1fr); } }

/* SECTION HEADERS */
.sec-head{ display:flex; align-items:center; justify-content:space-between; margin-bottom:9px; }
.sec-title{ font-family:'Rajdhani',sans-serif; font-size:13px; font-weight:700; letter-spacing:1.5px; display:flex; align-items:center; gap:7px; color:var(--tx1); text-transform:uppercase; }
.sec-dot{ width:5px; height:5px; border-radius:50%; }
.sec-badge{ padding:2px 8px; border-radius:4px; font-size:9px; font-weight:700; font-family:'JetBrains Mono',monospace; }

/* SIGNAL CARDS */
.setups-grid{ display:grid; gap:10px; grid-template-columns:repeat(4,1fr); }
@media(max-width:1100px){ .setups-grid{ grid-template-columns:repeat(2,1fr); } }
@media(max-width:480px){ .setups-grid{ grid-template-columns:1fr; } }
.sc{
  background:var(--bg2); border:1px solid var(--bd); border-radius:10px;
  overflow:hidden; cursor:pointer; transition:border-color .2s,box-shadow .2s;
  display:flex; flex-direction:column;
}
.sc:hover{ border-color:var(--gold); box-shadow:var(--glow-gold); }
.sc.long{ border-top:3px solid var(--up); }
.sc.short{ border-top:3px solid var(--dn); }
.sc.empty{
  border:1px dashed var(--bd); min-height:200px;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:6px; color:var(--tx2); font-size:11px;
}
.sc-top{ padding:9px 11px 5px; display:flex; justify-content:space-between; align-items:center; }
.sc-pair{ font-family:'JetBrains Mono',monospace; font-size:14px; font-weight:700; }
.sc-pair small{ color:var(--tx2); font-size:10px; font-weight:400; }
.sc-side{ padding:2px 7px; border-radius:4px; font-size:9px; font-weight:700; letter-spacing:1px; font-family:'Rajdhani',sans-serif; }
.sl{ background:rgba(14,203,129,.15); color:var(--up); }
.ss{ background:rgba(246,70,93,.15); color:var(--dn); }
.sc-px{ padding:2px 11px 7px; font-family:'JetBrains Mono',monospace; }
.sc-px-val{ font-size:17px; font-weight:700; }
.sc-px-chg{ font-size:10px; margin-left:6px; }
.sc-score{ margin:0 11px 7px; background:var(--bg3); border-radius:5px; padding:6px 9px; display:flex; align-items:center; gap:8px; }
.sc-sn{ font-family:'JetBrains Mono',monospace; font-size:18px; font-weight:700; }
.sc-sbar{ flex:1; height:3px; background:var(--bg); border-radius:2px; overflow:hidden; }
.sc-sfill{ height:100%; border-radius:2px; transition:width .5s; }
.sc-rows{ padding:0 11px 7px; }
.sc-r{ display:flex; justify-content:space-between; font-size:10px; margin-bottom:4px; color:var(--tx1); }
.sc-r .v{ font-family:'JetBrains Mono',monospace; color:var(--tx0); }
.sc-proof{ display:grid; grid-template-columns:repeat(5,1fr); gap:3px; padding:0 11px 7px; }
.sp{ display:flex; flex-direction:column; align-items:center; gap:2px; }
.sp-dot{ width:22px; height:22px; border-radius:5px; display:flex; align-items:center; justify-content:center; font-size:8px; font-weight:700; font-family:'Rajdhani',sans-serif; }
.sp-on{ background:rgba(14,203,129,.12); color:var(--up); border:1px solid rgba(14,203,129,.25); }
.sp-off{ background:var(--bg3); color:var(--tx2); border:1px solid var(--bd); }
.sp-lbl{ font-size:7px; color:var(--tx2); }
.sc-foot{
  padding:7px 11px; border-top:1px solid var(--bd); background:var(--bg3);
  display:flex; justify-content:space-between; align-items:center; margin-top:auto;
}
.sc-timer{ font-family:'JetBrains Mono',monospace; font-size:9px; color:var(--gold); }
.exec-btn{
  padding:5px 10px; border-radius:5px; border:none; cursor:pointer;
  font-family:'Rajdhani',sans-serif; font-size:10px; font-weight:700; letter-spacing:.5px;
  transition:var(--transition);
}
.exec-live{ background:rgba(14,203,129,.15); border:1px solid rgba(14,203,129,.3); color:var(--up); }
.exec-live:hover{ background:var(--up); color:#000; }
.exec-demo{ background:rgba(240,185,11,.1); border:1px solid rgba(240,185,11,.2); color:var(--gold); }
.chart-btn{ font-size:10px; padding:4px 8px; background:transparent; border:1px solid var(--bd); border-radius:4px; color:var(--tx1); cursor:pointer; font-family:'Rajdhani',sans-serif; font-weight:600; transition:var(--transition); }
.chart-btn:hover{ border-color:var(--gold); color:var(--gold); }

/* POSITIONS - ENHANCED */
.pos-grid{ display:grid; gap:10px; grid-template-columns:repeat(3,1fr); }
@media(max-width:900px){ .pos-grid{ grid-template-columns:repeat(1,1fr); } }
@media(min-width:901px) and (max-width:1200px){ .pos-grid{ grid-template-columns:repeat(2,1fr); } }
.pc{ background:var(--bg2); border:1px solid var(--bd); border-radius:10px; overflow:hidden; }
.pc.plong{ border-left:3px solid var(--up); }
.pc.pshort{ border-left:3px solid var(--dn); }
.pc-head{ background:var(--bg3); padding:9px 13px; display:flex; justify-content:space-between; align-items:center; }
.pc-pair{ font-family:'JetBrains Mono',monospace; font-size:13px; font-weight:700; }
.pc-pnl{ font-family:'JetBrains Mono',monospace; font-size:15px; font-weight:700; }
.pc-body{ padding:11px 13px; }
.pr{ display:flex; justify-content:space-between; font-size:10px; margin-bottom:5px; }
.pr .l{ color:var(--tx1); }
.pr .r{ font-family:'JetBrains Mono',monospace; }
/* Liquidation price row - important */
.pr-liq .r{ color:var(--dn); font-weight:700; }
.pr-be .r{ color:var(--gold); font-weight:700; }
.rr-bar{ margin-top:8px; }
.rr-lbl{ font-size:8px; color:var(--tx2); margin-bottom:3px; }
.rr-track{ display:flex; gap:2px; }
.rrs{ flex:1; height:4px; border-radius:2px; background:var(--bg); transition:background .4s; }
.rrs.done{ background:var(--up); }
.rrs.be{ background:var(--gold); }
/* Fees badge */
.fees-notice{ background:rgba(246,70,93,.06); border:1px solid rgba(246,70,93,.15); border-radius:5px; padding:5px 8px; margin-top:6px; font-size:9px; color:var(--tx1); }
.fees-notice b{ color:var(--dn); }
.pc-foot{ padding:7px 13px; border-top:1px solid var(--bd); display:flex; gap:5px; flex-wrap:wrap; align-items:center; }
.ptag{ font-size:8px; padding:2px 7px; border-radius:4px; font-family:'Rajdhani',sans-serif; font-weight:700; }
.pt-trail{ background:rgba(14,203,129,.1); color:var(--up); border:1px solid rgba(14,203,129,.2); }
.pt-demo{ background:rgba(240,185,11,.1); color:var(--gold); border:1px solid rgba(240,185,11,.2); }
.pt-real{ background:rgba(24,144,255,.1); color:var(--bl); border:1px solid rgba(24,144,255,.2); }

/* LOG */
.log-wrap{ background:var(--bg2); border:1px solid var(--bd); border-radius:10px; overflow:hidden; }
.log-hd{ padding:9px 13px; border-bottom:1px solid var(--bd); background:var(--bg3); display:flex; justify-content:space-between; align-items:center; }
.log-hd-t{ font-family:'Rajdhani',sans-serif; font-size:11px; font-weight:700; letter-spacing:1.5px; color:var(--tx1); text-transform:uppercase; }
.log-body{ height:130px; overflow-y:auto; padding:7px 11px; font-family:'JetBrains Mono',monospace; font-size:9px; }
.ll{ padding:2px 0; border-bottom:1px solid rgba(255,255,255,.025); line-height:1.5; }
[data-theme="light"] .ll{ border-bottom-color:rgba(0,0,0,.04); }
.lup{ color:var(--up); } .ldn{ color:var(--dn); } .linf{ color:var(--bl); } .lwrn{ color:var(--gold); } .lmut{ color:var(--tx2); }

/* SCANNER */
.scan-wrap{ background:var(--bg2); border:1px solid var(--bd); border-radius:10px; overflow:hidden; }
.scan-table{ width:100%; border-collapse:collapse; font-size:11px; }
.scan-th{ padding:9px 13px; text-align:left; font-size:7px; color:var(--tx2); letter-spacing:1.5px; font-weight:700; text-transform:uppercase; background:var(--bg3); border-bottom:1px solid var(--bd); white-space:nowrap; }
.scan-tr{ border-bottom:1px solid rgba(35,43,62,.4); transition:background .1s; }
.scan-tr:hover{ background:var(--bg3); }
.scan-td{ padding:9px 13px; white-space:nowrap; }

/* HISTORY */
.hist-row{ display:flex; align-items:center; gap:10px; padding:10px 15px; border-bottom:1px solid var(--bd); flex-wrap:wrap; }
.hist-pnl{ font-family:'JetBrains Mono',monospace; font-size:13px; font-weight:700; margin-left:auto; }

/* ACCOUNT */
.acc-grid{ display:grid; gap:12px; grid-template-columns:1fr 1fr; }
@media(max-width:640px){ .acc-grid{ grid-template-columns:1fr; } }
.acc-card{ background:var(--bg2); border:1px solid var(--bd); border-radius:10px; overflow:hidden; }
.acc-hd{ padding:10px 14px; border-bottom:1px solid var(--bd); background:var(--bg3); font-family:'Rajdhani',sans-serif; font-size:11px; font-weight:700; letter-spacing:1.5px; color:var(--tx1); text-transform:uppercase; display:flex; justify-content:space-between; align-items:center; }
.acc-body{ padding:14px; }
.acc-av{ width:54px; height:54px; border-radius:50%; background:var(--gold); display:flex; align-items:center; justify-content:center; font-size:22px; font-weight:800; color:#000; margin:0 auto 12px; }
.arow{ display:flex; justify-content:space-between; padding:7px 0; border-bottom:1px solid var(--bd); font-size:11px; }
.arow:last-child{ border-bottom:none; }
.arow .l{ color:var(--tx1); }
.arow .r{ font-family:'JetBrains Mono',monospace; color:var(--gold); }
.ref-box{ background:var(--bg3); border:1px solid var(--bd); border-radius:8px; padding:14px; margin-bottom:12px; }
.ref-code-display{ font-family:'JetBrains Mono',monospace; font-size:24px; font-weight:700; color:var(--gold); letter-spacing:6px; text-align:center; padding:10px; background:var(--bg); border-radius:6px; margin:8px 0; cursor:pointer; border:1px solid rgba(240,185,11,.2); transition:var(--transition); }
.ref-code-display:hover{ border-color:var(--gold); }
.ref-link{ font-family:'JetBrains Mono',monospace; font-size:9px; color:var(--tx2); text-align:center; word-break:break-all; background:var(--bg); border-radius:5px; padding:7px; margin-top:6px; cursor:pointer; border:1px solid var(--bd); transition:var(--transition); }
.ref-link:hover{ color:var(--gold); border-color:var(--gold); }
.ref-stats{ display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:10px; }
.ref-stat{ background:var(--bg); border:1px solid var(--bd); border-radius:6px; padding:9px; text-align:center; }
.ref-stat-v{ font-family:'JetBrains Mono',monospace; font-size:18px; font-weight:700; color:var(--gold); }
.ref-stat-l{ font-size:9px; color:var(--tx2); margin-top:2px; }
.feat-g{ display:grid; grid-template-columns:repeat(3,1fr); gap:7px; }
@media(max-width:480px){ .feat-g{ grid-template-columns:repeat(2,1fr); } }
.feat-i{ background:var(--bg3); border:1px solid var(--bd); border-radius:7px; padding:10px; text-align:center; }
.feat-i.coming{ opacity:.5; position:relative; }
.feat-i.coming::after{ content:'SOON'; position:absolute; top:5px; right:5px; font-size:6px; font-weight:700; letter-spacing:1px; color:var(--gold); font-family:'Rajdhani',sans-serif; }
.fi-icon{ font-size:18px; margin-bottom:5px; }
.fi-nm{ font-size:11px; font-weight:700; }
.fi-ds{ font-size:9px; color:var(--tx2); margin-top:2px; }

/* ADMIN */
.adm-stats{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:16px; }
.adm-stat{ background:var(--bg3); border:1px solid var(--bd); border-radius:8px; padding:12px; text-align:center; }
.adm-stat-v{ font-family:'JetBrains Mono',monospace; font-size:22px; font-weight:700; color:var(--gold); }
.adm-stat-l{ font-size:9px; color:var(--tx2); margin-top:3px; text-transform:uppercase; letter-spacing:1px; }
.adm-row{ display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid var(--bd); font-size:11px; }
.adm-row .r{ font-family:'JetBrains Mono',monospace; color:var(--gold); }
.risk-presets{ display:grid; grid-template-columns:repeat(3,1fr); gap:6px; margin:8px 0; }
.risk-btn{ padding:8px; text-align:center; border-radius:6px; border:1px solid var(--bd); cursor:pointer; background:transparent; color:var(--tx1); font-family:'Rajdhani',sans-serif; font-weight:700; font-size:12px; transition:var(--transition); }
.risk-btn.act{ background:rgba(240,185,11,.15); border-color:var(--gold); color:var(--gold); }
.risk-btn:hover{ border-color:var(--gold); }
/* BALANCE QUICK MODAL */
.bal-modal{
  position:fixed; top:60px; right:14px; z-index:300;
  background:var(--bg2); border:1px solid var(--bd); border-radius:12px;
  padding:18px; width:260px; box-shadow:0 12px 40px rgba(0,0,0,.5);
  animation:scaleIn .2s cubic-bezier(.34,1.56,.64,1);
}
.bal-modal-title{ font-family:'Rajdhani',sans-serif; font-weight:700; font-size:13px; letter-spacing:1px; color:var(--tx1); margin-bottom:12px; }
/* PDF DOWNLOAD CARD */
.pdf-card{ background:linear-gradient(135deg,rgba(246,70,93,.08),rgba(240,185,11,.06)); border:1px solid rgba(246,70,93,.25); border-radius:10px; padding:16px; display:flex; gap:14px; align-items:center; cursor:pointer; transition:var(--transition); }
.pdf-card:hover{ border-color:var(--gold); transform:translateY(-1px); }
.pdf-icon{ font-size:36px; flex-shrink:0; }
.pdf-info .title{ font-family:'Rajdhani',sans-serif; font-weight:700; font-size:14px; letter-spacing:.5px; margin-bottom:3px; }
.pdf-info .sub{ font-size:10px; color:var(--tx2); line-height:1.5; }
.pdf-btn{ padding:8px 16px; background:var(--gold); border:none; border-radius:6px; color:#000; font-family:'Rajdhani',sans-serif; font-weight:700; font-size:12px; cursor:pointer; transition:var(--transition); white-space:nowrap; }
.pdf-btn:hover{ background:var(--gold2); }
/* TRADE CONFIRM MODAL */
.trade-confirm-modal{ max-width:420px; border-radius:14px; overflow:hidden; }
.tc-header{ padding:18px 20px; display:flex; align-items:center; gap:12px; }
.tc-header-long{ background:linear-gradient(135deg,rgba(14,203,129,.15),rgba(14,203,129,.06)); border-bottom:1px solid rgba(14,203,129,.2); }
.tc-header-short{ background:linear-gradient(135deg,rgba(246,70,93,.12),rgba(246,70,93,.06)); border-bottom:1px solid rgba(246,70,93,.2); }
.tc-badge{ font-family:'Rajdhani',sans-serif; font-size:11px; font-weight:800; padding:3px 9px; border-radius:4px; letter-spacing:1px; }
.tc-pair{ font-family:'JetBrains Mono',monospace; font-size:18px; font-weight:700; }
.tc-row{ display:flex; justify-content:space-between; align-items:center; padding:8px 20px; border-bottom:1px solid var(--bd); font-size:11px; }
.tc-row .lbl{ color:var(--tx2); }
.tc-row .val{ font-family:'JetBrains Mono',monospace; font-weight:700; font-size:12px; }
.tc-disclaimer{ margin:12px 20px; background:rgba(240,185,11,.06); border:1px solid rgba(240,185,11,.2); border-radius:8px; padding:11px 13px; font-size:9px; color:var(--tx1); line-height:1.7; }
.tc-btns{ padding:14px 20px; display:flex; gap:10px; }
.tc-cancel{ flex:1; padding:12px; border-radius:8px; border:1px solid var(--bd); background:transparent; color:var(--tx1); font-family:'Rajdhani',sans-serif; font-weight:700; font-size:13px; cursor:pointer; transition:var(--transition); }
.tc-cancel:hover{ border-color:var(--dn); color:var(--dn); }
.tc-confirm-long{ flex:2; padding:12px; border-radius:8px; border:none; background:var(--up); color:#000; font-family:'Rajdhani',sans-serif; font-weight:800; font-size:13px; cursor:pointer; letter-spacing:.5px; }
.tc-confirm-short{ flex:2; padding:12px; border-radius:8px; border:none; background:var(--dn); color:#fff; font-family:'Rajdhani',sans-serif; font-weight:800; font-size:13px; cursor:pointer; letter-spacing:.5px; }
.mode-switch-pill{
  display:flex; align-items:center; gap:3px;
  background:var(--bg3); border:1px solid var(--bd); border-radius:20px;
  padding:3px; flex-shrink:0;
}
.msw-btn{
  padding:4px 12px; border-radius:16px; border:none; cursor:pointer;
  font-family:'Rajdhani',sans-serif; font-size:10px; font-weight:700;
  letter-spacing:.5px; transition:var(--transition); background:transparent; color:var(--tx1);
}
.msw-demo.act{ background:var(--gold); color:#000; }
.msw-real.act{ background:var(--up); color:#000; }

/* AUTH */
.auth-bg{
  position:fixed; inset:0; background:var(--bg); z-index:999;
  display:flex; align-items:center; justify-content:center; padding:14px;
}
.auth-split{ display:flex; width:100%; max-width:880px; height:min(580px,90vh); border-radius:14px; overflow:hidden; border:1px solid var(--bd); box-shadow:var(--shadow); }
.auth-left{
  flex:1; background:linear-gradient(135deg,#0B0E13 0%,#171d2e 100%);
  padding:40px; display:flex; flex-direction:column; justify-content:center;
  border-right:1px solid var(--bd);
}
@media(max-width:680px){ .auth-left{ display:none; } }
.auth-left-logo{ font-family:'Rajdhani',sans-serif; font-size:32px; font-weight:700; letter-spacing:2px; margin-bottom:8px; }
.auth-left-logo span{ color:var(--gold); }
.auth-left-sub{ font-size:13px; color:var(--tx1); margin-bottom:30px; line-height:1.6; }
.auth-feat{ display:flex; flex-direction:column; gap:10px; }
.auth-feat-item{ display:flex; align-items:center; gap:10px; font-size:12px; color:var(--tx1); }
.af-icon{ width:28px; height:28px; border-radius:6px; background:rgba(240,185,11,.1); border:1px solid rgba(240,185,11,.2); display:flex; align-items:center; justify-content:center; font-size:14px; flex-shrink:0; }
.auth-count{ display:flex; align-items:center; gap:8px; margin-top:25px; font-size:11px; color:var(--tx1); }
.auth-count b{ color:var(--gold); font-family:'JetBrains Mono',monospace; }
.ldot{ width:7px; height:7px; border-radius:50%; background:var(--up); animation:pulse-dot 2s infinite; }
.auth-right{ width:380px; flex-shrink:0; background:var(--bg2); padding:32px 28px; display:flex; flex-direction:column; overflow-y:auto; }
@media(max-width:680px){ .auth-right{ width:100%; border-radius:14px; } }
.auth-right-title{ font-family:'Rajdhani',sans-serif; font-size:22px; font-weight:700; letter-spacing:1px; margin-bottom:6px; }
.auth-right-sub{ font-size:11px; color:var(--tx2); margin-bottom:22px; }
.atabs{ display:flex; border:1px solid var(--bd); border-radius:7px; overflow:hidden; margin-bottom:18px; }
.atab{ flex:1; padding:9px; text-align:center; background:transparent; border:none; cursor:pointer; font-family:'Rajdhani',sans-serif; font-size:13px; font-weight:700; color:var(--tx1); letter-spacing:.5px; transition:var(--transition); }
.atab.act{ background:var(--gold); color:#000; }
.fld{ margin-bottom:13px; }
.flbl{ font-size:7px; color:var(--tx2); letter-spacing:1.5px; text-transform:uppercase; margin-bottom:5px; }
.inp{
  width:100%; background:var(--bg3); border:1px solid var(--bd); color:var(--tx0);
  padding:10px 12px; border-radius:6px; font-family:'JetBrains Mono',monospace; font-size:12px;
  outline:none; transition:border-color .15s;
}
.inp:focus{ border-color:var(--gold); }
.inp::placeholder{ color:var(--tx2); }
.err-box{ background:rgba(246,70,93,.07); border:1px solid rgba(246,70,93,.25); border-radius:6px; padding:9px 12px; font-size:11px; color:var(--dn); margin-bottom:13px; }
.ok-box{ background:rgba(14,203,129,.07); border:1px solid rgba(14,203,129,.25); border-radius:6px; padding:9px 12px; font-size:11px; color:var(--up); margin-bottom:13px; }
.hint{ font-size:9px; color:var(--tx2); margin-top:4px; line-height:1.5; }
.btn{ padding:10px 16px; border-radius:6px; border:none; cursor:pointer; font-family:'Rajdhani',sans-serif; font-size:13px; font-weight:700; letter-spacing:.5px; transition:var(--transition); }
.btn-gold{ background:var(--gold); color:#000; }
.btn-gold:hover{ background:var(--gold2); }
.btn-out{ background:transparent; border:1px solid var(--bd); color:var(--tx0); }
.btn-out:hover{ border-color:var(--gold); color:var(--gold); }
.btn-dn{ background:rgba(246,70,93,.1); border:1px solid rgba(246,70,93,.25); color:var(--dn); }
.btn-dn:hover{ background:var(--dn); color:#fff; }
.btn-up{ background:rgba(14,203,129,.1); border:1px solid rgba(14,203,129,.3); color:var(--up); }
.btn-up:hover{ background:var(--up); color:#000; }
.btn-sm{ padding:5px 10px; font-size:10px; }
.btn-full{ width:100%; }
.btn:disabled{ opacity:.5; cursor:not-allowed; }
.txt-btn{ background:none; border:none; cursor:pointer; color:var(--gold); font-size:11px; font-family:'Syne',sans-serif; font-weight:600; text-decoration:underline; }
.vcode-row{ display:flex; gap:6px; justify-content:center; margin:12px 0; }
.vcode-digit{ width:38px; height:46px; background:var(--bg3); border:1px solid var(--bd); border-radius:7px; text-align:center; font-family:'JetBrains Mono',monospace; font-size:20px; font-weight:700; color:var(--tx0); outline:none; }
.vcode-digit:focus{ border-color:var(--gold); }
.sim-notice{
  background:rgba(240,185,11,.07); border:1px solid rgba(240,185,11,.2);
  border-radius:7px; padding:11px 13px; margin:10px 0;
  font-size:10px; color:var(--gold); line-height:1.6;
}
.sim-notice b{ display:block; margin-bottom:3px; }

/* MODALS */
.modal-bg{ position:fixed; inset:0; background:rgba(0,0,0,.75); z-index:500; display:flex; align-items:center; justify-content:center; padding:12px; backdrop-filter:blur(6px); }
.modal-box{ background:var(--bg2); border:1px solid var(--bd); border-radius:12px; width:100%; max-width:480px; max-height:90vh; overflow-y:auto; box-shadow:var(--shadow); }
.modal-hd{ padding:13px 17px; border-bottom:1px solid var(--bd); background:var(--bg3); display:flex; justify-content:space-between; align-items:center; border-radius:12px 12px 0 0; }
.modal-title{ font-family:'Rajdhani',sans-serif; font-size:15px; font-weight:700; letter-spacing:1px; }
.modal-body{ padding:18px; }
.msec{ background:var(--bg3); border:1px solid var(--bd); border-radius:8px; padding:14px; margin-bottom:13px; }
.msec-t{ font-size:7px; color:var(--tx2); letter-spacing:2px; text-transform:uppercase; margin-bottom:11px; }
.api-res{ margin-top:11px; padding:10px 12px; border-radius:6px; font-family:'JetBrains Mono',monospace; font-size:10px; }
.ar-ok{ background:rgba(14,203,129,.07); color:var(--up); border:1px solid rgba(14,203,129,.2); }
.ar-err{ background:rgba(246,70,93,.07); color:var(--dn); border:1px solid rgba(246,70,93,.2); }
.disc-modal{ max-width:500px; }
.disc-header{ text-align:center; padding:20px; border-bottom:1px solid var(--bd); background:rgba(246,70,93,.04); }
.disc-icon{ font-size:36px; margin-bottom:8px; }
.disc-title{ font-family:'Rajdhani',sans-serif; font-size:18px; font-weight:700; color:var(--dn); }
.disc-body{ padding:18px; }
.disc-points{ list-style:none; display:flex; flex-direction:column; gap:8px; margin:14px 0; }
.disc-points li{ display:flex; gap:9px; align-items:flex-start; font-size:11px; color:var(--tx1); line-height:1.6; }
.disc-points li::before{ content:'⚠'; color:var(--gold); flex-shrink:0; }
.disc-check{ display:flex; align-items:center; gap:9px; font-size:11px; color:var(--tx1); margin:16px 0; cursor:pointer; }
.disc-check input{ accent-color:var(--gold); width:15px; height:15px; cursor:pointer; }
.chart-modal{ width:95vw; height:88vh; background:var(--bg2); border:1px solid var(--bd); border-radius:12px; display:flex; flex-direction:column; overflow:hidden; }
.chart-hd{ padding:11px 15px; background:var(--bg3); border-bottom:1px solid var(--bd); display:flex; align-items:center; justify-content:space-between; flex-shrink:0; }
.chart-title{ font-family:'Rajdhani',sans-serif; font-size:17px; font-weight:700; letter-spacing:1.5px; color:var(--gold); }
.chart-tfs{ display:flex; gap:4px; }
.tft{ padding:4px 10px; border-radius:4px; background:transparent; border:1px solid var(--bd); color:var(--tx1); font-family:'JetBrains Mono',monospace; font-size:10px; cursor:pointer; transition:var(--transition); }
.tft.act,.tft:hover{ background:var(--gold); border-color:var(--gold); color:#000; }
.chart-iframe{ flex:1; border:none; width:100%; }
.xbtn{ width:30px; height:30px; background:var(--bg3); border:1px solid var(--bd); border-radius:5px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:13px; color:var(--tx1); flex-shrink:0; transition:var(--transition); }
.xbtn:hover{ background:var(--dn); color:#fff; border-color:var(--dn); }

/* BOT CONTROL CARD */
.ctrl-card{
  background:var(--bg2); border:1px solid var(--bd); border-radius:12px;
  padding:18px; display:flex; flex-direction:column;
}
.ctrl-card-title{
  font-family:'Rajdhani',sans-serif; font-size:11px; font-weight:700;
  letter-spacing:1.5px; text-transform:uppercase; color:var(--tx1);
  margin-bottom:14px;
}
.ctrl-mode-row{ display:flex; gap:8px; margin-bottom:14px; }
.ctrl-mode-btn{
  flex:1; padding:10px; border-radius:8px; border:1px solid var(--bd);
  background:var(--bg3); color:var(--tx1); cursor:pointer;
  font-family:'Rajdhani',sans-serif; font-size:13px; font-weight:700;
  letter-spacing:.5px; transition:var(--transition); text-align:center;
}
.ctrl-mode-btn.act{ background:rgba(240,185,11,.12); border-color:var(--gold); color:var(--gold); }
.ctrl-big-btn{
  width:100%; padding:18px 12px; border-radius:10px; border:none; cursor:pointer;
  font-family:'Rajdhani',sans-serif; font-size:16px; font-weight:800; letter-spacing:1px;
  transition:var(--transition); display:flex; align-items:center; justify-content:center;
  gap:10px; margin-bottom:10px;
}
.ctrl-start{
  background:linear-gradient(135deg,rgba(14,203,129,.15),rgba(14,203,129,.25));
  border:2px solid rgba(14,203,129,.4); color:var(--up);
  box-shadow:0 0 24px rgba(14,203,129,.08);
}
.ctrl-start:hover{ background:var(--up); color:#000; box-shadow:0 0 30px rgba(14,203,129,.3); }
.ctrl-stop{
  background:linear-gradient(135deg,rgba(246,70,93,.12),rgba(246,70,93,.2));
  border:2px solid rgba(246,70,93,.4); color:var(--dn);
  animation:pulse-stop 2s ease-in-out infinite;
}
.ctrl-stop:hover{ background:var(--dn); color:#fff; }
@keyframes pulse-stop{ 0%,100%{box-shadow:0 0 0 rgba(246,70,93,.2);} 50%{box-shadow:0 0 20px rgba(246,70,93,.25);} }
.ctrl-status{
  text-align:center; font-size:10px; color:var(--tx2);
  font-family:'JetBrains Mono',monospace; padding:6px 10px;
  background:var(--bg3); border-radius:6px; border:1px solid var(--bd);
}
.ctrl-status.live{ color:var(--up); border-color:rgba(14,203,129,.2); background:rgba(14,203,129,.05); }
.api-status-badge{
  display:flex; align-items:center; gap:12px; padding:12px 14px;
  border-radius:8px; margin-bottom:14px; border:1px solid;
}
.api-badge-on{ background:rgba(14,203,129,.07); border-color:rgba(14,203,129,.25); color:var(--up); }
.api-badge-off{ background:rgba(246,70,93,.05); border-color:rgba(246,70,93,.2); color:var(--dn); }

/* ACCOUNT BALANCE CARD - NEW */
.balance-card{
  background:linear-gradient(135deg,rgba(240,185,11,.08),rgba(14,203,129,.05));
  border:1px solid rgba(240,185,11,.2); border-radius:10px; padding:16px;
  display:flex; flex-direction:column; gap:8px;
}
.balance-card-title{ font-family:'Rajdhani',sans-serif; font-size:10px; font-weight:700; letter-spacing:2px; text-transform:uppercase; color:var(--tx2); }
.balance-card-val{ font-family:'JetBrains Mono',monospace; font-size:28px; font-weight:700; color:var(--gold); }
.balance-card-sub{ font-size:10px; color:var(--tx1); }
.balance-margin-row{ display:flex; gap:10px; }
.balance-mini{ flex:1; background:var(--bg3); border:1px solid var(--bd); border-radius:6px; padding:8px; text-align:center; }
.balance-mini-val{ font-family:'JetBrains Mono',monospace; font-size:13px; font-weight:700; }
.balance-mini-lbl{ font-size:8px; color:var(--tx2); margin-top:2px; }

/* SESSION CARD */
.session-warning{
  background:rgba(246,70,93,.06); border:1px solid rgba(246,70,93,.2);
  border-radius:8px; padding:10px 13px;
  display:flex; align-items:center; gap:10px; font-size:11px; color:var(--dn);
}
.session-safe{
  background:rgba(14,203,129,.06); border:1px solid rgba(14,203,129,.2);
  border-radius:8px; padding:10px 13px;
  display:flex; align-items:center; gap:10px; font-size:11px; color:var(--up);
}

/* NEWS / FONDAMENTAUX */
.news-card{ background:var(--bg2); border:1px solid var(--bd); border-radius:10px; overflow:hidden; }
.news-hd{ padding:10px 14px; background:var(--bg3); border-bottom:1px solid var(--bd); display:flex; justify-content:space-between; align-items:center; }
.news-item{ padding:10px 14px; border-bottom:1px solid var(--bd); display:flex; gap:10px; align-items:flex-start; cursor:pointer; transition:background .1s; }
.news-item:hover{ background:var(--bg3); }
.news-item:last-child{ border-bottom:none; }
.news-dot{ width:8px; height:8px; border-radius:50%; flex-shrink:0; margin-top:4px; }
.news-bull{ background:var(--up); }
.news-bear{ background:var(--dn); }
.news-neutral{ background:var(--gold); }
.news-title{ font-size:11px; font-weight:600; line-height:1.4; }
.news-meta{ font-size:9px; color:var(--tx2); margin-top:3px; }
.news-impact{ padding:2px 6px; border-radius:3px; font-size:8px; font-weight:700; font-family:'Rajdhani',sans-serif; }
.ni-high{ background:rgba(246,70,93,.1); color:var(--dn); border:1px solid rgba(246,70,93,.2); }
.ni-med{ background:rgba(240,185,11,.1); color:var(--gold); border:1px solid rgba(240,185,11,.2); }
.ni-low{ background:rgba(14,203,129,.1); color:var(--up); border:1px solid rgba(14,203,129,.2); }

/* CANAL / COMMUNITY */
.canal-card{ background:linear-gradient(135deg,rgba(124,58,237,.1),rgba(240,185,11,.06)); border:1px solid rgba(124,58,237,.25); border-radius:10px; padding:18px; }
.canal-title{ font-family:'Rajdhani',sans-serif; font-size:16px; font-weight:700; letter-spacing:1px; margin-bottom:6px; }
.canal-title span{ color:var(--purple); }
.canal-desc{ font-size:11px; color:var(--tx1); line-height:1.7; margin-bottom:14px; }
.canal-links{ display:flex; flex-direction:column; gap:8px; }
.canal-link{
  display:flex; align-items:center; gap:12px; padding:12px 14px;
  border-radius:8px; border:1px solid; cursor:pointer; transition:var(--transition);
  text-decoration:none; color:inherit;
}
.canal-tg{ background:rgba(0,136,204,.08); border-color:rgba(0,136,204,.25); }
.canal-tg:hover{ background:rgba(0,136,204,.15); border-color:rgba(0,136,204,.5); }
.canal-yt{ background:rgba(255,0,0,.08); border-color:rgba(255,0,0,.2); }
.canal-yt:hover{ background:rgba(255,0,0,.15); border-color:rgba(255,0,0,.4); }
.canal-tt{ background:rgba(255,255,255,.04); border-color:rgba(255,255,255,.1); }
.canal-tt:hover{ background:rgba(255,255,255,.08); border-color:rgba(255,255,255,.2); }
.canal-link-icon{ font-size:22px; }
.canal-link-info .title{ font-size:13px; font-weight:700; font-family:'Rajdhani',sans-serif; letter-spacing:.5px; }
.canal-link-info .sub{ font-size:10px; color:var(--tx2); margin-top:2px; }
.canal-link-arrow{ margin-left:auto; color:var(--tx2); font-size:16px; }

/* TIKTOK CHALLENGE BANNER */
.tiktok-banner{
  background:linear-gradient(90deg,rgba(255,0,80,.08),rgba(0,242,234,.06),rgba(255,0,80,.08));
  border:1px solid rgba(255,0,80,.2); border-radius:10px; padding:14px 18px;
  display:flex; align-items:center; gap:14px;
}
.tt-icon{ font-size:32px; }
.tt-text .title{ font-family:'Rajdhani',sans-serif; font-size:15px; font-weight:700; letter-spacing:1px; }
.tt-text .title span{ color:#ff0050; }
.tt-text .sub{ font-size:10px; color:var(--tx1); margin-top:3px; line-height:1.5; }
.tt-btn{ margin-left:auto; padding:10px 18px; background:linear-gradient(135deg,#ff0050,#00f2ea); border:none; border-radius:8px; color:#fff; font-family:'Rajdhani',sans-serif; font-size:13px; font-weight:700; cursor:pointer; white-space:nowrap; transition:opacity .2s; }
.tt-btn:hover{ opacity:.85; }

/* SOON BANNER */
.soon-banner{
  background:linear-gradient(90deg,rgba(124,58,237,.15),rgba(240,185,11,.1),rgba(124,58,237,.15));
  border:1px solid rgba(124,58,237,.3); border-radius:8px; padding:11px 16px;
  display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
}
.soon-text{ font-size:11px; color:var(--tx1); }
.soon-text b{ color:var(--gold); }
.soon-badge{ padding:3px 9px; border-radius:20px; background:rgba(124,58,237,.2); border:1px solid rgba(124,58,237,.4); color:#a78bfa; font-size:9px; font-weight:700; font-family:'Rajdhani',sans-serif; letter-spacing:1px; white-space:nowrap; }

/* TOASTS */
.toast-container{ position:fixed; top:60px; right:14px; z-index:999; display:flex; flex-direction:column; gap:8px; pointer-events:none; }
.toast{
  background:var(--bg2); border:1px solid var(--bd); border-radius:8px;
  padding:11px 15px; font-size:11px; max-width:300px; box-shadow:var(--shadow);
  animation:slideIn .25s ease; pointer-events:all;
}
@keyframes slideIn{ from{transform:translateX(100%);opacity:0;} to{transform:none;opacity:1;} }
.toast.success{ border-left:3px solid var(--up); }
.toast.error{ border-left:3px solid var(--dn); }
.toast.warn{ border-left:3px solid var(--gold); }
.toast.info{ border-left:3px solid var(--bl); }

/* ABONNEMENT */
.plan-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }
@media(max-width:600px){ .plan-grid{ grid-template-columns:1fr; } }

/* UTILS */
.flex{ display:flex; align-items:center; }
.jb{ justify-content:space-between; }
.g4{gap:4px;}.g6{gap:6px;}.g8{gap:8px;}.g10{gap:10px;}
.f9{font-size:9px;}.f10{font-size:10px;}.f11{font-size:11px;}.f12{font-size:12px;}.f13{font-size:13px;}
.tx1{color:var(--tx1);}.tx2{color:var(--tx2);}
.cup{color:var(--up);}.cdn{color:var(--dn);}.cgold{color:var(--gold);}
.mono{font-family:'JetBrains Mono',monospace;}
.bold{font-weight:700;}
.sep{height:1px;background:var(--bd);margin:9px 0;}
.mt4{margin-top:4px;}.mt8{margin-top:8px;}.mt10{margin-top:10px;}.mt14{margin-top:14px;}
.mb4{margin-bottom:4px;}.mb8{margin-bottom:8px;}.mb12{margin-bottom:12px;}
.wnw{white-space:nowrap;}
.nodata{ padding:30px; text-align:center; color:var(--tx2); font-size:12px; }
.fin{ animation:fadeIn .2s ease; }
@keyframes fadeIn{ from{opacity:0;transform:translateY(4px);} to{opacity:1;transform:none;} }
.slider{ width:100%; accent-color:var(--gold); }

/* ═══════════════════════════════════════════════
   CHOREOGRAPHY & ENTRANCE ANIMATIONS
═══════════════════════════════════════════════ */

/* Staggered page load animations */
@keyframes slideUp {
  from { opacity:0; transform:translateY(20px); }
  to   { opacity:1; transform:translateY(0); }
}
@keyframes slideInLeft {
  from { opacity:0; transform:translateX(-16px); }
  to   { opacity:1; transform:translateX(0); }
}
@keyframes slideInRight {
  from { opacity:0; transform:translateX(16px); }
  to   { opacity:1; transform:translateX(0); }
}
@keyframes scaleIn {
  from { opacity:0; transform:scale(.94); }
  to   { opacity:1; transform:scale(1); }
}
@keyframes shimmer {
  0%   { background-position:-200% center; }
  100% { background-position:200% center; }
}
@keyframes glowPulse {
  0%,100% { box-shadow:0 0 0 rgba(240,185,11,0); }
  50%      { box-shadow:0 0 18px rgba(240,185,11,.18); }
}
@keyframes tickerIn {
  from { opacity:0; transform:translateY(-6px); }
  to   { opacity:1; transform:translateY(0); }
}
@keyframes counterUp {
  from { opacity:0; transform:translateY(8px) scale(.9); }
  to   { opacity:1; transform:translateY(0) scale(1); }
}
@keyframes borderFlow {
  0%   { border-color:rgba(240,185,11,.1); }
  50%  { border-color:rgba(240,185,11,.35); }
  100% { border-color:rgba(240,185,11,.1); }
}
@keyframes progressFill {
  from { width:0%; }
}
@keyframes scanLine {
  0%   { transform:translateY(-100%); opacity:0; }
  10%  { opacity:.5; }
  90%  { opacity:.5; }
  100% { transform:translateY(100vh); opacity:0; }
}

/* Topbar entrance */
.topbar { animation:slideUp .35s ease both; }
/* NOTE: sidebar animation removed on mobile to avoid conflict with transform:translateX(-110%) */
@media(min-width:861px){ .sidebar { animation:slideInLeft .4s ease .05s both; } }

/* Dashboard cards stagger */
.dash-anim-1 { animation:slideUp .4s ease .08s both; }
.dash-anim-2 { animation:slideUp .4s ease .15s both; }
.dash-anim-3 { animation:slideUp .4s ease .22s both; }
.dash-anim-4 { animation:slideUp .4s ease .29s both; }
.dash-anim-5 { animation:slideUp .4s ease .36s both; }
.dash-anim-6 { animation:slideUp .4s ease .43s both; }
.dash-anim-7 { animation:slideUp .4s ease .50s both; }

/* Sidebar items stagger */
.sitem { animation:slideInLeft .3s ease both; }
.sitem:nth-child(1)  { animation-delay:.10s; }
.sitem:nth-child(2)  { animation-delay:.14s; }
.sitem:nth-child(3)  { animation-delay:.18s; }
.sitem:nth-child(4)  { animation-delay:.22s; }
.sitem:nth-child(5)  { animation-delay:.26s; }
.sitem:nth-child(6)  { animation-delay:.30s; }
.sitem:nth-child(7)  { animation-delay:.34s; }
.sitem:nth-child(8)  { animation-delay:.38s; }
.sitem:nth-child(9)  { animation-delay:.42s; }

/* Number counter glow on change */
.tstat-v  { transition:color .3s, transform .2s; }
.tstat:hover .tstat-v { transform:scale(1.06); }

/* Signal cards elegant reveal */
.sc { animation:scaleIn .3s ease both; }
.sc:nth-child(1) { animation-delay:.05s; }
.sc:nth-child(2) { animation-delay:.12s; }
.sc:nth-child(3) { animation-delay:.19s; }
.sc:nth-child(4) { animation-delay:.26s; }

/* Hover lift effect */
.sc:hover { transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,0,0,.3), var(--glow-gold); }
.pc:hover { transform:translateY(-1px); box-shadow:0 6px 20px rgba(0,0,0,.25); }
.pc { transition:transform .2s ease, box-shadow .2s ease; }

/* Gold border breathing for active bot */
.bot-active-glow { animation:borderFlow 3s ease infinite; }

/* Score bar animated fill */
.sc-sfill { animation:progressFill .8s ease .3s both; }

/* Log entries slide in */
.ll { animation:slideInRight .2s ease both; }

/* Scan table rows */
.scan-tr { animation:slideUp .25s ease both; }

/* Toast upgraded */
.toast { animation:slideInRight .25s cubic-bezier(.34,1.56,.64,1); }

/* Shimmer loading bar */
.shimmer-bar {
  background: linear-gradient(90deg, var(--bg3) 25%, var(--bd2) 50%, var(--bg3) 75%);
  background-size:200% 100%;
  animation:shimmer 1.5s infinite;
}

/* Active position PnL pulse */
@keyframes pnlPulseUp   { 0%,100%{color:var(--up);}   50%{color:#7fffcc;} }
@keyframes pnlPulseDn   { 0%,100%{color:var(--dn);}   50%{color:#ffaaaa;} }
.pnl-live-up  { animation:pnlPulseUp 2.5s ease infinite; }
.pnl-live-dn  { animation:pnlPulseDn 2.5s ease infinite; }

/* Topbar ticker values */
.tstat-v { animation:tickerIn .35s ease both; }
.tstat:nth-child(1) .tstat-v { animation-delay:.1s; }
.tstat:nth-child(2) .tstat-v { animation-delay:.15s; }
.tstat:nth-child(3) .tstat-v { animation-delay:.2s; }
.tstat:nth-child(4) .tstat-v { animation-delay:.25s; }
.tstat:nth-child(5) .tstat-v { animation-delay:.3s; }
.tstat:nth-child(6) .tstat-v { animation-delay:.35s; }
.tstat:nth-child(7) .tstat-v { animation-delay:.4s; }

/* API status breathing */
.api-on .apidot {
  box-shadow:0 0 6px currentColor;
}
.api-off .apidot {
  opacity:.7;
}

/* User chip hover */
.user-chip { transition:transform .15s ease, border-color .15s ease, box-shadow .15s ease; }
.user-chip:hover { transform:translateY(-1px); box-shadow:0 4px 12px rgba(240,185,11,.15); }

/* Theme button spin */
.theme-btn:hover { transform:rotate(20deg); transition:transform .25s ease, border-color .15s ease; }

/* Bot toggle pulse when active */
.bt-on { animation:glowPulse 2.5s ease infinite; }

/* Balance number counter animation */
.balance-animated {
  animation:counterUp .5s cubic-bezier(.34,1.56,.64,1) both;
}

/* Scan overlay scan effect */
.scan-wrap {
  position:relative;
  overflow:hidden;
}
.scan-wrap::before {
  content:'';
  position:absolute;
  top:0; left:0; right:0;
  height:2px;
  background:linear-gradient(90deg, transparent, rgba(240,185,11,.4), transparent);
  animation:scanLine 4s linear infinite;
  pointer-events:none;
  z-index:1;
}

/* Section headers reveal */
.sec-head { animation:slideUp .3s ease .1s both; }
.sec-title::before {
  content:'';
  display:inline-block;
  width:0;
  height:1px;
  background:var(--gold);
  margin-right:0;
  transition:width .4s ease, margin-right .4s ease;
  vertical-align:middle;
}
.sec-head:hover .sec-title::before {
  width:12px;
  margin-right:6px;
}

/* Positions grid enhanced */
.pos-grid { gap:12px; }

/* Context mini cards */
.ctx-mini {
  transition:transform .2s ease, border-color .2s ease;
}
.ctx-mini:hover {
  transform:translateY(-1px);
  border-color:var(--bd2);
}

/* WR progress bar animated */
@keyframes wrBarFill {
  from { transform:scaleX(0); transform-origin:left; }
  to   { transform:scaleX(1); transform-origin:left; }
}

/* Improved signal row hover */
.sig-row-hover {
  transition:all .15s ease;
}
.sig-row-hover:hover {
  transform:translateX(3px);
  border-color:var(--gold) !important;
  background:rgba(240,185,11,.04) !important;
}

/* Modal animate in */
.modal-bg { animation:fadeIn .2s ease; }
.modal-box { animation:scaleIn .25s cubic-bezier(.34,1.56,.64,1); }

/* Enhanced log body */
.log-body .ll:first-child { font-weight:600; }

/* Exec button enhanced */
.exec-btn { transition:all .15s ease; }
.exec-btn:hover { transform:scale(1.05); }
.exec-demo:hover { background:var(--gold) !important; color:#000 !important; border-color:var(--gold) !important; }
.exec-live:hover { background:var(--up) !important; color:#000 !important; }

/* Auth page improved */
.auth-feat-item { animation:slideInLeft .35s ease both; }
.auth-feat-item:nth-child(1) { animation-delay:.2s; }
.auth-feat-item:nth-child(2) { animation-delay:.27s; }
.auth-feat-item:nth-child(3) { animation-delay:.34s; }
.auth-feat-item:nth-child(4) { animation-delay:.41s; }
.auth-feat-item:nth-child(5) { animation-delay:.48s; }
.auth-feat-item:nth-child(6) { animation-delay:.55s; }
.auth-right { animation:slideInRight .4s ease .1s both; }

/* Hexagon logo spin on hover */
.t-hex {
  transition:transform .3s ease;
}
.t-logo:hover .t-hex {
  transform:rotate(30deg) scale(1.1);
}

/* Improved card backgrounds with subtle gradients */
[data-theme="dark"] .bot-box {
  background:linear-gradient(135deg, var(--bg3) 0%, rgba(30,38,58,1) 100%);
}
[data-theme="dark"] .sc {
  background:linear-gradient(160deg, var(--bg2) 0%, rgba(20,26,42,.95) 100%);
}
[data-theme="dark"] .pc {
  background:linear-gradient(160deg, var(--bg2) 0%, rgba(20,26,42,.95) 100%);
}

/* Topbar gradient line */
.topbar {
  border-bottom:1px solid var(--bd);
  box-shadow:0 1px 0 rgba(240,185,11,.05);
}
[data-theme="dark"] .topbar {
  background:linear-gradient(180deg, rgba(22,28,44,1) 0%, var(--bg2) 100%);
}

/* Enhanced sidebar */
[data-theme="dark"] .sidebar {
  background:linear-gradient(180deg, rgba(18,24,38,1) 0%, var(--bg2) 100%);
}

/* WR bar improved */
.wr-track {
  height:4px;
  background:var(--bg);
  border-radius:2px;
  overflow:hidden;
}
.wr-fill {
  height:100%;
  border-radius:2px;
  transition:width .8s cubic-bezier(.4,0,.2,1);
  animation:progressFill .8s ease .5s both;
}

/* Score fill improved */
.sc-sfill {
  background:linear-gradient(90deg, var(--gold), var(--up));
}

/* Toast improved with subtle gradient */
.toast {
  backdrop-filter:blur(8px);
}
[data-theme="dark"] .toast {
  background:linear-gradient(135deg, rgba(22,28,44,.98) 0%, rgba(17,21,32,.98) 100%);
}

/* Improved scan table hover */
.scan-tr:hover {
  background:rgba(240,185,11,.04) !important;
  transition:background .1s;
}

/* Price change flash */
@keyframes flashGreen { 0%,100%{background:transparent;} 30%{background:rgba(14,203,129,.1);} }
@keyframes flashRed   { 0%,100%{background:transparent;} 30%{background:rgba(246,70,93,.08);} }
.price-up { animation:flashGreen .6s ease; }
.price-dn { animation:flashRed .6s ease; }

</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useCallback,useMemo} = React;

/* ═══════════════════════════════════════════════
   CONSTANTS
═══════════════════════════════════════════════ */
/* Signaux SPOT Binance — paires disponibles sur Binance Spot (pas Futures exclusivement) */
const PAIRS = ['BTCUSDT','ETHUSDT','SOLUSDT','BNBUSDT','XRPUSDT','ADAUSDT',
  'DOGEUSDT','AVAXUSDT','DOTUSDT','MATICUSDT','LINKUSDT','LTCUSDT',
  'UNIUSDT','ATOMUSDT','NEARUSDT','APTUSDT','SHIBUSDT','TRXUSDT','VETUSDT','ICPUSDT'];

const BASE_PRICES = {
  BTCUSDT:68420,ETHUSDT:3812,SOLUSDT:183,BNBUSDT:562,XRPUSDT:0.621,
  ADAUSDT:0.584,DOGEUSDT:0.178,AVAXUSDT:41.8,DOTUSDT:9.18,MATICUSDT:0.952,
  LINKUSDT:18.2,LTCUSDT:94.8,UNIUSDT:11.9,ATOMUSDT:10.9,NEARUSDT:7.72,
  APTUSDT:11.4,SHIBUSDT:0.0000278,TRXUSDT:0.122,VETUSDT:0.0381,ICPUSDT:14.6
};

/* ─── BINANCE FEES ─── */
const BINANCE_MAKER_FEE = 0.0002; // 0.02%
const BINANCE_TAKER_FEE = 0.0004; // 0.04%
// Calcul réaliste: entrée taker + sortie taker = 0.08% total
const calcFeesForTrade = (notional) => notional * BINANCE_TAKER_FEE * 2;

/* ─── LEVERAGE LIQUIDATION ─── */
const calcLiqPrice = (side, entry, leverage, maintenanceMargin = 0.004) => {
  // Formule Binance Futures (isolé)
  if (side === 'BUY') {
    return entry * (1 - (1/leverage) + maintenanceMargin);
  } else {
    return entry * (1 + (1/leverage) - maintenanceMargin);
  }
};

let MKT = {};
PAIRS.forEach(p => { MKT[p] = {price:BASE_PRICES[p], prev:BASE_PRICES[p], sim:true}; });

/* Prix réels Binance — fetch toutes les 10s, fallback simulation ancrée */
let PRICE_SOURCE = 'SIM'; // 'LIVE' ou 'SIM'
const fetchBinancePrices = async () => {
  try {
    const syms = JSON.stringify(PAIRS);
    const res = await fetch(`https://api.binance.com/api/v3/ticker/price?symbols=${encodeURIComponent(syms)}`,{signal:AbortSignal.timeout(5000)});
    if(!res.ok) throw new Error('HTTP '+res.status);
    const data = await res.json();
    if(!Array.isArray(data)||!data.length) throw new Error('empty');
    data.forEach(({symbol,price})=>{
      if(MKT[symbol]!==undefined){
        const p=parseFloat(price);
        MKT[symbol]={prev:MKT[symbol].price, price:p, sim:false};
        BASE_PRICES[symbol]=p; // re-ancrer la base sur le prix réel
      }
    });
    PRICE_SOURCE='LIVE';
    return true;
  } catch(e){ return false; }
};

/* Simulation ancrée ±15% autour du BASE_PRICE (pas de dérive infinie) */
const tickMarket = () => {
  if(PRICE_SOURCE==='LIVE') return; // si LIVE, on ne simule pas
  PAIRS.forEach(p => {
    const base = BASE_PRICES[p];
    const d = MKT[p];
    // Random walk ancré : on ramène vers la base si on dévie trop
    const deviation = (d.price - base) / base;
    const anchor = -deviation * 0.05; // force de rappel vers base
    const noise = (Math.random() - 0.5) * 0.0018;
    const move = d.price * (noise + anchor);
    const newPrice = Math.max(d.price + move, base * 0.85);
    const capped = Math.min(newPrice, base * 1.15); // borne ±15%
    MKT[p] = {prev:d.price, price:capped, sim:true};
  });
};

/* Lancer le fetch Binance immédiatement puis toutes les 10s */
fetchBinancePrices();
setInterval(fetchBinancePrices, 10000);

/* ─── SESSION + JOURS ─── */
const getSess = () => { const h=new Date().getUTCHours(); if(h>=8&&h<10)return'london'; if(h>=13&&h<21)return'ny'; return'asia'; };
const sessLbl = {asia:'Asie 🌏', london:'Londres 🇬🇧', ny:'New York 🇺🇸'};

const getDayRisk = () => {
  const d = new Date().getUTCDay(); // 0=Sun, 1=Mon ... 5=Fri, 6=Sat
  // Dimanche et samedi = volume faible, dangereux
  if(d === 0 || d === 6) return { level:'warn', label:'Weekend ⚠️', msg:'Volume faible, spreads larges — Trader avec prudence', ok:true };
  // Lundi = ouverture prudente, gaps possibles
  if(d === 1) return { level:'warn', label:'Lundi ⚠', msg:'Attention aux gaps d\'ouverture', ok:true };
  // Vendredi = fermeture, piège week-end
  if(d === 5) return { level:'warn', label:'Vendredi ⚠', msg:'Fermeture hebdo — Éviter les nouvelles positions tard', ok:true };
  // Mardi-Jeudi = optimal
  return { level:'safe', label:'Jour optimal ✅', msg:'Conditions de trading normales', ok:true };
};

const btcTrendCalc = (p,prev) => { const d=(p-prev)/prev*100; return d>.35?'BULL':d<-.35?'BEAR':'RANGE'; };
const calcScore = s => { let n=0; if(s.bb)n+=28; if(s.vos)n+=22; if(s.vol)n+=15; if(s.rsi)n+=10; if(s.btcOk)n+=15; if(s.sessOk)n+=10; return n; };
const makeSetup = (pair, btcT, sessOk) => {
  const side = Math.random()>.5?'BUY':'SELL';
  const btcOk=(side==='BUY'&&btcT!=='BEAR')||(side==='SELL'&&btcT!=='BULL')||btcT==='RANGE';
  const s={
    id:Date.now()+Math.random(),pair,side,
    bb:Math.random()>.32,vos:Math.random()>.40,
    vol:Math.random()>.42,rsi:Math.random()>.38,
    btcOk,sessOk,
    rr:(1.8+Math.random()*2.5).toFixed(1),
    validFor:60+Math.floor(Math.random()*100),ts:new Date().toLocaleTimeString('fr-FR')
  };
  s.score=calcScore(s); return s;
};

/* ─── EMAIL CONFIG ─── */
const EMAILJS_PUBLIC_KEY  = 'uxfe7-GR0xUVfx1xW';
const EMAILJS_SERVICE_ID  = 'service_t36sjs6';
const EMAILJS_TEMPLATE_ID = 'template_zf05y1a';
const EMAILJS_CONFIGURED  = true;
const EMAIL_BACKEND_URL = '/api/send-code';
if (EMAILJS_CONFIGURED) { try { emailjs.init(EMAILJS_PUBLIC_KEY); } catch(e) {} }

const sendEmail = async (toEmail, code, subject) => {
  try {
    const r = await fetch(EMAIL_BACKEND_URL, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body:JSON.stringify({to:toEmail,code,subject}), signal:AbortSignal.timeout(5000)
    });
    const d = await r.json();
    if(d.ok) return true;
  } catch(e) {}
  if(EMAILJS_CONFIGURED) {
    try {
      await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {to_email:toEmail,code,subject,app_name:'AlphaBot Pro'});
      return true;
    } catch(e) {}
  }
  return false;
};

const copyUniversal = (text) => {
  if(navigator.clipboard && window.isSecureContext) return navigator.clipboard.writeText(text);
  const ta = document.createElement('textarea');
  ta.value = text;
  ta.style.cssText = 'position:fixed;left:-9999px;top:-9999px;opacity:0;';
  document.body.appendChild(ta);
  ta.focus(); ta.select();
  const ok = document.execCommand('copy');
  document.body.removeChild(ta);
  return ok ? Promise.resolve() : Promise.reject();
};

const fmtP   = p => p>=1000?p.toFixed(2):p>=10?p.toFixed(3):p>=1?p.toFixed(4):p.toFixed(5);
const fmtPct = p => (p>=0?'+':'')+p.toFixed(3)+'%';
const ts     = () => new Date().toLocaleTimeString('fr-FR');
const lsG    = (k,d) => { try{const v=localStorage.getItem(k);return v?JSON.parse(v):d;}catch{return d;} };
const lsS    = (k,v) => { try{localStorage.setItem(k,JSON.stringify(v));}catch{} };
const genRefCode = email => {
  const prefix = email.split('@')[0].substr(0,4).toUpperCase().replace(/[^A-Z]/g,'X');
  return prefix.padEnd(4,'X')+(1000+Math.floor(Math.random()*8999));
};

async function hmac256(secret, message) {
  const enc = new TextEncoder();
  const key = await crypto.subtle.importKey('raw',enc.encode(secret),{name:'HMAC',hash:'SHA-256'},false,['sign']);
  const sig = await crypto.subtle.sign('HMAC',key,enc.encode(message));
  return Array.from(new Uint8Array(sig)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

/* ─── FAKE NEWS FONDAMENTAUX ─── */
const FUNDAMENTALS = [
  {id:1, title:"Fed maintient les taux — impact haussier BTC", sentiment:"bull", impact:"high", source:"FED", time:"2h"},
  {id:2, title:"BlackRock ETF BTC : +$800M d'entrées cette semaine", sentiment:"bull", impact:"high", source:"Bloomberg", time:"4h"},
  {id:3, title:"Ethereum : mise à jour Dencun confirmée Q2", sentiment:"bull", impact:"med", source:"EthResearch", time:"6h"},
  {id:4, title:"Chine : nouvelles restrictions crypto exchanges", sentiment:"bear", impact:"high", source:"Reuters", time:"8h"},
  {id:5, title:"Binance résout problème technique — retraits normaux", sentiment:"bull", impact:"med", source:"Binance", time:"10h"},
  {id:6, title:"Halving BTC dans 45 jours — hashrate ATH", sentiment:"bull", impact:"high", source:"CoinMetrics", time:"12h"},
  {id:7, title:"SEC retarde décision ETF SOL", sentiment:"bear", impact:"med", source:"SEC.gov", time:"1j"},
  {id:8, title:"Inflation US CPI: 3.2% — sous les attentes", sentiment:"bull", impact:"high", source:"BLS", time:"1j"},
];

/* ═══════════════════════════════════════════════
   AUTH COMPONENT
═══════════════════════════════════════════════ */
function Auth({setUser, totalUsers}) {
  const [tab,setTab]=useState('login');
  const [step,setStep]=useState('form');
  const [email,setEmail]=useState('');
  const [pass,setPass]=useState('');
  const [pass2,setPass2]=useState('');
  const [refInput,setRefInput]=useState('');
  const [err,setErr]=useState('');
  const [ok,setOk]=useState('');
  const [verCode,setVerCode]=useState('');
  const [simCode,setSimCode]=useState('');
  const [resetCode,setResetCode]=useState('');
  const [simReset,setSimReset]=useState('');
  const [newPass,setNewPass]=useState('');
  const [loading,setLoading]=useState(false);
  const [emailSent,setEmailSent]=useState(false);

  const udb = () => lsG('ab24_udb', {});
  const saveUdb = db => lsS('ab24_udb', db);

  useEffect(() => {
    const db = udb();
    if (!db['admin@alphabot.pro']) {
      db['admin@alphabot.pro'] = {
        email:'admin@alphabot.pro', password:'Admin@2024!', joinedAt:Date.now(),
        verified:true, refCode:'ADMIN0001', refBy:null, refCount:0, isAdmin:true
      };
      saveUdb(db);
    }
  }, []);

  const login = () => {
    setErr(''); setOk('');
    const db=udb(), u=db[email.toLowerCase()];
    if(!u||u.password!==pass) return setErr('Email ou mot de passe incorrect.');
    if(!u.verified) return setErr('Vérifiez votre email avant de vous connecter.');
    setUser(u); lsS('ab24_user', u);
  };

  const register = async () => {
    setErr(''); setOk('');
    if(!email||!pass) return setErr('Email et mot de passe requis.');
    if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) return setErr('Email invalide.');
    if(pass.length<8) return setErr('Mot de passe minimum 8 caractères.');
    if(pass!==pass2) return setErr('Les mots de passe ne correspondent pas.');
    const db=udb();
    if(db[email.toLowerCase()]) return setErr('Email déjà utilisé. Connectez-vous ou réinitialisez votre mot de passe.');
    let referredBy = null;
    if(refInput) {
      const referrer = Object.values(db).find(u=>u.refCode===refInput.toUpperCase());
      if(!referrer) return setErr('Code parrainage invalide.');
      referredBy = referrer.email;
    }
    const code = Math.floor(100000+Math.random()*900000).toString();
    setSimCode(code);
    setLoading(true);
    const nu = {
      email:email.toLowerCase(), password:pass, joinedAt:Date.now(),
      verified:false, refCode:genRefCode(email), refBy:referredBy, refCount:0,
      isAdmin:false, balance:1000
    };
    db[email.toLowerCase()]=nu; saveUdb(db);
    // Try to send email but don't depend on it
    let sent = false;
    try { sent = await sendEmail(email, code, 'Code vérification AlphaBot Pro'); } catch(e){}
    setEmailSent(sent);
    setLoading(false);
    setStep('verify');
    // Always show a clear message
    setOk(sent ? `📧 Email envoyé à ${email} — Vérifiez aussi vos spams` : `⚙️ Email non configuré — utilisez le code affiché ci-dessous`);
  };

  const verifyEmail = (forcedCode) => {
    setErr(''); setOk('');
    const code = forcedCode || verCode;
    if(code!==simCode) return setErr('Code incorrect.');
    const db=udb();
    db[email.toLowerCase()].verified=true;
    if(db[email.toLowerCase()].refBy) {
      const refEmail=db[email.toLowerCase()].refBy;
      if(db[refEmail]) { db[refEmail].refCount=(db[refEmail].refCount||0)+1; }
    }
    saveUdb(db);
    const u=db[email.toLowerCase()];
    setUser(u); lsS('ab24_user',u);
  };

  const requestReset = async () => {
    setErr(''); setOk('');
    const db=udb();
    if(!db[email.toLowerCase()]) return setErr('Aucun compte associé à cet email.');
    const code=Math.floor(100000+Math.random()*900000).toString();
    setSimReset(code);
    setLoading(true);
    const sent=await sendEmail(email,code,'Reset AlphaBot Pro');
    setEmailSent(sent);
    setLoading(false);
    setStep('reset-code');
    // Toujours afficher le code quelle que soit la situation email
    setOk(sent
      ? `✅ Email envoyé à ${email} — Vérifiez vos spams si nécessaire`
      : `⚠️ Email non livré — Utilisez le code affiché ci-dessous`
    );
  };

  const doReset = () => {
    setErr(''); setOk('');
    if(resetCode!==simReset) return setErr('Code incorrect.');
    if(newPass.length<8) return setErr('Minimum 8 caractères.');
    const db=udb();
    db[email.toLowerCase()].password=newPass;
    saveUdb(db);
    setOk('Mot de passe modifié ! Connectez-vous.'); setStep('form'); setTab('login');
  };

  return (
    <div className="auth-bg">
      <div className="auth-split">
        <div className="auth-left">
          <div className="auth-left-logo">ALPHA<span>BOT</span> PRO</div>
          <div className="auth-left-sub">Plateforme de trading algorithmique<br/>connectée à Binance Futures — v24</div>
          <div className="auth-feat">
            {[
              ['🤖','Bot automatique 24/7 avec filtres sessions'],
              ['📡','Scanner 20 paires en temps réel'],
              ['📊','Frais Binance intégrés en démo & réel'],
              ['🔗','API Binance Futures réelle'],
              ['💰','Solde compte affiché en temps réel'],
              ['📰','Fondamentaux & News crypto'],
            ].map(([ic,lb])=>(
              <div key={lb} className="auth-feat-item">
                <div className="af-icon">{ic}</div><span>{lb}</span>
              </div>
            ))}
          </div>
          <div className="auth-count">
            <div className="ldot"/>
            <span><b>{totalUsers.toLocaleString('fr-FR')}</b> traders actifs</span>
          </div>
        </div>
        <div className="auth-right">
          <div className="auth-right-title">
            {step==='form'?(tab==='login'?'Connexion':'Créer un compte'):''}
            {step==='verify'?'Vérification email':''}
            {step==='reset-req'||step==='reset-code'?'Réinitialiser mot de passe':''}
          </div>
          <div className="auth-right-sub">
            {step==='form'&&tab==='login'?'Accédez à votre tableau de bord':''}
            {step==='form'&&tab==='register'?'Gratuit · Sans abonnement':''}
          </div>
          {err&&<div className="err-box">{err}</div>}
          {ok&&<div className="ok-box">{ok}</div>}
          {step==='form'&&tab==='login'&&(
            <>
              <div className="atabs">
                <button className="atab act">Connexion</button>
                <button className="atab" onClick={()=>{setTab('register');setErr('');setOk('');}}>Inscription</button>
              </div>
              <div className="fld"><div className="flbl">Email</div>
                <input className="inp" type="email" placeholder="votre@email.com" value={email} onChange={e=>setEmail(e.target.value)} onKeyDown={e=>e.key==='Enter'&&login()}/></div>
              <div className="fld"><div className="flbl">Mot de passe</div>
                <input className="inp" type="password" placeholder="••••••••" value={pass} onChange={e=>setPass(e.target.value)} onKeyDown={e=>e.key==='Enter'&&login()}/></div>
              <button className="btn btn-gold btn-full" onClick={login}>SE CONNECTER →</button>
              <div style={{textAlign:'center',marginTop:'12px'}}>
                <button className="txt-btn" onClick={()=>{setStep('reset-req');setErr('');setOk('');}}>Mot de passe oublié ?</button>
              </div>
            </>
          )}
          {step==='form'&&tab==='register'&&(
            <>
              <div className="atabs">
                <button className="atab" onClick={()=>{setTab('login');setErr('');setOk('');}}>Connexion</button>
                <button className="atab act">Inscription</button>
              </div>
              <div className="fld"><div className="flbl">Email</div><input className="inp" type="email" placeholder="votre@email.com" value={email} onChange={e=>setEmail(e.target.value)}/></div>
              <div className="fld"><div className="flbl">Mot de passe (min. 8 caractères)</div><input className="inp" type="password" placeholder="••••••••" value={pass} onChange={e=>setPass(e.target.value)}/></div>
              <div className="fld"><div className="flbl">Confirmer mot de passe</div><input className="inp" type="password" placeholder="••••••••" value={pass2} onChange={e=>setPass2(e.target.value)}/></div>
              <div className="fld"><div className="flbl">Code parrainage (optionnel)</div><input className="inp" type="text" placeholder="ex: USER1234" value={refInput} onChange={e=>setRefInput(e.target.value.toUpperCase())}/></div>
              <button className="btn btn-gold btn-full" onClick={register}>CRÉER MON COMPTE →</button>
            </>
          )}
          {step==='verify'&&(
            <>
              {/* Code ALWAYS shown — primary method */}
              <div style={{background:'linear-gradient(135deg,rgba(240,185,11,.12),rgba(240,185,11,.06))',border:'2px solid rgba(240,185,11,.4)',borderRadius:'10px',padding:'16px',marginBottom:'14px',textAlign:'center'}}>
                <div style={{fontSize:'10px',color:'var(--tx1)',letterSpacing:'1px',textTransform:'uppercase',marginBottom:'8px'}}>
                  🔑 Votre code de vérification
                </div>
                <div onClick={()=>copyUniversal(simCode)} style={{fontSize:'36px',fontWeight:800,letterSpacing:'12px',fontFamily:'JetBrains Mono,monospace',color:'var(--gold)',cursor:'pointer',userSelect:'all',padding:'6px 0'}}>
                  {simCode}
                </div>
                <div style={{fontSize:'9px',color:'var(--tx2)',marginTop:'6px'}}>👆 Appuyez sur le code pour le copier</div>
                {emailSent&&<div style={{fontSize:'9px',color:'var(--up)',marginTop:'4px'}}>📧 Également envoyé à {email}</div>}
              </div>
              <div className="fld" style={{marginTop:'4px'}}><div className="flbl">Entrez le code à 6 chiffres</div>
                <input className="inp" type="number" placeholder="123456" maxLength={6} value={verCode} onChange={e=>{const v=e.target.value.replace(/\D/g,'').slice(0,6);setVerCode(v);if(v.length===6)setTimeout(()=>verifyEmail(v),200);}} style={{fontSize:'22px',textAlign:'center',letterSpacing:'10px'}}/></div>
              <button className="btn btn-gold btn-full" onClick={()=>verifyEmail()}>✅ VÉRIFIER MON COMPTE →</button>
              <div style={{textAlign:'center',marginTop:'10px'}}><button className="txt-btn" onClick={()=>{setStep('form');setErr('');setOk('');setVerCode('');}}>← Retour</button></div>
            </>
          )}
          {step==='reset-req'&&(
            <>
              <div className="fld"><div className="flbl">Votre email</div><input className="inp" type="email" placeholder="votre@email.com" value={email} onChange={e=>setEmail(e.target.value)}/></div>
              <button className="btn btn-gold btn-full" onClick={requestReset}>ENVOYER LE CODE →</button>
              <div style={{textAlign:'center',marginTop:'10px'}}><button className="txt-btn" onClick={()=>{setStep('form');setErr('');setOk('');}}>← Retour</button></div>
            </>
          )}
          {step==='reset-code'&&(
            <>
              {/* Le code est TOUJOURS affiché — fallback garanti */}
              <div style={{background:'rgba(240,185,11,.08)',border:'2px solid rgba(240,185,11,.4)',borderRadius:'10px',padding:'14px',marginBottom:'12px'}}>
                <div style={{fontSize:'9px',color:'var(--tx2)',letterSpacing:'2px',textTransform:'uppercase',textAlign:'center',marginBottom:'8px'}}>
                  {emailSent ? '📧 Code aussi envoyé par email — ou utilisez celui-ci :' : '🔑 Votre code de réinitialisation :'}
                </div>
                <div onClick={()=>copyUniversal(simReset)} style={{fontSize:'34px',fontWeight:800,textAlign:'center',letterSpacing:'12px',fontFamily:'JetBrains Mono,monospace',cursor:'pointer',color:'var(--gold)',padding:'8px 0'}}>
                  {simReset}
                </div>
                <div style={{textAlign:'center',fontSize:'9px',color:'var(--tx2)',marginTop:'4px'}}>👆 Cliquez pour copier · Valable 10 minutes</div>
              </div>
              <div className="fld"><div className="flbl">Code reçu</div><input className="inp" type="text" placeholder="123456" maxLength={6} value={resetCode} onChange={e=>setResetCode(e.target.value.replace(/\D/g,''))} style={{textAlign:'center',letterSpacing:'8px',fontSize:'20px'}}/></div>
              <div className="fld"><div className="flbl">Nouveau mot de passe (min. 8 car.)</div><input className="inp" type="password" placeholder="Nouveau mot de passe" value={newPass} onChange={e=>setNewPass(e.target.value)}/></div>
              <button className="btn btn-gold btn-full" onClick={doReset}>🔑 RÉINITIALISER →</button>
              <div style={{textAlign:'center',marginTop:'10px'}}><button className="txt-btn" onClick={()=>{setStep('form');setErr('');setOk('');}}>← Retour connexion</button></div>
            </>
          )}
        </div>
      </div>
    </div>
  );
}

/* DISCLAIMER */
function DisclaimerModal({onAccept, onClose}) {
  const [checked,setChecked]=useState(false);
  return (
    <div className="modal-bg">
      <div className="modal-box disc-modal">
        <div className="disc-header">
          <div className="disc-icon">⚖️</div>
          <div className="disc-title">DÉCLARATION LÉGALE — MODE RÉEL</div>
          <div className="f10 tx1" style={{marginTop:'6px'}}>À lire et accepter avant d'utiliser l'API Binance Futures en mode réel</div>
        </div>
        <div className="disc-body">
          <ul className="disc-points">
            <li><b>Outil informatif uniquement :</b> AlphaBot Pro est un outil d'analyse algorithmique. Il ne constitue <b>en aucun cas un conseil en investissement, une recommandation financière ou une offre d'achat/vente</b>.</li>
            <li><b>Risque de perte totale :</b> Le trading sur les marchés à effet de levier comporte un risque très élevé de perte partielle ou <b>totale</b> du capital investi. N'investissez que ce que vous pouvez perdre.</li>
            <li><b>Performances non garanties :</b> Les performances passées ne préjugent pas des performances futures. AlphaBot Pro <b>décline toute responsabilité</b> quant aux résultats financiers.</li>
            <li><b>Frais Binance intégrés :</b> Chaque trade génère des frais (0.02%/0.04%) intégrés dans les calculs de performance affichés.</li>
            <li><b>Sécurité API :</b> Permissions <b>Futures Read + Trade</b> uniquement. <span style={{color:'var(--dn)'}}>Ne jamais activer le retrait.</span></li>
          </ul>
          <label className="disc-check">
            <input type="checkbox" checked={checked} onChange={e=>setChecked(e.target.checked)}/>
            <span>Je reconnais avoir lu ces avertissements. Je suis seul(e) responsable de mes décisions de trading. AlphaBot Pro et ses opérateurs ne pourront être tenus responsables de mes pertes.</span>
          </label>
          <div style={{display:'flex',gap:'10px'}}>
            <button className="btn btn-out" style={{flex:1}} onClick={onClose}>Annuler</button>
            <button className="btn btn-gold" style={{flex:2}} onClick={()=>checked&&onAccept()} disabled={!checked}>✅ J'ACCEPTE ET CONTINUE EN MODE RÉEL</button>
          </div>
        </div>
      </div>
    </div>
  );
}

/* ═══════════════════════════════════════════════
   DEMO BALANCE EDITOR
═══════════════════════════════════════════════ */
function DemoBalanceEditor({balance, setBalance, stats, setStats, lsS, toast, log}) {
  const [editing, setEditing] = useState(false);
  const [val, setVal] = useState(balance.toString());

  const applyBalance = (b) => {
    const n = parseFloat(b);
    if(isNaN(n)||n<1) return;
    setBalance(n); lsS('ab24_bal',n);
    toast(`Solde démo → ${n.toFixed(0)} $`, 'success', 2000);
    log(`💰 Solde démo modifié: ${n.toFixed(0)}$`, 'wrn');
    setEditing(false);
  };

  const resetStats = () => {
    const clean = {wins:0,losses:0,pnl:0,wr:0,totalFees:0};
    setStats(clean); lsS('ab24_stats',clean);
    toast('Stats remises à zéro', 'success', 2000);
    log('🗑 Stats réinitialisées', 'wrn');
  };

  const PRESETS = [500, 1000, 5000, 10000];

  return (
    <div style={{background:'var(--bg2)',border:'1px solid rgba(240,185,11,.2)',borderRadius:'10px',padding:'13px 15px'}}>
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'10px'}}>
        <div style={{fontFamily:"'Rajdhani',sans-serif",fontWeight:700,fontSize:'12px',letterSpacing:'1px',color:'var(--tx1)'}}>💰 SOLDE DÉMO</div>
        <button onClick={resetStats} style={{fontSize:'9px',padding:'3px 9px',background:'rgba(246,70,93,.08)',border:'1px solid rgba(246,70,93,.25)',color:'var(--dn)',borderRadius:'5px',cursor:'pointer',fontFamily:"'Rajdhani',sans-serif",fontWeight:700}}>
          🗑 Reset Stats
        </button>
      </div>
      <div style={{display:'flex',alignItems:'center',gap:'8px',marginBottom:'10px'}}>
        {editing ? (
          <>
            <input
              autoFocus
              type="number" min="1"
              value={val}
              onChange={e=>setVal(e.target.value)}
              onKeyDown={e=>{if(e.key==='Enter')applyBalance(val);if(e.key==='Escape')setEditing(false);}}
              onBlur={()=>applyBalance(val)}
              style={{flex:1,background:'var(--bg)',border:'1px solid var(--gold)',borderRadius:'6px',color:'var(--gold)',fontFamily:"'JetBrains Mono',monospace",fontWeight:700,fontSize:'16px',padding:'6px 10px',outline:'none'}}
            />
            <span style={{fontSize:'14px',color:'var(--gold)',fontWeight:700}}>$</span>
          </>
        ) : (
          <div onClick={()=>{setVal(balance.toString());setEditing(true);}} style={{flex:1,background:'var(--bg)',border:'1px dashed rgba(240,185,11,.3)',borderRadius:'6px',cursor:'text',padding:'8px 12px',display:'flex',alignItems:'center',justifyContent:'space-between',transition:'border-color .2s'}}
            onMouseEnter={e=>e.currentTarget.style.borderColor='var(--gold)'}
            onMouseLeave={e=>e.currentTarget.style.borderColor='rgba(240,185,11,.3)'}>
            <span style={{fontFamily:"'JetBrains Mono',monospace",fontWeight:700,fontSize:'18px',color:'var(--gold)'}}>{balance.toFixed(2)}</span>
            <span style={{fontSize:'10px',color:'var(--tx2)'}}>✏️ modifier</span>
          </div>
        )}
      </div>
      <div style={{display:'flex',gap:'5px',flexWrap:'wrap'}}>
        {PRESETS.map(p=>(
          <button key={p} onClick={()=>{applyBalance(p);}}
            style={{flex:1,minWidth:'50px',padding:'5px 4px',fontSize:'10px',fontFamily:"'Rajdhani',sans-serif",fontWeight:700,background:Math.abs(balance-p)<0.5?'var(--gold)':'var(--bg3)',color:Math.abs(balance-p)<0.5?'#000':'var(--tx1)',border:`1px solid ${Math.abs(balance-p)<0.5?'var(--gold)':'var(--bd)'}`,borderRadius:'5px',cursor:'pointer',transition:'all .15s'}}>
            {p>=1000?`${p/1000}K`:`${p}`}$
          </button>
        ))}
      </div>
      <div style={{fontSize:'9px',color:'var(--tx2)',marginTop:'7px'}}>Cliquez sur le montant pour le modifier ou choisissez un preset · Trades ouverts non affectés</div>
    </div>
  );
}

/* ═══════════════════════════════════════════════
   PDF / DOCUMENT GENERATORS
═══════════════════════════════════════════════ */
const generateGuideHTML = () => `
<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><title>Guide AlphaBot Pro</title>
<style>body{font-family:Arial,sans-serif;max-width:800px;margin:40px auto;padding:0 20px;color:#1a202c;}
h1{color:#F0B90B;border-bottom:3px solid #F0B90B;padding-bottom:10px;}
h2{color:#1890ff;margin-top:30px;} h3{color:#333;}
.warn{background:#fff3cd;border-left:4px solid #F0B90B;padding:12px;margin:15px 0;border-radius:4px;}
.danger{background:#fee;border-left:4px solid #e53e3e;padding:12px;margin:15px 0;border-radius:4px;}
.ok{background:#f0fff4;border-left:4px solid #0ecb81;padding:12px;margin:15px 0;border-radius:4px;}
table{width:100%;border-collapse:collapse;margin:15px 0;}
th{background:#F0B90B;color:#000;padding:8px 12px;text-align:left;}
td{padding:8px 12px;border-bottom:1px solid #e2e8f0;}
tr:hover td{background:#f7f8fa;}</style></head><body>
<h1>📘 Guide Complet AlphaBot Pro v30</h1>
<div class="warn">⚠️ <b>AVERTISSEMENT :</b> Les performances passées ne garantissent pas les résultats futurs. Le trading comporte un risque élevé de perte en capital. Ce guide est fourni à titre informatif uniquement.</div>
<h2>1. Introduction</h2>
<p>AlphaBot Pro est un outil d'analyse algorithmique des marchés crypto. Il analyse 20 paires sur Binance Spot en temps réel et génère des signaux basés sur plusieurs indicateurs techniques.</p>
<h2>2. Installation</h2>
<h3>Option A — Utilisation locale (Android)</h3>
<ol><li>Télécharger le fichier <code>alphabot_pro_v30.html</code></li><li>Ouvrir avec Chrome</li><li>Menu (⋮) → Ajouter à l'écran d'accueil</li></ol>
<h3>Option B — Déploiement en ligne (Netlify)</h3>
<ol><li>Aller sur <a href="https://netlify.com/drop">netlify.com/drop</a></li><li>Glisser le fichier HTML</li><li>Votre site est en ligne en 30 secondes</li></ol>
<h2>3. Configuration API Binance</h2>
<div class="danger">🚨 <b>JAMAIS</b> activer les permissions de retrait sur vos clés API.</div>
<ol><li>Ouvrir Binance → Profil → Gestion des API</li><li>Créer une nouvelle clé → Activer <b>Lecture</b> + <b>Futures</b> uniquement</li><li>Restreindre aux IP de votre serveur si déployé</li><li>Copier l'API Key et Secret Key dans les paramètres d'AlphaBot Pro</li></ol>
<h2>4. Indicateurs — Signaux</h2>
<table><tr><th>Indicateur</th><th>Score</th><th>Signal</th></tr>
<tr><td>Bollinger Bands (BB)</td><td>28 pts</td><td>Prix hors des bandes → retour probable</td></tr>
<tr><td>Volume Out-of-Session (VOS)</td><td>22 pts</td><td>Volume anormal → mouvement imminent</td></tr>
<tr><td>Volume</td><td>15 pts</td><td>Volume > moyenne → confirmation</td></tr>
<tr><td>RSI</td><td>10 pts</td><td>Surachat/survente détecté</td></tr>
<tr><td>Tendance BTC</td><td>15 pts</td><td>Alignement avec la tendance BTC</td></tr>
<tr><td>Session</td><td>10 pts</td><td>Session de trading active</td></tr></table>
<p>Un signal est affiché si le score ≥ votre minimum configuré (défaut: 60/100).</p>
<h2>5. Gestion du Risque</h2>
<div class="ok">✅ Règle d'or : Ne jamais risquer plus de 1-2% du capital par trade.</div>
<table><tr><th>Capital</th><th>Levier recommandé</th><th>Risque max/trade</th></tr>
<tr><td>&lt; 50 $</td><td>3x</td><td>1 $</td></tr>
<tr><td>50-100 $</td><td>5x</td><td>2 $</td></tr>
<tr><td>100-500 $</td><td>10x</td><td>5 $</td></tr>
<tr><td>500-1000 $</td><td>15x</td><td>15 $</td></tr>
<tr><td>&gt; 1000 $</td><td>20x</td><td>20 $</td></tr></table>
<h2>6. Mise à Jour</h2>
<p>Pour mettre à jour : télécharger la nouvelle version et remplacer l'ancien fichier HTML. Vos données (comptes, stats) sont stockées dans le navigateur (localStorage) et seront conservées.</p>
<p style="color:#888;font-size:12px;margin-top:40px;border-top:1px solid #e2e8f0;padding-top:15px;">© AlphaBot Pro — Ce document est fourni à titre informatif uniquement et ne constitue pas un conseil financier.</p>
</body></html>`;

const generateRisksHTML = () => `
<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><title>Risques — AlphaBot Pro</title>
<style>body{font-family:Arial,sans-serif;max-width:800px;margin:40px auto;padding:0 20px;color:#1a202c;}
h1{color:#e53e3e;border-bottom:3px solid #e53e3e;padding-bottom:10px;}
h2{color:#e53e3e;margin-top:30px;}
.box{background:#fff5f5;border:1px solid #fed7d7;padding:16px;margin:15px 0;border-radius:8px;}
.gold{background:#fffbeb;border:1px solid #F0B90B;padding:16px;margin:15px 0;border-radius:8px;}</style></head><body>
<h1>⚠️ Document Risques & Avertissements Légaux — AlphaBot Pro</h1>
<div class="box"><h2>1. Nature du Service</h2>
<p>AlphaBot Pro est un outil d'analyse algorithmique à usage informatif. Il <b>n'est pas</b> un conseiller en investissement agréé au sens de la réglementation financière. Les signaux générés sont le résultat d'algorithmes automatiques et ne constituent <b>en aucun cas</b> des recommandations d'achat ou de vente.</p></div>
<div class="box"><h2>2. Risque de Perte en Capital</h2>
<p>Le trading de crypto-actifs, notamment sur les marchés à effet de levier (Futures), comporte un risque très élevé de perte partielle ou totale du capital investi. Il est possible de perdre plus que son investissement initial. N'investissez que des sommes que vous pouvez vous permettre de perdre intégralement.</p></div>
<div class="box"><h2>3. Performances Non Garanties</h2>
<p><b>Les performances passées ne préjugent pas des performances futures.</b> Les résultats affichés en démo ou en mode test ne reflètent pas nécessairement les performances réelles. Les conditions de marché varient constamment.</p></div>
<div class="box"><h2>4. Responsabilité</h2>
<p>AlphaBot Pro et ses opérateurs <b>déclinent toute responsabilité</b> pour toute perte financière, directe ou indirecte, résultant de l'utilisation de cette plateforme. L'utilisateur est seul responsable de ses décisions de trading et de leur exécution.</p></div>
<div class="gold"><h2>5. Réglementation</h2>
<p>Les crypto-actifs ne sont pas des instruments financiers réglementés dans toutes les juridictions. Vérifiez la légalité du trading de crypto-actifs dans votre pays. AlphaBot Pro ne peut être tenu responsable de l'utilisation non conforme à la réglementation locale.</p></div>
<p>En utilisant AlphaBot Pro, vous attestez avoir lu, compris et accepté l'intégralité de ces avertissements.</p>
<p style="color:#888;font-size:11px;margin-top:30px;">Document généré le ${new Date().toLocaleDateString('fr-FR')} — AlphaBot Pro v30</p>
</body></html>`;

const generateDeployHTML = () => `
<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><title>Guide Déploiement — AlphaBot Pro</title>
<style>body{font-family:Arial,sans-serif;max-width:800px;margin:40px auto;padding:0 20px;color:#1a202c;}
h1{color:#0ecb81;border-bottom:3px solid #0ecb81;padding-bottom:10px;}
h2{color:#1890ff;margin-top:25px;}
.step{display:flex;gap:15px;margin:12px 0;align-items:flex-start;}
.num{background:#F0B90B;color:#000;font-weight:bold;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.ok{background:#f0fff4;border-left:4px solid #0ecb81;padding:10px;margin:10px 0;border-radius:4px;}
code{background:#f7f8fa;padding:2px 6px;border-radius:4px;font-size:13px;}</style></head><body>
<h1>🚀 Guide Déploiement AlphaBot Pro v30</h1>
<h2>Option 1 — Netlify Drop (Gratuit · 30 secondes)</h2>
<div class="step"><div class="num">1</div><div>Aller sur <a href="https://app.netlify.com/drop">app.netlify.com/drop</a></div></div>
<div class="step"><div class="num">2</div><div>Glisser-déposer le fichier <code>alphabot_pro_v30.html</code> dans la zone</div></div>
<div class="step"><div class="num">3</div><div>Votre site est en ligne à une adresse type <code>https://xxx.netlify.app</code></div></div>
<div class="ok">✅ Pour mettre à jour : retourner sur Netlify, déployer à nouveau avec le nouveau fichier.</div>
<h2>Option 2 — Android / PWA (Sans hébergement)</h2>
<div class="step"><div class="num">1</div><div>Copier <code>alphabot_pro_v30.html</code> sur le téléphone (Bluetooth, USB, email)</div></div>
<div class="step"><div class="num">2</div><div>Ouvrir Chrome Android → Naviguer vers le fichier</div></div>
<div class="step"><div class="num">3</div><div>Menu (⋮) → <b>Ajouter à l'écran d'accueil</b></div></div>
<div class="step"><div class="num">4</div><div>L'application est installée comme une app native</div></div>
<h2>Option 3 — GitHub Pages (Gratuit · Permanent)</h2>
<div class="step"><div class="num">1</div><div>Créer un compte sur <a href="https://github.com">github.com</a></div></div>
<div class="step"><div class="num">2</div><div>Nouveau repository → Uploader <code>alphabot_pro_v30.html</code> renommé en <code>index.html</code></div></div>
<div class="step"><div class="num">3</div><div>Settings → Pages → Source: main branch → Save</div></div>
<div class="step"><div class="num">4</div><div>Votre site : <code>https://votre-username.github.io/nom-repo</code></div></div>
<p style="color:#888;font-size:11px;margin-top:30px;">AlphaBot Pro v30 — Guide Déploiement</p>
</body></html>`;

const downloadDoc = (doc) => {
  const blob = new Blob([doc.content], {type:'text/html;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = doc.title.replace(/[^a-zA-Z0-9]/g,'_')+'_AlphaBotPro.html';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
};

/* ═══════════════════════════════════════════════
   MAIN APP
═══════════════════════════════════════════════ */
function App() {
  const [user,setUser]=useState(()=>lsG('ab24_user',null));
  const [page,setPage]=useState('dashboard');
  const [modal,setModal]=useState(null);
  const [chartPair,setChartPair]=useState('BTCUSDT');
  const [chartTf,setChartTf]=useState('5');
  const [theme,setTheme]=useState(()=>lsG('ab24_theme','dark'));
  const [sidebarOpen,setSidebarOpen]=useState(false);
  const [balModalOpen,setBalModalOpen]=useState(false);

  const [prices,setPrices]=useState({...MKT});
  const [btcT,setBtcT]=useState('RANGE');
  const [session,setSession]=useState(getSess());
  const [dayRisk,setDayRisk]=useState(getDayRisk());
  const [setups,setSetups]=useState([]);
  const [positions,setPositions]=useState(()=>lsG('ab24_pos',[]));
  const [logs,setLogs]=useState([{msg:'AlphaBot Pro v24 — Initialisé avec frais Binance intégrés',type:'inf',ts:ts()}]);
  const [stats,setStats]=useState(()=>lsG('ab24_stats',{wins:0,losses:0,pnl:0,wr:0,totalFees:0}));

  const [botOn,setBotOn]=useState(false);
  const [botDemo,setBotDemo]=useState(true);
  const [balance,setBalance]=useState(()=>lsG('ab24_bal',1000));
  const [risk,setRisk]=useState(()=>lsG('ab24_risk',1.5));
  const [leverage,setLeverage]=useState(()=>lsG('ab24_lev',10));
  const [scoreMin,setScoreMin]=useState(60);
  const [maxMargin,setMaxMargin]=useState(()=>lsG('ab24_maxmargin',100)); // Marge max en USDT
  // SL Follower: s'active à RR1 comme prévu (sécurisé)
  const SL_TRAIL_ACTIVATION_RR = 1.0;

  const [apiKey,setApiKey]=useState(()=>lsG('ab24_ak',''));
  const [apiSec,setApiSec]=useState(()=>lsG('ab24_as',''));
  const [apiOk,setApiOk]=useState(false);
  const [apiMsg,setApiMsg]=useState('');
  const [apiLoad,setApiLoad]=useState(false);
  const [apiFuturesBalance,setApiFuturesBalance]=useState(null); // Vrai solde Binance
  const [discAccepted,setDiscAccepted]=useState(()=>lsG('ab24_disc',false));
  const [showDisc,setShowDisc]=useState(false);
  const [pendingSig,setPendingSig]=useState(null);
  const [toasts,setToasts]=useState([]);
  const [priceSource,setPriceSource]=useState('SIM');
  const [totalUsers]=useState(()=>lsG('ab24_tu',1258));

  const isAdmin = user?.isAdmin || user?.email==='admin@alphabot.pro';
  const openPos = positions.filter(p=>p.status==='open');
  const MAX_POS = 1; // 1 seule position si marge insuffisante, adaptatif
  const getMaxPos = useCallback(() => {
    if(balance>=500) return 3;
    if(balance>=200) return 2;
    return 1; // protection marge
  }, [balance]);
  const MAX_SETUPS = 4;

  useEffect(()=>{
    document.documentElement.setAttribute('data-theme',theme);
    lsS('ab24_theme',theme);
  },[theme]);

  const toast = useCallback((msg,type='info',duration=4000)=>{
    const id=Date.now();
    setToasts(p=>[...p,{id,msg,type}]);
    setTimeout(()=>setToasts(p=>p.filter(t=>t.id!==id)),duration);
  },[]);

  const log = useCallback((msg,type='inf')=>{
    setLogs(p=>[{msg,type,ts:ts()},...p].slice(0,150));
  },[]);

  /* Market tick */
  useEffect(()=>{
    const t=setInterval(()=>{
      tickMarket();
      const snap={};
      PAIRS.forEach(p=>{snap[p]={...MKT[p]};});
      setPrices(snap);
      setPriceSource(PRICE_SOURCE);
      const b=MKT['BTCUSDT'];
      setBtcT(btcTrendCalc(b.price,b.prev));
      setSession(getSess());
      setDayRisk(getDayRisk());
    },2000);
    return ()=>clearInterval(t);
  },[]);

  /* Countdown */
  useEffect(()=>{
    const t=setInterval(()=>{
      setSetups(prev=>prev.map(s=>({...s,validFor:s.validFor-1})).filter(s=>s.validFor>0));
    },1000);
    return ()=>clearInterval(t);
  },[]);

  /* Scanner */
  useEffect(()=>{
    const t=setInterval(()=>{
      const currBtc=btcTrendCalc(MKT['BTCUSDT'].price,MKT['BTCUSDT'].prev);
      const sessOk=true;
      const found=[];
      PAIRS.forEach(pair=>{
        if(Math.random()>0.72){
          const s=makeSetup(pair,currBtc,sessOk);
          if(s.score>=scoreMin) found.push(s);
        }
      });
      if(found.length>0){
        found.sort((a,b)=>b.score-a.score);
        setSetups(prev=>{
          const keep=prev.filter(s=>!found.find(f=>f.pair===s.pair));
          const merged=[...found,...keep].sort((a,b)=>b.score-a.score).slice(0,MAX_SETUPS);
          found.forEach(s=>{
            if(s.score>=82) log(`⭐ Setup ${s.score}/100 — ${s.pair} ${s.side} RR${s.rr}`,'inf');
          });
          return merged;
        });
      }
    },6000);
    return ()=>clearInterval(t);
  },[scoreMin,session,log]);

  /* Bot execution — with session+day filter */
  useEffect(()=>{
    if(!botOn) return;
    const t=setInterval(()=>{
      // Avertissement jour de la semaine (sans blocage)
      const dr=getDayRisk();
      if(!dr.ok){log(`⚠️ ${dr.label} — ${dr.msg}`,'wrn');}
      // Avertissement session Asie (sans blocage)
      if(session==='asia'){log('⚠️ Session Asie — Liquidité réduite, bot actif','wrn');}
      const eligible=setups.filter(s=>s.score>=scoreMin);
      if(!eligible.length) return;
      const maxP=getMaxPos();
      if(openPos.length>=maxP){return;}
      if(!botDemo&&balance<1){log('⛔ Solde insuffisant','dn');return;}
      const sig=eligible[0];
      if(openPos.find(p=>p.pair===sig.pair)) return;
      const price=MKT[sig.pair]?.price||100;
      const slDist=price*0.008;
      const sl=sig.side==='BUY'?price-slDist:price+slDist;
      const tp2=sig.side==='BUY'?price+slDist*parseFloat(sig.rr):price-slDist*parseFloat(sig.rr);
      const riskAmt=balance*risk/100;
      const notional=riskAmt*(leverage||10)/slDist*price;
      // Calcul des frais réels
      const estimatedFees=calcFeesForTrade(notional);
      const liqPrice=calcLiqPrice(sig.side,price,leverage||10);
      const newPos={
        id:Date.now(),pair:sig.pair,side:sig.side,
        entry:price,sl,sl0:sl,tp2,riskAmt,rr:sig.rr,
        status:'open',trailActive:false,rrR:0,
        demo:botDemo,ts:ts(),
        estimatedFees,liqPrice,notional,leverage:leverage||10
      };
      setPositions(p=>{const n=[...p,newPos];lsS('ab24_pos',n);return n;});
      log(`${sig.side==='BUY'?'🟢':'🔴'} ENTRÉE${botDemo?' [DEMO]':''}: ${sig.pair} @ ${fmtP(price)} RR${sig.rr} Fees:~${estimatedFees.toFixed(2)}$`,sig.side==='BUY'?'up':'dn');
    },10000);
    return ()=>clearInterval(t);
  },[botOn,setups,openPos,balance,risk,scoreMin,botDemo,session,log,leverage,getMaxPos]);

  /* Position manager — SL Follower à RR1.0 */
  useEffect(()=>{
    const t=setInterval(()=>{
      setPositions(prev=>{
        let changed=false;
        const next=prev.map(p=>{
          if(p.status!=='open') return p;
          const cur=MKT[p.pair]?.price;
          if(!cur) return p;
          let np={...p};
          const dist=Math.abs(p.entry-p.sl0);
          const rrCur=p.side==='BUY'?(cur-p.entry)/dist:(p.entry-cur)/dist;
          np.rrR=Math.max(0,Math.min(4,rrCur));
          // SL Follower s'active exactement à RR 1.0 (sécurisé avec bénéfice = break-even)
          if(rrCur>=SL_TRAIL_ACTIVATION_RR&&!np.trailActive){
            np.sl=np.entry; // Move to break-even
            np.trailActive=true;
            changed=true;
            log(`🔒 Break-even activé: ${p.pair} @ RR${SL_TRAIL_ACTIVATION_RR}`,'inf');
          }
          // Trailing continue au-delà de RR1
          if(np.trailActive){
            const tr=dist*0.5;
            if(p.side==='BUY'){const ns=cur-tr;if(ns>np.sl){np.sl=ns;changed=true;}}
            else{const ns=cur+tr;if(ns<np.sl){np.sl=ns;changed=true;}}
          }
          if((p.side==='BUY'&&cur<=np.sl)||(p.side==='SELL'&&cur>=np.sl)){
            np.status='closed';np.exitPrice=cur;
            // DÉDUCTION FRAIS BINANCE sur les pertes ET gains
            const grossPnl=np.trailActive?0:-p.riskAmt;
            const netPnl=grossPnl-(p.estimatedFees||0);
            np.pnl=netPnl; np.result=np.trailActive?'BE':'LOSS';changed=true;
            setBalance(b=>{const nb=b+netPnl;lsS('ab24_bal',nb);return nb;});
            setStats(s=>{const ns={...s,losses:np.trailActive?s.losses:s.losses+1,pnl:s.pnl+netPnl,totalFees:(s.totalFees||0)+(p.estimatedFees||0),wr:Math.round(s.wins/(s.wins+(np.trailActive?s.losses:s.losses+1))*100)};lsS('ab24_stats',ns);return ns;});
            log(`${np.trailActive?'🔒 BE':'❌ SL'}: ${p.pair} net:${netPnl.toFixed(2)}$ (fees:-${(p.estimatedFees||0).toFixed(2)}$)`,'dn');
          } else if((p.side==='BUY'&&cur>=p.tp2)||(p.side==='SELL'&&cur<=p.tp2)){
            const grossProfit=p.riskAmt*parseFloat(p.rr);
            const netProfit=grossProfit-(p.estimatedFees||0); // Déduction frais
            np.status='closed';np.exitPrice=cur;np.pnl=netProfit;np.result='WIN';changed=true;
            setBalance(b=>{const nb=b+netProfit;lsS('ab24_bal',nb);return nb;});
            setStats(s=>{const ns={...s,wins:s.wins+1,pnl:s.pnl+netProfit,totalFees:(s.totalFees||0)+(p.estimatedFees||0),wr:Math.round((s.wins+1)/(s.wins+1+s.losses)*100)};lsS('ab24_stats',ns);return ns;});
            log(`✅ TP: ${p.pair} net:+${netProfit.toFixed(2)}$ (fees:-${(p.estimatedFees||0).toFixed(2)}$)`,'up');
          }
          return np;
        });
        if(changed){lsS('ab24_pos',next);return next;}
        return prev;
      });
    },3000);
    return ()=>clearInterval(t);
  },[log]);

  /* Binance API test — récupère le vrai solde */
  const testApi = async () => {
    if(!apiKey||!apiSec){setApiMsg('Entrez vos clés API');return;}
    if(!discAccepted){setShowDisc(true);return;}
    setApiLoad(true); setApiMsg('');
    lsS('ab24_ak',apiKey); lsS('ab24_as',apiSec);
    try {
      const ts2=Date.now();
      const params=`timestamp=${ts2}`;
      const sig=await hmac256(apiSec,params);
      const res=await fetch(`https://fapi.binance.com/fapi/v2/account?${params}&signature=${sig}`,{
        headers:{'X-MBX-APIKEY':apiKey}
      });
      const data=await res.json();
      if(data.totalWalletBalance!==undefined){
        const bal=parseFloat(data.totalWalletBalance);
        setApiOk(true);
        setApiFuturesBalance(bal);
        setBalance(bal); // Sync balance avec le vrai compte
        setApiMsg(`✅ Connecté — Wallet: ${bal.toFixed(2)} USDT | Margin: ${parseFloat(data.totalMarginBalance).toFixed(2)} USDT`);
        log(`🔌 API Binance Futures connectée — Solde: ${bal.toFixed(2)} USDT`,'up');
        toast('API Binance connectée !','success');
      } else {
        setApiOk(false);
        setApiMsg(`❌ ${data.msg||'Clés invalides ou permissions insuffisantes'}`);
        log('⛔ Connexion API échouée','dn');
      }
    } catch(e) {
      const ok=apiKey.length>12&&apiSec.length>12;
      setApiOk(ok);
      if(ok){
        const simBal=(Math.random()*500+100);
        setApiFuturesBalance(simBal);
        setApiMsg(`✅ Simulé (CORS) — Déployez sur VPS pour connexion réelle\nFutures: ${simBal.toFixed(2)} USDT`);
        log('🔌 API simulée (CORS) — VPS requis pour connexion réelle','wrn');
        toast('Connexion simulée. VPS requis.','warn');
      } else {
        setApiMsg('❌ Erreur réseau. Vérifiez vos clés ou déployez sur VPS.');
        log('⛔ Erreur API: '+e.message,'dn');
      }
    }
    setApiLoad(false);
  };

  const [tradeConfirm,setTradeConfirm]=useState(null); // {sig, price, sl, tp, riskAmt, qty, estimatedFees}

  const executeSignal = async (sig) => {
    if(!apiOk){toast('Connectez votre API Binance d\'abord','error');return;}
    if(botDemo){
      // Démo: exécuter directement sans confirmation réelle
      const price=MKT[sig.pair]?.price||100;
      const slDist=price*0.008;
      const sl=sig.side==='BUY'?price-slDist:price+slDist;
      const tp=sig.side==='BUY'?price+slDist*parseFloat(sig.rr):price-slDist*parseFloat(sig.rr);
      const riskAmt=Math.min(balance*risk/100, maxMargin);
      const estimatedFees=calcFeesForTrade(riskAmt*(leverage||10));
      const liqPrice=calcLiqPrice(sig.side,price,leverage||10);
      const newPos={id:Date.now(),pair:sig.pair,side:sig.side,entry:price,sl,sl0:sl,tp2:tp,riskAmt,rr:sig.rr,status:'open',trailActive:false,rrR:0,demo:true,ts:ts(),estimatedFees,liqPrice,notional:riskAmt*(leverage||10),leverage:leverage||10};
      setPositions(p=>{const n=[...p,newPos];lsS('ab24_pos',n);return n;});
      log(`🎮 Position démo: ${sig.pair} ${sig.side} @ ${fmtP(price)} (marge: ${riskAmt.toFixed(2)}$)`,'inf');
      toast(`Position démo ouverte: ${sig.pair} ${sig.side}`,'info');
      return;
    }
    if(!discAccepted){setPendingSig(sig);setShowDisc(true);return;}
    // Mode réel: afficher la confirmation obligatoire
    const price=MKT[sig.pair]?.price||100;
    const slDist=price*0.008;
    const sl=sig.side==='BUY'?price-slDist:price+slDist;
    const tp=sig.side==='BUY'?price+slDist*parseFloat(sig.rr):price-slDist*parseFloat(sig.rr);
    const riskAmt=Math.min(balance*risk/100, maxMargin);
    const qty=Math.max((riskAmt/slDist).toFixed(6),0.001);
    const estimatedFees=calcFeesForTrade(riskAmt*(leverage||10));
    setTradeConfirm({sig, price, sl, tp, riskAmt, qty, estimatedFees});
  };

  const doExecuteReal = async () => {
    if(!tradeConfirm) return;
    const {sig, price, sl, tp, riskAmt, qty, estimatedFees} = tradeConfirm;
    setTradeConfirm(null);
    log(`📤 Envoi ordre RÉEL ${sig.pair} ${sig.side} qty:${qty} marge:${riskAmt.toFixed(2)}$ fees:~${estimatedFees.toFixed(2)}$`,'inf');
    try {
      const timestamp2=Date.now();
      const params=new URLSearchParams({symbol:sig.pair,side:sig.side,type:'MARKET',quantity:qty,timestamp:timestamp2});
      const sig2=await hmac256(apiSec,params.toString());
      params.append('signature',sig2);
      const res=await fetch('https://fapi.binance.com/fapi/v1/order',{
        method:'POST',headers:{'X-MBX-APIKEY':apiKey,'Content-Type':'application/x-www-form-urlencoded'},body:params
      });
      const data=await res.json();
      if(data.orderId){
        log(`✅ Ordre ${data.orderId} exécuté — ${sig.pair}@market`,'up');
        toast(`Ordre exécuté sur Binance ! ${sig.pair} ${sig.side}`,'success');
      } else {
        log(`❌ Erreur Binance: ${data.msg}`,'dn');
        toast(`Erreur: ${data.msg}`,'error');
      }
    } catch(e){
      log(`⚠ CORS — Ordre simulé: ${sig.pair} ${sig.side} @ ${fmtP(price)}`,'wrn');
      toast(`Ordre simulé (VPS requis pour ordres réels)`,'warn');
      const liqPrice=calcLiqPrice(sig.side,price,leverage||10);
      const newPos={
        id:Date.now(),pair:sig.pair,side:sig.side,
        entry:price,sl,sl0:sl,tp2:tp,riskAmt,rr:sig.rr,
        status:'open',trailActive:false,rrR:0,demo:false,ts:ts(),
        estimatedFees,liqPrice,notional:riskAmt*(leverage||10),leverage:leverage||10
      };
      setPositions(p=>{const n=[...p,newPos];lsS('ab24_pos',n);return n;});
    }
  };

  const openChart=(pair,tf='5')=>{setChartPair(pair);setChartTf(tf);setModal('chart');};
  const copyToClipboard=(text,msg='Copié !')=>{
    copyUniversal(text).then(()=>toast(msg,'success',2000)).catch(()=>toast('Ctrl+C pour copier','warn',3000));
  };

  const refLink=`${window.location.origin}${window.location.pathname}?ref=${user?.refCode||''}`;
  const btcP=prices['BTCUSDT']||{price:68420,prev:68420};
  const btcChg=(btcP.price-btcP.prev)/btcP.prev*100;

  if(!user) return <Auth setUser={setUser} totalUsers={totalUsers}/>;

  return (
    <div className="shell">
      {/* BALANCE QUICK MODAL */}
      {balModalOpen&&(
        <>
          <div style={{position:'fixed',inset:0,zIndex:290}} onClick={()=>setBalModalOpen(false)}/>
          <div className="bal-modal">
            <div className="bal-modal-title">💰 Modifier le solde de test</div>
            <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'26px',fontWeight:800,color:'var(--gold)',marginBottom:'10px',textAlign:'center'}}>
              {balance.toFixed(2)} $
            </div>
            <div style={{display:'flex',gap:'5px',flexWrap:'wrap',marginBottom:'10px'}}>
              {[100,500,1000,5000,10000].map(p=>(
                <button key={p} onClick={()=>{setBalance(p);lsS('ab24_bal',p);toast(`Solde → ${p}$`,'success',2000);}}
                  style={{flex:1,minWidth:'50px',padding:'6px 4px',fontSize:'11px',fontFamily:"'Rajdhani',sans-serif",fontWeight:700,
                    background:Math.abs(balance-p)<0.5?'var(--gold)':'var(--bg3)',
                    color:Math.abs(balance-p)<0.5?'#000':'var(--tx1)',
                    border:`1px solid ${Math.abs(balance-p)<0.5?'var(--gold)':'var(--bd)'}`,
                    borderRadius:'5px',cursor:'pointer'}}>
                  {p>=1000?`${p/1000}K$`:`${p}$`}
                </button>
              ))}
            </div>
            <div style={{display:'flex',gap:'6px'}}>
              <input type="number" min="1" placeholder="Montant custom"
                className="inp" style={{flex:1,fontSize:'13px'}}
                onKeyDown={e=>{if(e.key==='Enter'){const v=parseFloat(e.target.value);if(v>=1){setBalance(v);lsS('ab24_bal',v);toast(`Solde → ${v}$`,'success',2000);setBalModalOpen(false);}}}}/>
              <button className="btn btn-gold" onClick={()=>setBalModalOpen(false)}>OK</button>
            </div>
            <div style={{fontSize:'9px',color:'var(--tx2)',marginTop:'6px'}}>Appuyez Entrée pour confirmer · Mode démo uniquement</div>
          </div>
        </>
      )}

      {/* TOASTS */}
      <div className="toast-container">
        {toasts.map(t=>(
          <div key={t.id} className={`toast ${t.type}`}>{t.msg}</div>
        ))}
      </div>

      {/* TRADE CONFIRMATION MODAL — MODE RÉEL */}
      {tradeConfirm&&(
        <div className="modal-bg" onClick={()=>setTradeConfirm(null)}>
          <div className="modal-box trade-confirm-modal" onClick={e=>e.stopPropagation()}>
            {/* Header coloré selon direction */}
            <div className={`tc-header ${tradeConfirm.sig.side==='BUY'?'tc-header-long':'tc-header-short'}`}>
              <div>
                <div style={{fontSize:'10px',color:'var(--tx2)',letterSpacing:'1.5px',textTransform:'uppercase',marginBottom:'5px'}}>⚡ CONFIRMER L'ORDRE RÉEL</div>
                <div style={{display:'flex',alignItems:'center',gap:'10px'}}>
                  <span className={`tc-badge ${tradeConfirm.sig.side==='BUY'?'sl':'ss'}`}>
                    {tradeConfirm.sig.side==='BUY'?'▲ LONG':'▼ SHORT'}
                  </span>
                  <span className="tc-pair">{tradeConfirm.sig.pair.replace('USDT','/USDT')}</span>
                </div>
              </div>
              <div style={{marginLeft:'auto',textAlign:'right'}}>
                <div style={{fontSize:'8px',color:'var(--tx2)',marginBottom:'3px'}}>SCORE SIGNAL</div>
                <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'20px',fontWeight:800,color:tradeConfirm.sig.score>=80?'var(--up)':'var(--gold)'}}>{tradeConfirm.sig.score}</div>
              </div>
            </div>

            {/* Détails de l'ordre */}
            <div style={{paddingTop:'4px'}}>
              {[
                ['Prix d\'entrée', fmtP(tradeConfirm.price)],
                ['Stop Loss', fmtP(tradeConfirm.sl), 'cdn'],
                ['Take Profit', fmtP(tradeConfirm.tp), 'cup'],
                ['Marge utilisée', `${tradeConfirm.riskAmt.toFixed(2)} USDT`, 'cgold'],
                ['Levier', `${leverage}x`, ''],
                ['Quantité', tradeConfirm.qty, ''],
                ['Frais estimés', `~${tradeConfirm.estimatedFees.toFixed(3)} USDT`, 'cdn'],
                ['Risk/Reward', `1 : ${tradeConfirm.sig.rr}`, 'cup'],
              ].map(([l,v,cls=''])=>(
                <div key={l} className="tc-row">
                  <span className="lbl">{l}</span>
                  <span className={`val ${cls}`}>{v}</span>
                </div>
              ))}
            </div>

            {/* Disclaimer obligatoire */}
            <div className="tc-disclaimer">
              <b style={{color:'var(--gold)'}}>⚖️ AVERTISSEMENT LÉGAL :</b> Cet ordre sera exécuté sur votre compte Binance Futures en argent réel. AlphaBot Pro est un outil d'analyse algorithmique et <b>ne constitue pas un conseil financier</b>. Les performances passées <b>ne garantissent pas les résultats futurs</b>. Le bot fournit une appréciation du marché à l'instant T uniquement. <b>Vous êtes seul(e) responsable de cette décision.</b> La perte maximale est limitée à votre Stop Loss.
            </div>

            <div className="tc-btns">
              <button className="tc-cancel" onClick={()=>setTradeConfirm(null)}>✕ Annuler</button>
              <button className={tradeConfirm.sig.side==='BUY'?'tc-confirm-long':'tc-confirm-short'} onClick={doExecuteReal}>
                {tradeConfirm.sig.side==='BUY'?'✅ CONFIRMER LONG ▲':'✅ CONFIRMER SHORT ▼'}
              </button>
            </div>
          </div>
        </div>
      )}

      {/* DISCLAIMER */}
      {showDisc&&(
        <DisclaimerModal
          onAccept={()=>{
            setDiscAccepted(true);lsS('ab24_disc',true);setShowDisc(false);
            if(pendingSig){executeSignal(pendingSig);setPendingSig(null);}
            else testApi();
          }}
          onClose={()=>{setShowDisc(false);setPendingSig(null);}}
        />
      )}

      {/* TOPBAR */}
      <div className="topbar">
        {/* Hamburger - visible on mobile */}
        <button className={`hamburger-btn${sidebarOpen?' open':''}`} onClick={()=>setSidebarOpen(o=>!o)}>
          <div className="hb-line"/>
          <div className="hb-line"/>
          <div className="hb-line"/>
        </button>
        <div className="t-logo">
          <div className="t-hex">A</div>
          <span className="t-name">ALPHA<span>BOT</span></span>
          <span className="t-ver">v31 PRO</span>
        </div>
        <div className="t-stats">
          <div className="tstat">
            <div className="tstat-l">BTC</div>
            <div className="tstat-v" style={{color:btcChg>=0?'var(--up)':'var(--dn)'}}>{fmtP(btcP.price)}</div>
          </div>
          <div className="tstat">
            <div className="tstat-l">Signaux</div>
            <div className="tstat-v" style={{color:'var(--gold)'}}>{setups.length}/{MAX_SETUPS}</div>
          </div>
          <div className="tstat">
            <div className="tstat-l">Positions</div>
            <div className="tstat-v">{openPos.length}<span className="tx2">/{getMaxPos()}</span></div>
          </div>
          <div className="tstat" onClick={()=>setBalModalOpen(o=>!o)} style={{cursor:'pointer'}} title="Cliquez pour modifier">
            <div className="tstat-l">Balance ✏️</div>
            <div className="tstat-v mono" style={{color:balance>=1000?'var(--up)':'var(--gold)'}}>{balance.toFixed(0)}$</div>
          </div>
          <div className="tstat">
            <div className="tstat-l">PnL NET session</div>
            <div className="tstat-v mono" style={{color:stats.pnl>=0?'var(--up)':'var(--dn)'}}>{stats.wins+stats.losses===0?'—':(stats.pnl>=0?'+':'')+stats.pnl.toFixed(2)+'$'}</div>
          </div>
          <div className="tstat">
            <div className="tstat-l">WR {stats.wins+stats.losses>0?`(${stats.wins}W/${stats.losses}L)`:''}</div>
            <div className="tstat-v mono" style={{color:stats.wins+stats.losses===0?'var(--tx2)':stats.wr>=60?'var(--up)':stats.wr>=40?'var(--gold)':'var(--dn)'}}>{stats.wins+stats.losses===0?'—':stats.wr+'%'}</div>
          </div>
          <div className="tstat">
            <div className="tstat-l">Session</div>
            <div className="tstat-v" style={{color:session==='asia'?'var(--dn)':'var(--up)',fontSize:'10px'}}>{sessLbl[session]}</div>
          </div>
          {isAdmin&&(
            <div className="tstat">
              <div className="tstat-l">Mode</div>
              <div className="tstat-v" style={{color:'var(--purple)'}}>ADMIN</div>
            </div>
          )}
        </div>
        <div className="t-right">
          {/* Mode Démo / Réel switch */}
          <div className="mode-switch-pill">
            <button className={`msw-btn msw-demo${botDemo?' act':''}`}
              onClick={()=>{ setBotDemo(true); log('🎮 Mode Démo activé','wrn'); }}>
              DÉMO
            </button>
            <button className={`msw-btn msw-real${!botDemo?' act':''}`}
              onClick={()=>{
                if(!discAccepted){setShowDisc(true);return;}
                setBotDemo(false); log('⚡ Mode Réel activé','wrn');
              }}>
              RÉEL
            </button>
          </div>
          <button className="theme-btn" onClick={()=>setTheme(t=>t==='dark'?'light':'dark')} title="Thème">
            {theme==='dark'?'☀️':'🌙'}
          </button>
          <div className={`api-pill ${apiOk?'api-on':'api-off'}`} onClick={()=>setModal('settings')}>
            <span className="apidot"/>
            {apiOk?`API ON${apiFuturesBalance?` · ${apiFuturesBalance.toFixed(0)}$`:''}` : 'API OFF'}
          </div>
          <div className="user-chip" onClick={()=>setPage('account')}>
            <div className="uav">{user.email[0].toUpperCase()}</div>
            <span className="f11 wnw">{user.email.split('@')[0]}</span>
          </div>
        </div>
      </div>

      <div className="body-row">
        {/* SIDEBAR OVERLAY — mobile */}
        {sidebarOpen&&<div className="sidebar-overlay" onClick={()=>setSidebarOpen(false)}/>}
        {/* SIDEBAR */}
        <div className={`sidebar${sidebarOpen?' open':''}`}>
          {/* BOT CONTROL — EN HAUT À GAUCHE */}
          <div style={{padding:'8px'}}>
            <div className="bot-box">
              <div className="bot-txt">🤖 Bot Contrôle</div>

              {/* Mini solde dans sidebar */}
              <div className="bot-balance-row" style={{background:'rgba(240,185,11,.07)',border:'1px solid rgba(240,185,11,.15)',borderRadius:'6px',padding:'7px 9px',marginBottom:'7px'}}>
                <div style={{fontSize:'7px',color:'var(--tx2)',letterSpacing:'1.5px',textTransform:'uppercase',marginBottom:'3px'}}>SOLDE</div>
                <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'15px',fontWeight:800,color:'var(--gold)'}}>{balance.toFixed(0)}<span style={{fontSize:'9px',color:'var(--tx2)',marginLeft:'2px'}}>$</span></div>
                <div style={{fontSize:'8px',color:stats.pnl>=0?'var(--up)':'var(--dn)',marginTop:'2px',fontFamily:"'JetBrains Mono',monospace"}}>
                  PnL {stats.wins+stats.losses===0?'—':(stats.pnl>=0?'+':'')+stats.pnl.toFixed(0)+'$'}
                </div>
              </div>

              {/* API Status */}
              <div className={`api-sidebar-status ${apiOk?'api-sb-on':'api-sb-off'}`}>
                <span style={{fontSize:'8px'}}>{apiOk?'●':'○'}</span>
                <div style={{flex:1}}>
                  <div>{apiOk?'API CONNECTÉE':'API HORS LIGNE'}</div>
                  {apiOk&&apiFuturesBalance&&(
                    <div className="api-sb-bal">{apiFuturesBalance.toFixed(2)} USDT</div>
                  )}
                </div>
                <span style={{fontSize:'10px',cursor:'pointer',color:'var(--tx2)'}} onClick={()=>setModal('settings')}>⚙</span>
              </div>

              <div className="bot-mode-row" style={{marginBottom:'7px'}}>
                <span className="f9 tx2">Mode</span>
                <div className={`f10 bold ${botDemo?'cgold':'cup'}`}>{botDemo?'🎮 DÉMO':'⚡ RÉEL'}</div>
              </div>

              <div className={`bot-status${botOn?' live':''}`} style={{marginBottom:'7px'}}>
                {botOn?`● ACTIF — ${botDemo?'DÉMO':'RÉEL'} — ${openPos.length}/${getMaxPos()}`:'○ Inactif'}
              </div>

              <button className={`bot-toggle ${botOn?'bt-on':'bt-off'}`} onClick={()=>{
                setBotOn(!botOn);
                log(botOn?'⏹ Bot arrêté':'▶ Bot démarré',botOn?'wrn':'up');
                if(!botOn) toast('Bot démarré !','success');
              }}>
                {botOn?'⏹ ARRÊTER':'▶ DÉMARRER'}
              </button>

              {botOn&&(session==='asia'||!dayRisk.ok)&&(
                <div style={{marginTop:'7px',background:'rgba(240,185,11,.08)',border:'1px solid rgba(240,185,11,.2)',borderRadius:'5px',padding:'5px 7px',fontSize:'8px',color:'var(--gold)'}}>
                  ⚠️ ACTIF · Vol. réduit
                </div>
              )}

              <div className="score-row" style={{marginTop:'8px'}}>
                <div className="score-label">
                  <span>Score min</span>
                  <span>{scoreMin}</span>
                </div>
                <input type="range" min="60" max="90" value={scoreMin} onChange={e=>setScoreMin(+e.target.value)} className="slider"/>
              </div>

              {/* Mini WR dans sidebar */}
              <div className="bot-balance-row" style={{marginTop:'8px',background:'var(--bg3)',border:'1px solid var(--bd)',borderRadius:'6px',padding:'7px 9px'}}>
                <div style={{display:'flex',justifyContent:'space-between',fontSize:'8px',color:'var(--tx2)',marginBottom:'4px'}}>
                  <span>WIN RATE</span>
                  <span style={{color:stats.wins+stats.losses===0?'var(--tx2)':stats.wr>=60?'var(--up)':stats.wr>=40?'var(--gold)':'var(--dn)',fontFamily:"'JetBrains Mono',monospace",fontWeight:700}}>
                    {stats.wins+stats.losses===0?'—':stats.wr+'%'}
                  </span>
                </div>
                <div style={{height:'3px',background:'var(--bg)',borderRadius:'2px',overflow:'hidden'}}>
                  <div style={{width:stats.wins+stats.losses===0?'0%':`${stats.wr}%`,height:'100%',background:stats.wr>=60?'var(--up)':stats.wr>=40?'var(--gold)':'var(--dn)',transition:'width .6s'}}/>
                </div>
                <div style={{fontSize:'7px',color:'var(--tx2)',marginTop:'4px'}}>{stats.wins}W · {stats.losses}L · {stats.wins+stats.losses} trades</div>
              </div>
            </div>
          </div>

          <div className="sgroup">
            <div className="sgroup-lbl">Navigation</div>
            {[
              {id:'dashboard',icon:'📊',lbl:'Dashboard'},
              {id:'signals',  icon:'📡',lbl:'Signaux',    badge:setups.length||null},
              {id:'scanner',  icon:'🔍',lbl:'Scanner'},
              {id:'positions',icon:'📂',lbl:'Positions',  badge:openPos.length||null},
              {id:'history',  icon:'📈',lbl:'Historique'},
              {id:'news',     icon:'📰',lbl:'Fondamentaux'},
              {id:'canal',    icon:'📺',lbl:'Canal'},
              {id:'abonnement',icon:'💎',lbl:'Abonnement', badge:'SOON',btype:'warn'},
              {id:'account',  icon:'👤',lbl:'Mon Compte'},
              ...(isAdmin?[{id:'admin',icon:'⚙️',lbl:'Admin',badge:'•',btype:'warn'}]:[]),
            ].map(n=>(
              <div key={n.id} className={`sitem${page===n.id?' act':''}`} onClick={()=>{setPage(n.id);setSidebarOpen(false);}}>
                <span className="sitem-icon">{n.icon}</span>
                <span className="sitem-lbl">{n.lbl}</span>
                {n.badge&&<span className={`sitem-badge${n.btype?' '+n.btype:''}`}>{n.badge}</span>}
              </div>
            ))}
          </div>

          <div className="sidebar-context">
            <div className="ctx-mini">
              <div className="ctx-mini-lbl">BTC Tendance</div>
              <div className="flex g6">
                <span style={{fontSize:'16px'}}>₿</span>
                <div>
                  <div className="mono f11 bold">{fmtP(btcP.price)}</div>
                  <div className={`f10 bold ${btcT==='BULL'?'cup':btcT==='BEAR'?'cdn':'cgold'}`}>{btcT}</div>
                </div>
              </div>
            </div>
            <div className="ctx-mini">
              <div className="ctx-mini-lbl">Jour / Session</div>
              <div className={`f10 bold ${dayRisk.level==='safe'?'cup':dayRisk.level==='warn'?'cgold':'cdn'}`}>{dayRisk.label}</div>
              <div className="f9 tx2" style={{marginTop:'2px'}}>{sessLbl[session]}</div>
            </div>
          </div>
        </div>

        {/* MAIN CONTENT */}
        <div className="main">
          <div className="pad">

            {/* ═════ DASHBOARD ═════ */}
            {page==='dashboard'&&<>

              {/* ① CARTE SOLDE + STATS — TOUT EN HAUT */}
              <div className="dash-anim-1" style={{background:'var(--bg2)',border:'1px solid var(--bd)',borderRadius:'12px',overflow:'hidden'}}>
                {/* Ligne solde principal */}
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',background:'var(--bg3)',borderBottom:'1px solid var(--bd)'}}>
                  <div style={{padding:'14px 16px',borderRight:'1px solid var(--bd)'}}>
                    <div style={{fontSize:'8px',color:'var(--tx2)',letterSpacing:'2px',textTransform:'uppercase',marginBottom:'5px'}}>
                      💰 SOLDE {apiOk?'BINANCE':'DÉMO'}
                    </div>
                    <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'24px',fontWeight:800,color:'var(--gold)',lineHeight:1}}>{balance.toFixed(2)}<span style={{fontSize:'13px',color:'var(--tx2)',marginLeft:'4px'}}>$</span></div>
                    <div style={{fontSize:'9px',color:'var(--tx2)',marginTop:'4px'}}>{botDemo?'Mode Démo':'Mode Réel'} · Risque {risk.toFixed(1)}%/trade</div>
                  </div>
                  <div style={{padding:'14px 16px',borderRight:'1px solid var(--bd)'}}>
                    <div style={{fontSize:'8px',color:'var(--tx2)',letterSpacing:'2px',textTransform:'uppercase',marginBottom:'5px'}}>📈 PnL NET GLOBAL</div>
                    <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'24px',fontWeight:800,color:stats.pnl>=0?'var(--up)':'var(--dn)',lineHeight:1}}>
                      {stats.wins+stats.losses===0?'—':(stats.pnl>=0?'+':'')+stats.pnl.toFixed(2)+'$'}
                    </div>
                    <div style={{fontSize:'9px',color:'var(--tx2)',marginTop:'4px'}}>Brut {stats.wins+stats.losses>0?(((stats.pnl+(stats.totalFees||0))>=0?'+':'')+((stats.pnl+(stats.totalFees||0)).toFixed(2))+'$'):'—'} · Frais -{(stats.totalFees||0).toFixed(2)}$</div>
                  </div>
                  <div style={{padding:'14px 16px'}}>
                    <div style={{fontSize:'8px',color:'var(--tx2)',letterSpacing:'2px',textTransform:'uppercase',marginBottom:'5px'}}>🎯 WIN RATE</div>
                    <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'24px',fontWeight:800,lineHeight:1,color:stats.wins+stats.losses===0?'var(--tx2)':stats.wr>=60?'var(--up)':stats.wr>=40?'var(--gold)':'var(--dn)'}}>
                      {stats.wins+stats.losses===0?'—':stats.wr+'%'}
                    </div>
                    <div style={{fontSize:'9px',color:'var(--tx2)',marginTop:'4px'}}>{stats.wins}W · {stats.losses}L · {stats.wins+stats.losses} trades</div>
                  </div>
                </div>

                {/* Mini-tableau des trades */}
                <div style={{padding:'0'}}>
                  <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',background:'var(--bg3)',borderBottom:'1px solid var(--bd)'}}>
                    {[
                      ['TRADES','#', stats.wins+stats.losses, stats.wins+stats.losses>0?'cup':'tx2'],
                      ['GAGNANTS','✅', stats.wins, 'cup'],
                      ['PERDANTS','❌', stats.losses, stats.losses>0?'cdn':'tx2'],
                      ['FRAIS','-$', (stats.totalFees||0).toFixed(2)+'$', 'cdn'],
                      ['POSITIONS','📂', `${openPos.length}/${getMaxPos()}`, openPos.length>0?'cup':'tx2'],
                    ].map(([lbl,ic,val,cls])=>(
                      <div key={lbl} style={{padding:'9px 10px',textAlign:'center',borderRight:'1px solid var(--bd)'}}>
                        <div style={{fontSize:'7px',color:'var(--tx2)',letterSpacing:'1.5px',marginBottom:'3px'}}>{lbl}</div>
                        <div className={`mono bold f12 ${cls}`}>{val}</div>
                      </div>
                    ))}
                  </div>
                  {/* Barre progression WR */}
                  {stats.wins+stats.losses>0&&(
                    <div style={{height:'3px',background:'var(--bg)'}}>
                      <div style={{width:`${stats.wr}%`,height:'100%',background:stats.wr>=60?'var(--up)':stats.wr>=40?'var(--gold)':'var(--dn)',transition:'width .6s'}}/>
                    </div>
                  )}
                </div>
              </div>

              {/* ② SESSION WARNING */}
              {(session==='asia'||!dayRisk.ok)?(
                <div className="session-warning dash-anim-2">
                  <span style={{fontSize:'20px'}}>⚠️</span>
                  <div>
                    <div style={{fontWeight:700}}>{session==='asia'?'Session Asie — Liquidité réduite':dayRisk.label}</div>
                    <div style={{fontSize:'10px',marginTop:'2px',opacity:.8}}>{session==='asia'?'Prudence — liquidité réduite, bot actif':dayRisk.msg}</div>
                  </div>
                </div>
              ):(
                <div className="session-safe dash-anim-2">
                  <span style={{fontSize:'20px'}}>✅</span>
                  <div>
                    <div style={{fontWeight:700}}>{dayRisk.label} · {sessLbl[session]}</div>
                    <div style={{fontSize:'10px',marginTop:'2px',opacity:.8}}>Conditions optimales — Bot autorisé à trader</div>
                  </div>
                </div>
              )}

              {/* ③ SOLDE DEMO MODIFIABLE */}
              {botDemo&&!apiOk&&(
                <div className="dash-anim-3">
                <DemoBalanceEditor balance={balance} setBalance={setBalance} stats={stats} setStats={setStats} lsS={lsS} toast={toast} log={log}/>
                </div>
              )}

              {/* ④ BINANCE CONNECTÉ */}
              {apiOk&&apiFuturesBalance&&(
                <div className="balance-card dash-anim-3">
                  <div className="balance-card-title">🔌 Compte Binance Futures Connecté</div>
                  <div className="balance-card-val">{apiFuturesBalance.toFixed(2)} USDT</div>
                  <div className="balance-card-sub">Solde disponible · Mis à jour à chaque connexion API</div>
                  <div className="balance-margin-row">
                    <div className="balance-mini"><div className="balance-mini-val cup">{(apiFuturesBalance*0.8).toFixed(2)}$</div><div className="balance-mini-lbl">Marge dispo</div></div>
                    <div className="balance-mini"><div className="balance-mini-val cgold">{(balance*risk/100).toFixed(2)}$</div><div className="balance-mini-lbl">Risque/trade</div></div>
                    <div className="balance-mini"><div className="balance-mini-val cdn">{calcFeesForTrade(balance*risk/100*leverage).toFixed(3)}$</div><div className="balance-mini-lbl">Frais est.</div></div>
                  </div>
                </div>
              )}

              {/* ⑤ POSITIONS EN COURS */}
              <div className="dash-anim-4">
                <div className="sec-head">
                  <div className="sec-title">
                    <div className="sec-dot" style={{background:openPos.length>0?'var(--up)':'var(--tx2)'}}/>
                    Positions en cours
                  </div>
                  <div style={{display:'flex',gap:'8px',alignItems:'center'}}>
                    <span className={`f10 ${openPos.length>0?'cup':'tx2'}`}>{openPos.length}/{getMaxPos()}</span>
                    {openPos.length>0&&<button className="chart-btn" onClick={()=>setPage('positions')}>Voir tout →</button>}
                  </div>
                </div>
                {openPos.length===0?(
                  <div style={{background:'var(--bg2)',border:'1px solid var(--bd)',borderRadius:'10px',padding:'24px',textAlign:'center',color:'var(--tx2)'}}>
                    <div style={{fontSize:'32px',marginBottom:'8px',opacity:.2}}>📂</div>
                    <div className="f12">Aucune position ouverte</div>
                    <div className="f10 mt4">{botOn?`Bot actif — score ≥${scoreMin} requis · ${session==='asia'?'⚠️ Vol. réduit':'Session OK ✅'}` : 'Démarrez le bot'}</div>
                  </div>
                ):(
                  <div className="pos-grid">
                    {openPos.map(p=><PosCard key={p.id} pos={p} prices={prices} onChart={()=>openChart(p.pair)} leverage={leverage}/>)}
                  </div>
                )}
              </div>

              {/* ⑥ SIGNAUX */}
              {setups.length>0&&(
                <div className="dash-anim-5">
                  <div className="sec-head">
                    <div className="sec-title"><div className="sec-dot" style={{background:'var(--gold)'}}/>Signaux disponibles</div>
                    <button className="chart-btn" onClick={()=>setPage('signals')}>Voir détails →</button>
                  </div>
                  <div style={{display:'flex',flexDirection:'column',gap:'6px'}}>
                    {setups.map(s=>{
                      const pr=prices[s.pair]||{price:0,prev:0};
                      const col=s.score>=82?'var(--up)':s.score>=72?'var(--gold)':'var(--bl)';
                      return (
                        <div key={s.id} className="sig-row-hover" style={{background:'var(--bg2)',border:'1px solid var(--bd)',borderRadius:'8px',padding:'10px 14px',display:'flex',alignItems:'center',gap:'12px',cursor:'pointer'}}
                          onMouseEnter={e=>e.currentTarget.style.borderColor='var(--gold)'}
                          onMouseLeave={e=>e.currentTarget.style.borderColor='var(--bd)'}>
                          <span className={`sc-side ${s.side==='BUY'?'sl':'ss'}`} style={{flexShrink:0}}>{s.side==='BUY'?'L':'S'}</span>
                          <span style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'13px',fontWeight:700,minWidth:'80px'}}>{s.pair.replace('USDT','')}</span>
                          <span style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'12px',flex:1}}>{fmtP(pr.price)}</span>
                          <div style={{display:'flex',alignItems:'center',gap:'6px',minWidth:'80px'}}>
                            <div style={{width:'50px',height:'4px',background:'var(--bg)',borderRadius:'2px',overflow:'hidden'}}>
                              <div style={{width:`${s.score}%`,height:'100%',background:`linear-gradient(90deg,var(--gold),${col})`,borderRadius:'2px'}}/>
                            </div>
                            <span style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'11px',fontWeight:700,color:col}}>{s.score}</span>
                          </div>
                          <span style={{fontSize:'10px',color:'var(--up)',fontWeight:600}}>RR 1:{s.rr}</span>
                          <span style={{fontSize:'9px',color:'var(--gold)',fontFamily:"'JetBrains Mono',monospace"}}>⏱{s.validFor}s</span>
                          <div style={{display:'flex',gap:'5px'}}>
                            <button className="chart-btn" onClick={e=>{e.stopPropagation();openChart(s.pair);}}>📈</button>
                            <button className={`exec-btn ${!botDemo&&apiOk?'exec-live':'exec-demo'}`} onClick={e=>{e.stopPropagation();executeSignal(s);}}>
                              {botDemo?'DÉMO':'⚡'}
                            </button>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}

              {/* ⑦ BOT + API — en bas */}
              <div className="dash-anim-6" style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'12px'}}>
                <div className="ctrl-card">
                  <div className="ctrl-card-title">🤖 Contrôle du Bot</div>
                  <div style={{display:'flex',alignItems:'center',gap:'8px',padding:'8px 12px',borderRadius:'8px',border:'1px solid',marginBottom:'12px',background:botDemo?'rgba(240,185,11,.07)':'rgba(14,203,129,.07)',borderColor:botDemo?'rgba(240,185,11,.3)':'rgba(14,203,129,.3)'}}>
                    <span style={{fontSize:'16px'}}>{botDemo?'🎮':'⚡'}</span>
                    <div>
                      <div style={{fontWeight:700,fontSize:'12px',color:botDemo?'var(--gold)':'var(--up)'}}>{botDemo?'MODE DÉMO':'MODE RÉEL'}</div>
                      <div style={{fontSize:'9px',color:'var(--tx2)'}}>Modifier via le toggle en haut</div>
                    </div>
                  </div>
                  <button className={`ctrl-big-btn ${botOn?'ctrl-stop':'ctrl-start'}`}
                    onClick={()=>{
                      setBotOn(!botOn);
                      log(botOn?'⏹ Bot arrêté':'▶ Bot démarré',botOn?'wrn':'up');
                      if(!botOn) toast('Bot démarré !','success');
                    }}>
                    <span style={{fontSize:'28px'}}>{botOn?'⏹':'▶'}</span>
                    <span>{botOn?'ARRÊTER LE BOT':'DÉMARRER LE BOT'}</span>
                  </button>
                  <div className={`ctrl-status ${botOn?'live':''}`}>
                    {botOn?`● Bot actif — ${botDemo?'DÉMO':'RÉEL'} — ${openPos.length}/${getMaxPos()} pos`: '○ Bot inactif'}
                  </div>
                  <div style={{marginTop:'8px'}}>
                    <div style={{display:'flex',justifyContent:'space-between',fontSize:'10px',color:'var(--tx2)',marginBottom:'4px'}}>
                      <span>Score minimum signaux</span>
                      <span style={{color:'var(--gold)',fontFamily:"'JetBrains Mono',monospace"}}>{scoreMin}/100</span>
                    </div>
                    <input type="range" min="60" max="90" value={scoreMin} onChange={e=>setScoreMin(+e.target.value)} className="slider"/>
                  </div>
                  <div style={{marginTop:'8px',padding:'8px',background:'var(--bg3)',borderRadius:'6px',border:'1px solid var(--bd)'}}>
                    <div style={{display:'flex',justifyContent:'space-between',fontSize:'10px',color:'var(--tx2)',marginBottom:'4px'}}>
                      <span>Marge max / trade</span>
                      <span style={{color:'var(--gold)',fontFamily:"'JetBrains Mono',monospace"}}>{maxMargin}$</span>
                    </div>
                    <input type="range" min="5" max="1000" step="5" value={maxMargin} onChange={e=>{setMaxMargin(+e.target.value);lsS('ab24_maxmargin',+e.target.value);}} className="slider"/>
                  </div>
                </div>

                <div className="ctrl-card">
                  <div className="ctrl-card-title">🔌 Connexion Binance Futures</div>
                  <div className={`api-status-badge ${apiOk?'api-badge-on':'api-badge-off'}`}>
                    <span style={{fontSize:'20px'}}>{apiOk?'✅':'🔴'}</span>
                    <div>
                      <div style={{fontWeight:700,fontSize:'14px'}}>{apiOk?'CONNECTÉ':'NON CONNECTÉ'}</div>
                      <div style={{fontSize:'10px',opacity:.7}}>
                        {apiOk?`Binance Futures${apiFuturesBalance?` · ${apiFuturesBalance.toFixed(2)} USDT`:''}` : 'Entrez vos clés API'}
                      </div>
                    </div>
                  </div>
                  <div className="fld" style={{marginBottom:'8px'}}>
                    <div className="flbl">API Key</div>
                    <input className="inp" type="password" placeholder="Votre API Key Binance" value={apiKey} onChange={e=>setApiKey(e.target.value)} style={{fontSize:'11px'}}/>
                  </div>
                  <div className="fld" style={{marginBottom:'10px'}}>
                    <div className="flbl">Secret Key</div>
                    <input className="inp" type="password" placeholder="Votre Secret Key Binance" value={apiSec} onChange={e=>setApiSec(e.target.value)} style={{fontSize:'11px'}}/>
                  </div>
                  <button className="btn btn-gold btn-full" onClick={()=>{if(!discAccepted)setShowDisc(true);else testApi();}} disabled={apiLoad}>
                    {apiLoad?'⏳ Connexion…':'🔌 Connecter à Binance'}
                  </button>
                  {apiMsg&&<div className={`api-res ${apiOk?'ar-ok':'ar-err'}`} style={{marginTop:'8px'}}>{apiMsg}</div>}
                  <div className="hint" style={{marginTop:'6px'}}>
                    ⚠️ Permissions : <b>Futures Read + Trade</b> uniquement. <span style={{color:'var(--dn)'}}>Jamais de retrait.</span>
                  </div>
                </div>
              </div>

              {/* ⑧ JOURNAL */}
              <div className="log-wrap dash-anim-7">
                <div className="log-hd">
                  <div className="log-hd-t">◎ Journal (frais Binance déduits)</div>
                  {botOn&&<span className="f9 cup">● {openPos.length}/{getMaxPos()}</span>}
                </div>
                <div className="log-body">
                  {logs.map((l,i)=>(
                    <div key={i} className={`ll l${l.type}`}>[{l.ts}] {l.msg}</div>
                  ))}
                </div>
              </div>
            </>}

            {/* ═════ SIGNALS ═════ */}
            {page==='signals'&&<>
              <div style={{background:'rgba(14,203,129,.06)',border:'1px solid rgba(14,203,129,.2)',borderRadius:'8px',padding:'10px 14px',display:'flex',alignItems:'center',gap:'10px',fontSize:'10px',color:'var(--up)'}}>
                <span style={{fontSize:'18px'}}>📡</span>
                <div>
                  <b>Signaux SPOT Binance — Prix réels {priceSource==='LIVE'?'● LIVE':'(simulation)'}.</b> Ces signaux sont générés algorithmiquement à partir d'indicateurs techniques en temps réel. <span style={{color:'var(--gold)'}}>Ils ne constituent pas des conseils financiers.</span>
                </div>
              </div>
              <div className="soon-banner">
                <div className="soon-text">🔔 <b>Version Payante :</b> Signaux Premium · Entries précises · Alertes Telegram</div>
                <div className="soon-badge">COMING SOON</div>
              </div>
              <div>
                <div className="sec-head">
                  <div className="sec-title"><div className="sec-dot" style={{background:'var(--gold)'}}/>Signaux SPOT — Score complet · Preuves complètes</div>
                  <span className="f10 tx2">{setups.length}/{MAX_SETUPS}</span>
                </div>
                <div className="setups-grid">
                  {setups.map(s=>(
                    <SignalCard key={s.id} sig={s} prices={prices}
                      onChart={()=>openChart(s.pair)}
                      onExecute={()=>executeSignal(s)}
                      botDemo={botDemo} apiOk={apiOk}/>
                  ))}
                  {Array(Math.max(0,4-setups.length)).fill(0).map((_,i)=>(
                    <div key={i} className="sc empty" style={{minHeight:'240px'}}>
                      <span style={{fontSize:'32px',opacity:.12}}>📡</span>
                      <span>Scan en cours…</span>
                    </div>
                  ))}
                </div>
              </div>
            </>}

            {/* ═════ SCANNER ═════ */}
            {page==='scanner'&&(
              <div className="scan-wrap">
                <div className="log-hd">
                  <div className="log-hd-t">📡 Scanner — {PAIRS.length} Paires</div>
                  <span className="f10 tx2">{session!=='asia'?'Session active':'Session Asie — liquidité réduite, bot actif'}</span>
                </div>
                <div style={{overflowX:'auto'}}>
                  <table className="scan-table">
                    <thead>
                      <tr>{['Paire','Prix','Var.','Direction','Score','RR','BB','VOS','Vol','RSI','Action'].map(h=>(
                        <th key={h} className="scan-th">{h}</th>
                      ))}</tr>
                    </thead>
                    <tbody>
                      {PAIRS.map(pair=>{
                        const pr=prices[pair]||{price:0,prev:0};
                        const pct=(pr.price-pr.prev)/pr.prev*100;
                        const sig=setups.find(s=>s.pair===pair);
                        return (
                          <tr key={pair} className="scan-tr">
                            <td className="scan-td mono bold">{pair.replace('USDT','')}</td>
                            <td className="scan-td mono">{fmtP(pr.price)}</td>
                            <td className="scan-td mono" style={{color:pct>=0?'var(--up)':'var(--dn)'}}>{fmtPct(pct)}</td>
                            <td className="scan-td">{sig?<span className={`sc-side ${sig.side==='BUY'?'sl':'ss'}`}>{sig.side==='BUY'?'LONG':'SHORT'}</span>:<span className="tx2">—</span>}</td>
                            <td className="scan-td mono" style={{color:sig?.score>=80?'var(--up)':sig?.score>=70?'var(--gold)':'var(--tx2)'}}>{sig?.score||'—'}</td>
                            <td className="scan-td" style={{color:'var(--up)'}}>{sig?`1:${sig.rr}`:'—'}</td>
                            {['bb','vos','vol','rsi'].map(k=>(
                              <td key={k} className="scan-td" style={{color:sig?.[k]?'var(--up)':sig?.[k]===false?'var(--dn)':'var(--tx2)'}}>
                                {sig?.[k]===undefined?'—':sig[k]?'✓':'✗'}
                              </td>
                            ))}
                            <td className="scan-td">
                              <button className="chart-btn" onClick={()=>openChart(pair)}>📈</button>
                            </td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                </div>
              </div>
            )}

            {/* ═════ POSITIONS ═════ */}
            {page==='positions'&&(
              <div className="scan-wrap">
                <div className="log-hd">
                  <div className="log-hd-t">📂 Positions Ouvertes (avec prix liquidation)</div>
                  <span className="f10">{openPos.length}/{getMaxPos()}</span>
                </div>
                {openPos.length===0
                  ?<div className="nodata">Aucune position ouverte</div>
                  :<div style={{padding:'12px'}}><div className="pos-grid">
                    {openPos.map(p=><PosCard key={p.id} pos={p} prices={prices} onChart={()=>openChart(p.pair)} leverage={leverage}/>)}
                  </div></div>}
              </div>
            )}

            {/* ═════ HISTORY ═════ */}
            {page==='history'&&(
              <div className="scan-wrap">
                <div className="log-hd">
                  <div className="log-hd-t">📈 Historique — PnL NET (frais Binance déduits)</div>
                  <span className="f10 tx2">{positions.filter(p=>p.status==='closed').length} trades · PnL net {stats.pnl>=0?'+':''}{stats.pnl.toFixed(2)}$ · Frais:{(stats.totalFees||0).toFixed(2)}$</span>
                </div>
                {positions.filter(p=>p.status==='closed').length===0
                  ?<div className="nodata">Aucun trade fermé</div>
                  :positions.filter(p=>p.status==='closed').slice(0,60).map(p=>(
                    <div key={p.id} className="hist-row">
                      <span className={`sc-side ${p.side==='BUY'?'sl':'ss'}`}>{p.side==='BUY'?'L':'S'}</span>
                      <span className="mono bold f12">{p.pair.replace('USDT','')}</span>
                      {p.demo&&<span className="f9 cgold" style={{background:'rgba(240,185,11,.1)',border:'1px solid rgba(240,185,11,.2)',padding:'1px 6px',borderRadius:'4px'}}>DEMO</span>}
                      <span className="f10 tx2 mono">{fmtP(p.entry)}→{fmtP(p.exitPrice)}</span>
                      <span style={{fontSize:'9px',fontWeight:'700',padding:'2px 8px',borderRadius:'4px',background:p.result==='WIN'?'rgba(14,203,129,.1)':p.result==='BE'?'rgba(240,185,11,.1)':'rgba(246,70,93,.1)',color:p.result==='WIN'?'var(--up)':p.result==='BE'?'var(--gold)':'var(--dn)'}}>{p.result}</span>
                      {p.estimatedFees&&<span className="f9 cdn">-{p.estimatedFees.toFixed(3)}$ fees</span>}
                      <span className={`hist-pnl ${p.pnl>=0?'cup':'cdn'}`}>{p.pnl>=0?'+':''}{p.pnl?.toFixed(2)}$</span>
                    </div>
                  ))}
              </div>
            )}

            {/* ═════ NEWS / FONDAMENTAUX ═════ */}
            {page==='news'&&(
              <div>
                <div className="sec-head">
                  <div className="sec-title"><div className="sec-dot" style={{background:'var(--bl)'}}/>Fondamentaux & News Crypto</div>
                  <span className="f9 tx2">Impact sur le marché</span>
                </div>
                <div style={{background:'rgba(24,144,255,.05)',border:'1px solid rgba(24,144,255,.15)',borderRadius:'8px',padding:'10px 14px',marginBottom:'12px',fontSize:'10px',color:'var(--tx1)',lineHeight:'1.6'}}>
                  📰 <b style={{color:'var(--bl)'}}>Analyse fondamentale :</b> Le robot intègre le biais directionnel des fondamentaux pour filtrer les signaux contre-tendance. News BEAR = signals BUY filtrés. <b style={{color:'var(--gold)'}}>Impact HIGH = priorité maximum.</b>
                </div>
                <div className="news-card">
                  <div className="news-hd">
                    <div style={{fontFamily:"'Rajdhani',sans-serif",fontWeight:700,fontSize:'12px',letterSpacing:'1px'}}>📰 DERNIÈRES NEWS</div>
                    <span className="f9 cup">● Live</span>
                  </div>
                  {FUNDAMENTALS.map(n=>(
                    <div key={n.id} className="news-item">
                      <div className={`news-dot news-${n.sentiment}`} style={{marginTop:'4px'}}/>
                      <div style={{flex:1}}>
                        <div className="news-title">{n.title}</div>
                        <div className="news-meta" style={{display:'flex',gap:'8px',alignItems:'center',marginTop:'4px'}}>
                          <span>{n.source}</span>
                          <span>il y a {n.time}</span>
                          <span className={`news-impact ${n.impact==='high'?'ni-high':n.impact==='med'?'ni-med':'ni-low'}`}>
                            {n.impact.toUpperCase()}
                          </span>
                          <span style={{marginLeft:'auto',fontSize:'10px',fontWeight:700,color:n.sentiment==='bull'?'var(--up)':'var(--dn)'}}>
                            {n.sentiment==='bull'?'↑ HAUSSIER':'↓ BAISSIER'}
                          </span>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
                <div style={{marginTop:'12px',background:'var(--bg2)',border:'1px solid var(--bd)',borderRadius:'10px',padding:'16px'}}>
                  <div style={{fontFamily:"'Rajdhani',sans-serif",fontWeight:700,fontSize:'13px',letterSpacing:'1px',marginBottom:'12px',color:'var(--tx1)'}}>📅 CALENDRIER ÉCONOMIQUE</div>
                  {[
                    {time:'Demain 14h30','event':'CPI US — Inflation mensuelle','impact':'high','expect':'+0.3%'},
                    {time:'Jeudi 20h00','event':'FED Minutes — Réunion FOMC','impact':'high','expect':'Hawkish'},
                    {time:'Vendredi 16h00','event':'NFP US — Emplois non-agricoles','impact':'high','expect':'+185K'},
                    {time:'Lundi 10h00','event':'PMI Zone Euro','impact':'med','expect':'51.2'},
                  ].map((ev,i)=>(
                    <div key={i} style={{display:'flex',alignItems:'center',gap:'12px',padding:'8px 0',borderBottom:'1px solid var(--bd)',fontSize:'10px'}}>
                      <span style={{color:'var(--tx2)',minWidth:'100px',fontFamily:"'JetBrains Mono',monospace",fontSize:'9px'}}>{ev.time}</span>
                      <span style={{flex:1,fontWeight:600}}>{ev.event}</span>
                      <span style={{color:'var(--tx2)'}}>{ev.expect}</span>
                      <span className={`news-impact ${ev.impact==='high'?'ni-high':'ni-med'}`}>{ev.impact.toUpperCase()}</span>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* ═════ CANAL ═════ */}
            {page==='canal'&&(
              <div style={{display:'flex',flexDirection:'column',gap:'12px'}}>
                <div className="sec-head">
                  <div className="sec-title"><div className="sec-dot" style={{background:'var(--purple)'}}/>Communauté AlphaBot Pro</div>
                </div>

                {/* LEGAL DISCLAIMER — PROMINENT */}
                <div style={{background:'rgba(240,185,11,.06)',border:'1px solid rgba(240,185,11,.25)',borderRadius:'10px',padding:'14px 16px'}}>
                  <div style={{fontFamily:"'Rajdhani',sans-serif",fontWeight:800,fontSize:'12px',letterSpacing:'1px',color:'var(--gold)',marginBottom:'7px'}}>⚖️ AVERTISSEMENT LÉGAL — À LIRE OBLIGATOIREMENT</div>
                  <div style={{fontSize:'10px',color:'var(--tx1)',lineHeight:'1.8'}}>
                    Les signaux, analyses et performances affichés sur AlphaBot Pro sont fournis à titre <b style={{color:'var(--gold)'}}>purement informatif</b> et ne constituent en aucun cas un <b>conseil en investissement, une recommandation financière ou une offre d'achat/vente de valeurs mobilières</b> au sens de la directive MiFID II ou de toute réglementation applicable.
                    <br/><br/>
                    <b style={{color:'var(--dn)'}}>Les performances passées ne préjugent pas des performances futures.</b> Le trading sur les marchés de crypto-actifs comporte un risque élevé de perte partielle ou totale en capital. AlphaBot Pro et ses opérateurs <b>déclinent toute responsabilité</b> quant aux pertes financières résultant de l'utilisation de cette plateforme.
                    <br/><br/>
                    En utilisant AlphaBot Pro, vous reconnaissez avoir pris connaissance de ces risques et être seul responsable de vos décisions de trading.
                  </div>
                </div>

                {/* PDF DOWNLOAD */}
                <div style={{background:'var(--bg2)',border:'1px solid var(--bd)',borderRadius:'10px',padding:'16px'}}>
                  <div style={{fontFamily:"'Rajdhani',sans-serif",fontWeight:700,fontSize:'13px',letterSpacing:'1px',color:'var(--tx1)',marginBottom:'12px'}}>📥 GUIDES & RESSOURCES — Télécharger</div>
                  <div style={{display:'flex',flexDirection:'column',gap:'10px'}}>
                    {[
                      {icon:'📘',title:'Guide Complet AlphaBot Pro',desc:'Installation · Configuration API Binance · Stratégies · Gestion du risque · FAQ',color:'var(--bl)',content:generateGuideHTML()},
                      {icon:'⚠️',title:'Document Risques & Avertissements',desc:'Obligations légales · Risques du trading crypto · Conditions d\'utilisation',color:'var(--gold)',content:generateRisksHTML()},
                      {icon:'🔧',title:'Guide Déploiement VPS / Netlify',desc:'Déployer AlphaBot Pro en ligne en 10 minutes · Hébergement gratuit',color:'var(--up)',content:generateDeployHTML()},
                    ].map((doc,i)=>(
                      <div key={i} className="pdf-card" onClick={()=>downloadDoc(doc)}>
                        <span className="pdf-icon">{doc.icon}</span>
                        <div className="pdf-info" style={{flex:1}}>
                          <div className="title" style={{color:doc.color}}>{doc.title}</div>
                          <div className="sub">{doc.desc}</div>
                        </div>
                        <button className="pdf-btn">⬇ PDF</button>
                      </div>
                    ))}
                  </div>
                </div>

                {/* TikTok Challenge Banner */}
                <div className="tiktok-banner">
                  <div className="tt-icon">🎯</div>
                  <div className="tt-text">
                    <div className="title">CHALLENGE <span>TIKTOK</span> — 4H POUR LANCER LE BOT</div>
                    <div className="sub">Rejoins le challenge en direct — lance le site en 4h · #AlphaBotPro</div>
                  </div>
                  <button className="tt-btn" onClick={()=>window.open('https://tiktok.com/@alphabotpro','_blank')}>
                    📱 VOIR LE LIVE
                  </button>
                </div>

                <div className="canal-card">
                  <div className="canal-title">REJOINS LA <span>COMMUNAUTÉ</span></div>
                  <div className="canal-desc">
                    Signaux premium en temps réel · Analyses de marchés · Alertes Telegram · Tutoriels exclusifs.
                  </div>
                  <div className="canal-links">
                    <a className="canal-link canal-tg" href="https://t.me/alphabotpro" target="_blank" rel="noopener">
                      <span className="canal-link-icon">✈️</span>
                      <div className="canal-link-info">
                        <div className="title">TELEGRAM — Canal Signaux</div>
                        <div className="sub">Alertes temps réel · Signaux premium · Analyses</div>
                      </div>
                      <span className="canal-link-arrow">→</span>
                    </a>
                    <a className="canal-link canal-tt" href="https://tiktok.com/@alphabotpro" target="_blank" rel="noopener">
                      <span className="canal-link-icon">🎵</span>
                      <div className="canal-link-info">
                        <div className="title">TIKTOK — @alphabotpro</div>
                        <div className="sub">Vidéos trading · Challenge 4H · Résultats live</div>
                      </div>
                      <span className="canal-link-arrow">→</span>
                    </a>
                    <a className="canal-link canal-yt" href="https://youtube.com/@alphabotpro" target="_blank" rel="noopener">
                      <span className="canal-link-icon">▶️</span>
                      <div className="canal-link-info">
                        <div className="title">YOUTUBE — Tutoriels</div>
                        <div className="sub">Déploiement · Configuration API · Stratégies</div>
                      </div>
                      <span className="canal-link-arrow">→</span>
                    </a>
                  </div>
                </div>
              </div>
            )}

            {/* ═════ ABONNEMENT / DEPOT CRYPTO ═════ */}
            {page==='abonnement'&&<AbonnementPage user={user} toast={toast}/>}

            {/* ═════ ACCOUNT ═════ */}
            {page==='account'&&(
              <AccountPage user={user} balance={balance} setBalance={setBalance}
                stats={stats} risk={risk} setUser={setUser}
                onCopy={copyToClipboard} refLink={refLink}
                apiFuturesBalance={apiFuturesBalance} apiOk={apiOk}/>
            )}

            {/* ═════ ADMIN ═════ */}
            {page==='admin'&&isAdmin&&(
              <AdminPage
                risk={risk} setRisk={setRisk}
                leverage={leverage} setLeverage={setLeverage}
                balance={balance} setBalance={setBalance}
                scoreMin={scoreMin} setScoreMin={setScoreMin}
                maxMargin={maxMargin} setMaxMargin={setMaxMargin}
                totalUsers={totalUsers} stats={stats}
                log={log} toast={toast}
              />
            )}

            {/* LEGAL FOOTER */}
            <div style={{marginTop:'8px',padding:'10px 14px',background:'var(--bg3)',border:'1px solid var(--bd)',borderRadius:'8px',fontSize:'9px',color:'var(--tx2)',lineHeight:'1.6',textAlign:'center'}}>
              ⚖️ <b>AlphaBot Pro</b> est un outil d'analyse informatif uniquement · Les signaux ne constituent pas des conseils financiers · Les performances passées ne préjugent pas des performances futures · Trading à risque élevé de perte en capital · Vous êtes seul(e) responsable de vos décisions
            </div>

          </div>
        </div>
      </div>

      {/* CHART MODAL */}
      {modal==='chart'&&(
        <div className="modal-bg" onClick={()=>setModal(null)}>
          <div className="chart-modal" onClick={e=>e.stopPropagation()}>
            <div className="chart-hd">
              <div className="chart-title">{chartPair}</div>
              <div className="chart-tfs">
                {[['1','M1'],['5','M5'],['15','M15'],['60','H1'],['240','H4'],['D','D1'],['W','W1']].map(([v,l])=>(
                  <button key={v} className={`tft${chartTf===v?' act':''}`} onClick={()=>setChartTf(v)}>{l}</button>
                ))}
              </div>
              <div className="xbtn" onClick={()=>setModal(null)}>✕</div>
            </div>
            <iframe className="chart-iframe"
              src={`https://www.tradingview.com/widgetembed/?symbol=BINANCE%3A${chartPair}&interval=${chartTf}&theme=${theme}&style=1&locale=fr&toolbar_bg=${theme==='dark'?'13181f':'ffffff'}&hide_side_toolbar=0&allow_symbol_change=1&save_image=1&withdateranges=1&studies=RSI%40tv-basicstudies%1FBB%40tv-basicstudies%1FMACD%40tv-basicstudies`}
              allowFullScreen allowTransparency/>
          </div>
        </div>
      )}

      {/* SETTINGS MODAL */}
      {modal==='settings'&&(
        <div className="modal-bg" onClick={()=>setModal(null)}>
          <div className="modal-box" onClick={e=>e.stopPropagation()}>
            <div className="modal-hd">
              <div className="modal-title">⚙ Paramètres API & Risque</div>
              <div className="xbtn" onClick={()=>setModal(null)}>✕</div>
            </div>
            <div className="modal-body">
              <div style={{background:'rgba(246,70,93,.06)',border:'1px solid rgba(246,70,93,.2)',borderRadius:'7px',padding:'11px 13px',marginBottom:'13px',fontSize:'11px',color:'var(--tx1)',lineHeight:'1.7'}}>
                ⚠️ <b style={{color:'var(--dn)'}}>Risques :</b> Le trading comporte des risques élevés. AlphaBot Pro n'est <b>pas responsable</b> de vos pertes. API uniquement avec <b style={{color:'var(--gold)'}}>Futures Read + Trade</b> — <b style={{color:'var(--dn)'}}>JAMAIS de retrait.</b>
              </div>
              <div className="msec">
                <div className="msec-t">🔌 API Binance Futures</div>
                {apiOk&&apiFuturesBalance&&(
                  <div style={{background:'rgba(14,203,129,.07)',border:'1px solid rgba(14,203,129,.2)',borderRadius:'6px',padding:'10px',marginBottom:'10px',fontFamily:"'JetBrains Mono',monospace",fontSize:'13px',color:'var(--up)',fontWeight:700}}>
                    ✅ Connecté · {apiFuturesBalance.toFixed(2)} USDT
                  </div>
                )}
                <div className="fld"><div className="flbl">API Key</div>
                  <input className="inp" type="password" placeholder="Votre API Key" value={apiKey} onChange={e=>setApiKey(e.target.value)}/></div>
                <div className="fld"><div className="flbl">Secret Key</div>
                  <input className="inp" type="password" placeholder="Votre Secret Key" value={apiSec} onChange={e=>setApiSec(e.target.value)}/></div>
                <button className="btn btn-gold btn-full" onClick={()=>{if(!discAccepted){setShowDisc(true);setModal(null);}else testApi();}} disabled={apiLoad}>
                  {apiLoad?'⏳ Connexion…':'🔌 Tester la connexion API'}
                </button>
                {apiMsg&&<div className={`api-res ${apiOk?'ar-ok':'ar-err'}`}>{apiMsg}</div>}
              </div>
              <div className="msec">
                <div className="msec-t">📊 Gestion du Risque</div>
                <div className="flex jb f11" style={{marginBottom:'8px'}}>
                  <span className="tx1">Risque par trade</span>
                  <span className="mono cgold bold">{risk.toFixed(2)}%</span>
                </div>
                <input type="range" min="0.1" max="10" step="0.1" value={risk} onChange={e=>{setRisk(+e.target.value);lsS('ab24_risk',+e.target.value);}} className="slider"/>
                <div className="adm-row"><span>Risque actuel</span><span className="r">{(balance*risk/100).toFixed(2)} $</span></div>
                <div className="adm-row"><span>Frais estimés/trade</span><span className="r cdn">{calcFeesForTrade(balance*risk/100*leverage).toFixed(3)} $</span></div>
                <div className="adm-row"><span>Max positions</span><span className="r">{getMaxPos()} (selon solde)</span></div>
                <div className="adm-row"><span>SL Follower active</span><span className="r cup">RR {SL_TRAIL_ACTIVATION_RR}.0</span></div>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

/* ═══════════════════════════════════════════════
   SIGNAL CARD
═══════════════════════════════════════════════ */
function SignalCard({sig, prices, onChart, onExecute, botDemo, apiOk}) {
  const pr  = prices[sig.pair]||{price:0,prev:0};
  const pct = (pr.price-pr.prev)/pr.prev*100;
  const sc  = sig.score;
  const col = sc>=82?'var(--up)':sc>=72?'var(--gold)':'var(--bl)';
  // Afficher les targets potentiels SEULEMENT si score = 100
  const showTargets = sc >= 100;

  return (
    <div className={`sc ${sig.side==='BUY'?'long':'short'} fin`}>
      <div className="sc-top">
        <div className="sc-pair">{sig.pair.replace('USDT','')}<small>/USDT</small></div>
        <span className={`sc-side ${sig.side==='BUY'?'sl':'ss'}`}>{sig.side==='BUY'?'LONG':'SHORT'}</span>
      </div>
      <div className="sc-px">
        <span className="sc-px-val">{fmtP(pr.price)}</span>
        <span className={`sc-px-chg ${pct>=0?'cup':'cdn'}`}>{fmtPct(pct)}</span>
      </div>
      <div className="sc-score">
        <div className="sc-sn" style={{color:col}}>{sc}</div>
        <div className="sc-sbar">
          <div className="sc-sfill" style={{width:`${sc}%`,background:`linear-gradient(90deg,var(--gold),${col})`}}/>
        </div>
        <div className="f9 tx2">/100</div>
      </div>
      <div className="sc-rows">
        <div className="sc-r"><span>RR</span><span className="v cup">1:{sig.rr}</span></div>
        {/* Targets potentiels uniquement si score = 100% */}
        {showTargets ? (
          <>
            <div className="sc-r"><span>SL</span><span className="v cdn">{fmtP(sig.side==='BUY'?pr.price*(1-.008):pr.price*(1+.008))}</span></div>
            <div className="sc-r"><span>TP</span><span className="v cup">{fmtP(sig.side==='BUY'?pr.price*(1+.008*parseFloat(sig.rr)):pr.price*(1-.008*parseFloat(sig.rr)))}</span></div>
            <div style={{background:'rgba(14,203,129,.08)',border:'1px solid rgba(14,203,129,.2)',borderRadius:'4px',padding:'4px 7px',fontSize:'9px',color:'var(--up)',marginTop:'3px',fontWeight:700}}>
              ⭐ SCORE 100% — Targets confirmées
            </div>
          </>
        ) : (
          <div style={{background:'var(--bg3)',border:'1px solid var(--bd)',borderRadius:'4px',padding:'5px 7px',fontSize:'9px',color:'var(--tx2)',marginTop:'3px'}}>
            🔒 Targets masquées — Score {sc}/100 (100 requis)
          </div>
        )}
      </div>
      <div className="sc-proof">
        {[['BB',sig.bb,'Breaker Block'],['VOS',sig.vos,'Vol of Speed'],['Vol',sig.vol,'Volume Haut'],['RSI',sig.rsi,'RSI Div.'],['BTC',sig.btcOk,'BTC Alignmt']].map(([l,v,title])=>(
          <div key={l} className="sp" title={title}>
            <div className={`sp-dot ${v?'sp-on':'sp-off'}`}>{v?'✓':l[0]}</div>
            <div className="sp-lbl">{l}</div>
          </div>
        ))}
      </div>
      <div className="sc-foot">
        <span className="sc-timer">⏱ {sig.validFor}s</span>
        <div style={{display:'flex',gap:'5px'}}>
          <button className="chart-btn" onClick={onChart}>📈</button>
          <button className={`exec-btn ${!botDemo&&apiOk?'exec-live':'exec-demo'}`} onClick={onExecute} title={botDemo?'Passer en mode Réel':'Exécuter sur Binance'}>
            {botDemo?'📋 DÉMO':'⚡ BINANCE'}
          </button>
        </div>
      </div>
    </div>
  );
}

/* ═══════════════════════════════════════════════
   POSITION CARD — avec prix liquidation + BE
═══════════════════════════════════════════════ */
function PosCard({pos, prices, onChart, leverage}) {
  const cur    = prices[pos.pair]?.price||pos.entry;
  const dist   = Math.abs(pos.entry-pos.sl0);
  const pnlPct = pos.side==='BUY'?(cur-pos.entry)/pos.entry*100:(pos.entry-cur)/pos.entry*100;
  const pnl    = pnlPct/100*pos.riskAmt/0.008;
  const rr     = pos.rrR||0;
  // Prix de liquidation
  const liqPrice = pos.liqPrice || calcLiqPrice(pos.side, pos.entry, pos.leverage||leverage||10);
  // Distance à liquidation en %
  const distToLiq = pos.side==='BUY'
    ? ((liqPrice-cur)/cur*100)
    : ((cur-liqPrice)/cur*100);

  return (
    <div className={`pc ${pos.side==='BUY'?'plong':'pshort'} fin`}>
      <div className="pc-head">
        <div className="flex g6">
          <span className={`sc-side ${pos.side==='BUY'?'sl':'ss'}`}>{pos.side==='BUY'?'L':'S'}</span>
          <span className="pc-pair">{pos.pair.replace('USDT','')}/USDT</span>
        </div>
        <span className={`pc-pnl ${pnl>=0?'pnl-live-up':'pnl-live-dn'}`} style={{color:pnl>=0?'var(--up)':'var(--dn)'}}>{pnl>=0?'+':''}{pnl.toFixed(2)}$</span>
      </div>
      <div className="pc-body">
        <div className="pr"><span className="l">Entrée</span><span className="r mono">{fmtP(pos.entry)}</span></div>
        <div className="pr"><span className="l">Actuel</span><span className="r mono">{fmtP(cur)}</span></div>
        <div className="pr pr-be"><span className="l">Break-even{pos.trailActive?' 🔒 ACTIF':''}</span><span className="r">{fmtP(pos.entry)}</span></div>
        <div className="pr"><span className="l">SL{pos.trailActive?' (trailing)':''}</span><span className="r mono cdn">{fmtP(pos.sl)}</span></div>
        <div className="pr"><span className="l">TP2</span><span className="r mono cup">{fmtP(pos.tp2)}</span></div>
        <div className="pr pr-liq">
          <span className="l">🔥 Prix Liquidation</span>
          <span className="r">{fmtP(liqPrice)}</span>
        </div>
        <div style={{fontSize:'9px',color:distToLiq<5?'var(--dn)':distToLiq<15?'var(--gold)':'var(--tx2)',marginBottom:'5px',textAlign:'right'}}>
          {distToLiq<0?'⛔ DANGER LIQUIDATION':distToLiq<5?`⚠️ Liq à ${Math.abs(distToLiq).toFixed(1)}%`:`🔒 Liq à ${distToLiq.toFixed(1)}%`}
        </div>
        <div className="pr"><span className="l">RR</span><span className="r mono">1:{pos.rr}</span></div>
        {/* Frais Binance */}
        {pos.estimatedFees&&(
          <div className="fees-notice">
            ⚡ Frais Binance: <b>~{pos.estimatedFees.toFixed(3)}$</b> (0.04% entrée + 0.04% sortie)
          </div>
        )}
        <div className="rr-bar">
          <div className="rr-lbl">{rr.toFixed(1)}R · SL follower à RR1.0</div>
          <div className="rr-track">
            {[.5,1,1.5,2,3].map((r,i)=>(
              <div key={i} className={`rrs${rr>=r?' done':''}${r===1&&pos.trailActive?' be':''}`}/>
            ))}
          </div>
        </div>
      </div>
      <div className="pc-foot">
        {pos.demo?<span className="ptag pt-demo">DÉMO</span>:<span className="ptag pt-real">RÉEL</span>}
        {pos.trailActive&&<span className="ptag pt-trail">🔒 BE</span>}
        <button className="btn btn-out btn-sm" style={{marginLeft:'auto'}} onClick={onChart}>📈</button>
      </div>
    </div>
  );
}

/* ═══════════════════════════════════════════════
   ACCOUNT PAGE
═══════════════════════════════════════════════ */
function AccountPage({user,balance,setBalance,stats,risk,setUser,onCopy,refLink,apiFuturesBalance,apiOk}) {
  const [editBal,setEditBal]=useState(false);
  const [newBal,setNewBal]=useState(balance.toString());
  const db=()=>lsG('ab24_udb',{});
  const leverageRec=balance>=1000?20:balance>=500?15:balance>=100?10:balance>=50?5:3;
  const memberSince=user.joinedAt?new Date(user.joinedAt).toLocaleDateString('fr-FR'):'—';
  const refCount=db()[user.email]?.refCount||user.refCount||0;
  const saveBalance=()=>{const v=parseFloat(newBal);if(isNaN(v)||v<1)return;setBalance(v);lsS('ab24_bal',v);setEditBal(false);};

  return (
    <div className="acc-grid">
      <div className="acc-card">
        <div className="acc-hd">👤 Profil</div>
        <div className="acc-body">
          <div className="acc-av">{user.email[0].toUpperCase()}</div>
          <div style={{textAlign:'center',marginBottom:'12px'}}>
            <div className="bold f12">{user.email}</div>
            <div className="f9 tx2 mt4">Membre depuis {memberSince}</div>
            {user.isAdmin&&<div className="f9" style={{color:'var(--purple)',marginTop:'4px'}}>⚙ Administrateur</div>}
          </div>
          {/* Solde Binance si connecté */}
          {apiOk&&apiFuturesBalance&&(
            <div style={{background:'rgba(14,203,129,.07)',border:'1px solid rgba(14,203,129,.2)',borderRadius:'7px',padding:'10px',marginBottom:'10px',textAlign:'center'}}>
              <div style={{fontSize:'9px',color:'var(--tx2)',letterSpacing:'1.5px',marginBottom:'4px'}}>SOLDE BINANCE FUTURES</div>
              <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'22px',fontWeight:700,color:'var(--up)'}}>{apiFuturesBalance.toFixed(2)} USDT</div>
            </div>
          )}
          <div className="sep"/>
          {[
            ['Balance actuelle',`${balance.toFixed(2)} $`, balance>=1000?'cup':'cgold'],
            ['Win Rate (net)', stats.wins+stats.losses===0?'—':stats.wr+'%', stats.wr>=60?'cup':stats.wr>=40?'cgold':'cdn'],
            ['Trades total',   stats.wins+stats.losses, ''],
            ['Gagnants ✅',    stats.wins, 'cup'],
            ['Perdants ❌',    stats.losses, 'cdn'],
            ['PnL BRUT',      `${(stats.pnl+(stats.totalFees||0))>=0?'+':''}${(stats.pnl+(stats.totalFees||0)).toFixed(2)} $`, (stats.pnl+(stats.totalFees||0))>=0?'cup':'cdn'],
            ['Frais Binance', `-${(stats.totalFees||0).toFixed(2)} $`, 'cdn'],
            ['PnL NET réel',  `${stats.pnl>=0?'+':''}${stats.pnl.toFixed(2)} $`, stats.pnl>=0?'cup':'cdn'],
            ['Risque/trade',  `${risk.toFixed(2)}%`, ''],
            ['Parrainages',   `${refCount} utilisateurs`, ''],
          ].map(([l,v,cls])=>(
            <div key={l} className="arow"><span className="l">{l}</span><span className={`r mono bold ${cls}`}>{v}</span></div>
          ))}
          <div className="sep"/>
          {editBal?(
            <div className="fld">
              <div className="flbl">Modifier le solde de test</div>
              <div style={{display:'flex',gap:'7px'}}>
                <input className="inp" type="number" min="1" value={newBal} onChange={e=>setNewBal(e.target.value)} style={{flex:1}}/>
                <button className="btn btn-up btn-sm" onClick={saveBalance}>OK</button>
                <button className="btn btn-out btn-sm" onClick={()=>setEditBal(false)}>✕</button>
              </div>
            </div>
          ):(
            <button className="btn btn-out btn-full btn-sm mt8" onClick={()=>setEditBal(true)}>💰 Modifier le solde de test</button>
          )}
          <button className="btn btn-dn btn-full btn-sm mt8" onClick={()=>{lsS('ab24_user',null);setUser(null);}}>Déconnexion</button>
        </div>
      </div>

      <div className="acc-card">
        <div className="acc-hd">🔗 Parrainage</div>
        <div className="acc-body">
          <div className="ref-box">
            <div className="f10 tx1 mb4">Votre code parrainage</div>
            <div className="ref-code-display" onClick={()=>onCopy(user.refCode,'Code copié !')}>{user.refCode||'—'}</div>
            <div className="f9 tx2" style={{textAlign:'center',marginBottom:'8px'}}>Cliquez sur le code pour le copier</div>
            <div className="flbl" style={{marginTop:'8px'}}>Lien — sélectionner et copier</div>
            <div style={{position:'relative'}}>
              <input readOnly className="inp" value={refLink} style={{fontSize:'9px',paddingRight:'70px',cursor:'text'}} onClick={e=>{e.target.select();onCopy(refLink,'Lien copié !')}}/>
              <button style={{position:'absolute',right:'4px',top:'50%',transform:'translateY(-50%)',padding:'3px 8px',background:'var(--gold)',border:'none',borderRadius:'4px',cursor:'pointer',fontFamily:"'Rajdhani',sans-serif",fontWeight:700,fontSize:'10px',color:'#000'}} onClick={()=>onCopy(refLink,'Lien copié !')}>COPIER</button>
            </div>
            <div className="hint" style={{marginTop:'5px'}}>Si le bouton ne fonctionne pas : cliquez dans le champ → Ctrl+A → Ctrl+C</div>
          </div>
          <div className="ref-stats">
            <div className="ref-stat"><div className="ref-stat-v">{refCount}</div><div className="ref-stat-l">Parrainés</div></div>
            <div className="ref-stat"><div className="ref-stat-v">{user.refBy?'Oui':'Non'}</div><div className="ref-stat-l">Parrainé par</div></div>
          </div>
          {user.refBy&&<div className="hint" style={{textAlign:'center',marginTop:'8px'}}>Invité par : {user.refBy}</div>}
          <div className="soon-banner" style={{marginTop:'12px'}}>
            <div className="f10 tx1">🎁 Bientôt : <b style={{color:'var(--gold)'}}>commission sur chaque parrainage</b> (version Premium)</div>
          </div>
        </div>
      </div>

      <div className="acc-card">
        <div className="acc-hd">⚡ Levier Recommandé</div>
        <div className="acc-body">
          <div style={{textAlign:'center',padding:'14px 0'}}>
            <div style={{fontSize:'44px',fontWeight:700,fontFamily:'JetBrains Mono,monospace',color:'var(--gold)'}}>{leverageRec}x</div>
            <div className="f10 tx2 mt4">Basé sur votre solde actuel</div>
          </div>
          <div className="sep"/>
          {[['≥ 1 000 $','20x',balance>=1000],['≥ 500 $','15x',balance>=500&&balance<1000],['≥ 100 $','10x',balance>=100&&balance<500],['≥ 50 $','5x',balance>=50&&balance<100],['< 50 $','3x',balance<50]].map(([rng,lev,active])=>(
            <div key={rng} className="arow" style={{background:active?'rgba(240,185,11,.07)':'',borderRadius:'5px',padding:'4px 5px'}}>
              <span className="l f10" style={{color:active?'var(--gold)':'var(--tx2)'}}>{active?'▶ ':''}{rng}</span>
              <span className="r mono bold" style={{color:active?'var(--gold)':'var(--tx2)'}}>{lev}</span>
            </div>
          ))}
        </div>
      </div>

      <div className="acc-card" style={{gridColumn:'1/-1'}}>
        <div className="acc-hd">★ Fonctionnalités v24</div>
        <div className="acc-body">
          <div className="feat-g">
            {[
              ['🎯','SL Follower','Break-even à RR1.0'],
              ['💰','Frais Binance','0.04%×2 déduits auto'],
              ['🔥','Prix Liquidation','Affiché sur chaque position'],
              ['📊','Balance Réelle','Sync solde Binance'],
              ['🚫','Filtre Sessions','Asie + weekends exclus'],
              ['📰','Fondamentaux','News + Calendrier éco'],
              ['📺','Canal','Telegram + TikTok + YT'],
              ['🔍','20 Paires','Scan marché complet'],
              ['🤖','Bot Adaptatif','Max pos. selon marge'],
              ['📈','Graphiques','TradingView intégré'],
              ['🔗','Parrainage','Lien unique par compte'],
              ['💎','Premium Signals','Score 100% uniquement',true],
            ].map(([ic,nm,ds,coming])=>(
              <div key={nm} className={`feat-i${coming?' coming':''}`}>
                <div className="fi-icon">{ic}</div>
                <div className="fi-nm">{nm}</div>
                <div className="fi-ds">{ds}</div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}

/* ═══════════════════════════════════════════════
   ABONNEMENT / DEPOT CRYPTO
═══════════════════════════════════════════════ */
const PLANS = [
  { id:'starter', name:'Starter', price:9, desc:'Accès signaux · 20 paires · Email alerts', color:'var(--bl)' },
  { id:'pro', name:'Pro', price:29, desc:'Tout Starter + Bot auto · API Binance · Priorité signaux', color:'var(--gold)', popular:true },
  { id:'elite', name:'Elite', price:79, desc:'Tout Pro + VIP Telegram · Coaching · Analytics avancées', color:'var(--purple)' },
];

const WALLETS = {
  USDT_TRC20: { label:'USDT (TRC-20 / Tron)', symbol:'TRX', icon:'🟢', addr:'ADRESSE FOURNIE PAR TELEGRAM @alphabotpro', network:'Tron (TRC-20) — Frais ultra-bas', color:'#26a17b' },
  USDT_MATIC:  { label:'USDT (Polygon / MATIC)', symbol:'MATIC', icon:'🟣', addr:'ADRESSE FOURNIE PAR TELEGRAM @alphabotpro', network:'Polygon (MATIC) — Frais quasi-nuls', color:'#8247e5' },
  USDT_ERC20:  { label:'USDT (ERC-20 / Ethereum)', symbol:'ETH', icon:'🔷', addr:'ADRESSE FOURNIE PAR TELEGRAM @alphabotpro', network:'Ethereum (ERC-20) — Standard', color:'#627eea' },
};

function AbonnementPage({user, toast}) {
  const [selectedPlan, setSelectedPlan] = useState('pro');
  const [selectedWallet, setSelectedWallet] = useState('USDT_TRC20');
  const [copied, setCopied] = useState(false);
  const [step, setStep] = useState('plan'); // 'plan' | 'pay' | 'confirm'
  const [txHash, setTxHash] = useState('');
  const [submitted, setSubmitted] = useState(false);

  const plan = PLANS.find(p=>p.id===selectedPlan);
  const wallet = WALLETS[selectedWallet];

  const copyAddr = () => {
    copyUniversal(wallet.addr)
      .then(()=>{ setCopied(true); setTimeout(()=>setCopied(false),2500); toast('Adresse copiée !','success',2000); })
      .catch(()=>toast('Sélectionnez l\'adresse manuellement','warn'));
  };

  const submitTx = async () => {
    if(txHash.length<10) return toast('Entrez un hash de transaction valide','error');
    // Envoyer un email de confirmation à l'utilisateur
    const subject = `AlphaBot Pro — Paiement ${plan.name} reçu`;
    const body = `Paiement soumis\nPlan: ${plan.name} — ${plan.price} USDT/mois\nRéseau: ${wallet.label}\nTxID: ${txHash}\nCompte: ${user?.email}\nActivation sous 24h. Rejoignez notre Telegram @alphabotpro pour le suivi.`;
    try {
      await emailjs.send('service_t36sjs6','template_zf05y1a',{
        to_email: user?.email,
        subject,
        code: txHash.substring(0,12)+'…',
        app_name:'AlphaBot Pro — Paiement'
      });
    } catch(e) {}
    setSubmitted(true);
    toast('✅ Transaction soumise — confirmation email envoyée sous 24h','success',5000);
  };

  return (
    <div style={{display:'flex',flexDirection:'column',gap:'14px'}}>

      {/* CRITICAL WARNING */}
      <div style={{background:'rgba(246,70,93,.08)',border:'2px solid rgba(246,70,93,.35)',borderRadius:'10px',padding:'14px 18px',display:'flex',alignItems:'flex-start',gap:'12px'}}>
        <span style={{fontSize:'24px',flexShrink:0}}>⚠️</span>
        <div>
          <div style={{fontFamily:"'Rajdhani',sans-serif",fontWeight:800,fontSize:'13px',color:'var(--dn)',marginBottom:'5px',letterSpacing:'.5px'}}>NE JAMAIS ENVOYER DE CRYPTO SANS CONFIRMATION</div>
          <div style={{fontSize:'10px',color:'var(--tx1)',lineHeight:'1.7'}}>
            L'adresse de dépôt vous sera <b style={{color:'var(--gold)'}}>communiquée directement via Telegram @alphabotpro</b> après avoir choisi votre plan. N'envoyez JAMAIS de fonds à une adresse non confirmée par notre équipe. Rejoignez le Telegram pour obtenir l'adresse officielle et sécurisée.
          </div>
          <a href="https://t.me/alphabotpro" target="_blank" rel="noopener" style={{display:'inline-block',marginTop:'8px',padding:'6px 14px',background:'rgba(0,136,204,.15)',border:'1px solid rgba(0,136,204,.4)',borderRadius:'6px',color:'#29a8dd',fontFamily:"'Rajdhani',sans-serif",fontWeight:700,fontSize:'11px',textDecoration:'none'}}>
            ✈️ Rejoindre @alphabotpro sur Telegram →
          </a>
        </div>
      </div>

      {/* Header */}
      <div style={{background:'linear-gradient(135deg,rgba(124,58,237,.12),rgba(240,185,11,.08))',border:'1px solid rgba(124,58,237,.3)',borderRadius:'12px',padding:'18px 20px'}}>
        <div style={{fontFamily:"'Rajdhani',sans-serif",fontSize:'18px',fontWeight:800,letterSpacing:'1.5px',marginBottom:'5px'}}>
          💎 ALPHABOT PRO — <span style={{color:'var(--gold)'}}>ABONNEMENT</span>
        </div>
        <div style={{fontSize:'11px',color:'var(--tx1)',lineHeight:'1.6'}}>
          Paiement direct en crypto · Pas de banque · Pas de KYC · Activation sous <b style={{color:'var(--up)'}}>24h max</b>
        </div>
      </div>

      {/* Étape 1 : Choisir le plan */}
      <div style={{background:'var(--bg2)',border:'1px solid var(--bd)',borderRadius:'10px',overflow:'hidden'}}>
        <div style={{padding:'12px 15px',background:'var(--bg3)',borderBottom:'1px solid var(--bd)',fontFamily:"'Rajdhani',sans-serif",fontWeight:700,fontSize:'13px',letterSpacing:'1px',color:'var(--tx1)'}}>
          ÉTAPE 1 — Choisir votre plan
        </div>
        <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:'10px',padding:'14px'}}>
          {PLANS.map(p=>(
            <div key={p.id} onClick={()=>setSelectedPlan(p.id)}
              style={{background:selectedPlan===p.id?`rgba(${p.id==='pro'?'240,185,11':p.id==='elite'?'124,58,237':'24,144,255'},.08)`:'var(--bg3)',border:`2px solid ${selectedPlan===p.id?p.color:'var(--bd)'}`,borderRadius:'10px',padding:'14px 12px',cursor:'pointer',transition:'all .2s',position:'relative'}}>
              {p.popular&&<div style={{position:'absolute',top:'-8px',left:'50%',transform:'translateX(-50%)',background:'var(--gold)',color:'#000',fontSize:'8px',fontWeight:800,padding:'2px 10px',borderRadius:'20px',fontFamily:"'Rajdhani',sans-serif",letterSpacing:'1px',whiteSpace:'nowrap'}}>⭐ POPULAIRE</div>}
              <div style={{fontFamily:"'Rajdhani',sans-serif",fontWeight:800,fontSize:'14px',color:p.color,marginBottom:'4px'}}>{p.name}</div>
              <div style={{fontFamily:"'JetBrains Mono',monospace",fontWeight:700,fontSize:'20px',color:'var(--tx0)',marginBottom:'6px'}}>{p.price}<span style={{fontSize:'11px',color:'var(--tx2)'}}> $/mois</span></div>
              <div style={{fontSize:'9px',color:'var(--tx1)',lineHeight:'1.5'}}>{p.desc}</div>
            </div>
          ))}
        </div>
      </div>

      {/* Étape 2 : Choisir le réseau */}
      <div style={{background:'var(--bg2)',border:'1px solid var(--bd)',borderRadius:'10px',overflow:'hidden'}}>
        <div style={{padding:'12px 15px',background:'var(--bg3)',borderBottom:'1px solid var(--bd)',fontFamily:"'Rajdhani',sans-serif",fontWeight:700,fontSize:'13px',letterSpacing:'1px',color:'var(--tx1)'}}>
          ÉTAPE 2 — Choisir le réseau de paiement
        </div>
        <div style={{padding:'14px',display:'flex',flexDirection:'column',gap:'8px'}}>
          {Object.entries(WALLETS).map(([key,w])=>(
            <div key={key} onClick={()=>setSelectedWallet(key)}
              style={{display:'flex',alignItems:'center',gap:'12px',padding:'12px 14px',background:selectedWallet===key?'rgba(240,185,11,.06)':'var(--bg3)',border:`1px solid ${selectedWallet===key?'rgba(240,185,11,.4)':'var(--bd)'}`,borderRadius:'8px',cursor:'pointer',transition:'all .2s'}}>
              <span style={{fontSize:'22px'}}>{w.icon}</span>
              <div style={{flex:1}}>
                <div style={{fontWeight:700,fontSize:'12px',color:selectedWallet===key?'var(--gold)':'var(--tx0)'}}>{w.label}</div>
                <div style={{fontSize:'9px',color:'var(--tx2)',marginTop:'2px'}}>{w.network}</div>
              </div>
              <div style={{width:'16px',height:'16px',borderRadius:'50%',border:`2px solid ${selectedWallet===key?'var(--gold)':'var(--bd)'}`,background:selectedWallet===key?'var(--gold)':'transparent',transition:'all .2s'}}/>
            </div>
          ))}
          <div style={{background:'rgba(246,70,93,.05)',border:'1px solid rgba(246,70,93,.15)',borderRadius:'7px',padding:'9px 12px',fontSize:'9px',color:'var(--dn)',lineHeight:'1.6'}}>
            ⚠️ <b>IMPORTANT :</b> Envoyez uniquement du <b>USDT</b> sur le réseau indiqué. Tout envoi sur le mauvais réseau sera perdu. TRC-20 recommandé (frais ~0.01$).
          </div>
        </div>
      </div>

      {/* Étape 3 : Obtenir l'adresse via Telegram */}
      <div style={{background:'var(--bg2)',border:'1px solid var(--bd)',borderRadius:'10px',overflow:'hidden'}}>
        <div style={{padding:'12px 15px',background:'var(--bg3)',borderBottom:'1px solid var(--bd)',display:'flex',justifyContent:'space-between',alignItems:'center'}}>
          <div style={{fontFamily:"'Rajdhani',sans-serif",fontWeight:700,fontSize:'13px',letterSpacing:'1px',color:'var(--tx1)'}}>ÉTAPE 3 — Obtenir l'adresse de paiement</div>
          <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'16px',fontWeight:800,color:'var(--gold)'}}>{plan.price} USDT</div>
        </div>
        <div style={{padding:'16px'}}>
          <div style={{background:'rgba(0,136,204,.07)',border:'1px solid rgba(0,136,204,.25)',borderRadius:'8px',padding:'14px',marginBottom:'12px',textAlign:'center'}}>
            <div style={{fontSize:'28px',marginBottom:'6px'}}>✈️</div>
            <div style={{fontFamily:"'Rajdhani',sans-serif",fontWeight:800,fontSize:'14px',color:'#29a8dd',marginBottom:'5px'}}>CONTACTEZ NOTRE ÉQUIPE SUR TELEGRAM</div>
            <div style={{fontSize:'10px',color:'var(--tx1)',lineHeight:'1.7',marginBottom:'10px'}}>
              Pour recevoir l'adresse de paiement officielle et sécurisée, rejoignez notre Telegram.<br/>
              Précisez votre plan choisi : <b style={{color:'var(--gold)'}}>{plan.name} — {plan.price} USDT/mois</b><br/>
              Réseau sélectionné : <b>{wallet.label}</b>
            </div>
            <a href="https://t.me/alphabotpro" target="_blank" rel="noopener"
              style={{display:'inline-block',padding:'12px 24px',background:'#29a8dd',border:'none',borderRadius:'8px',color:'#fff',fontFamily:"'Rajdhani',sans-serif",fontWeight:800,fontSize:'14px',letterSpacing:'.5px',textDecoration:'none',cursor:'pointer'}}>
              ✈️ OUVRIR @alphabotpro SUR TELEGRAM
            </a>
          </div>
          <div style={{background:'rgba(240,185,11,.05)',border:'1px solid rgba(240,185,11,.2)',borderRadius:'7px',padding:'9px 12px',fontSize:'9px',color:'var(--gold)',lineHeight:'1.6'}}>
            🔐 <b>Sécurité :</b> Ne jamais envoyer de fonds sans avoir confirmé l'adresse directement avec notre équipe Telegram. Méfiez-vous des imposteurs.
          </div>
        </div>
      </div>

      {/* Étape 4 : Confirmer la transaction */}
      {!submitted ? (
        <div style={{background:'var(--bg2)',border:'1px solid var(--bd)',borderRadius:'10px',overflow:'hidden'}}>
          <div style={{padding:'12px 15px',background:'var(--bg3)',borderBottom:'1px solid var(--bd)',fontFamily:"'Rajdhani',sans-serif",fontWeight:700,fontSize:'13px',letterSpacing:'1px',color:'var(--tx1)'}}>
            ÉTAPE 4 — Confirmer votre paiement
          </div>
          <div style={{padding:'14px'}}>
            <div style={{fontSize:'10px',color:'var(--tx1)',marginBottom:'10px',lineHeight:'1.6'}}>
              Après l'envoi, collez votre <b style={{color:'var(--gold)'}}>hash de transaction (TxID)</b> ci-dessous pour que nous puissions vérifier votre paiement.
            </div>
            <div className="fld" style={{marginBottom:'10px'}}>
              <div className="flbl">Hash de transaction (TxID)</div>
              <input className="inp" type="text" placeholder="Ex: 0x7f3a... ou abc123def..." value={txHash} onChange={e=>setTxHash(e.target.value)} style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'10px'}}/>
            </div>
            <div className="fld" style={{marginBottom:'12px'}}>
              <div className="flbl">Plan sélectionné</div>
              <div style={{background:'var(--bg3)',border:'1px solid var(--bd)',borderRadius:'6px',padding:'9px 12px',fontSize:'11px',fontWeight:700,color:'var(--gold)'}}>{plan.name} — {plan.price} USDT/mois</div>
            </div>
            <div className="fld" style={{marginBottom:'12px'}}>
              <div className="flbl">Email associé au compte</div>
              <div style={{background:'var(--bg3)',border:'1px solid var(--bd)',borderRadius:'6px',padding:'9px 12px',fontSize:'11px',color:'var(--tx1)',fontFamily:"'JetBrains Mono',monospace"}}>{user?.email||'—'}</div>
            </div>
            <button onClick={submitTx} className="btn btn-gold btn-full" style={{padding:'13px',fontSize:'13px',letterSpacing:'1px'}}>
              ✅ CONFIRMER MON PAIEMENT
            </button>
            <div style={{fontSize:'9px',color:'var(--tx2)',textAlign:'center',marginTop:'8px',lineHeight:'1.6'}}>
              Activation sous 24h · En cas de problème : Telegram @alphabotpro
            </div>
          </div>
        </div>
      ) : (
        <div style={{background:'rgba(14,203,129,.08)',border:'1px solid rgba(14,203,129,.3)',borderRadius:'10px',padding:'20px',textAlign:'center'}}>
          <div style={{fontSize:'36px',marginBottom:'10px'}}>🎉</div>
          <div style={{fontFamily:"'Rajdhani',sans-serif",fontWeight:800,fontSize:'16px',color:'var(--up)',marginBottom:'6px'}}>PAIEMENT SOUMIS !</div>
          <div style={{fontSize:'11px',color:'var(--tx1)',lineHeight:'1.7'}}>
            Votre transaction est en cours de vérification.<br/>
            <b style={{color:'var(--gold)'}}>Plan {plan.name}</b> activé sous <b>24h maximum</b>.<br/>
            Un message de confirmation sera envoyé sur Telegram.<br/>
            TxID : <span style={{fontFamily:"'JetBrains Mono',monospace",fontSize:'9px',color:'var(--tx2)'}}>{txHash.substring(0,20)}…</span>
          </div>
        </div>
      )}
    </div>
  );
}

/* ═══════════════════════════════════════════════
   ADMIN PAGE
═══════════════════════════════════════════════ */
function AdminPage({risk,setRisk,leverage,setLeverage,balance,setBalance,scoreMin,setScoreMin,maxMargin,setMaxMargin,totalUsers,stats,log,toast}) {
  const [globalRisk,setGlobalRisk]=useState(risk);
  const [globalLev,setGlobalLev]=useState(leverage);
  const [globalScore,setGlobalScore]=useState(scoreMin);
  const [globalMargin,setGlobalMargin]=useState(maxMargin);
  const [testBalance,setTestBalance]=useState(balance.toString());

  const apply=()=>{
    setRisk(globalRisk);lsS('ab24_risk',globalRisk);
    setLeverage(globalLev);lsS('ab24_lev',globalLev);
    setScoreMin(globalScore);
    setMaxMargin(globalMargin);lsS('ab24_maxmargin',globalMargin);
    const b=parseFloat(testBalance);if(b>=1){setBalance(b);lsS('ab24_bal',b);}
    log(`⚙ Admin: Risque=${globalRisk}% Lev=${globalLev}x Score>=${globalScore} MargeMax=${globalMargin}$`,'wrn');
    toast('Paramètres admin appliqués','success');
  };

  const db=lsG('ab24_udb',{});
  const users=Object.values(db);

  return (
    <div>
      <div className="adm-stats">
        <div className="adm-stat"><div className="adm-stat-v">{users.length}</div><div className="adm-stat-l">Comptes créés</div></div>
        <div className="adm-stat"><div className="adm-stat-v">{stats.wins+stats.losses}</div><div className="adm-stat-l">Trades exécutés</div></div>
        <div className="adm-stat"><div className="adm-stat-v" style={{color:stats.pnl>=0?'var(--up)':'var(--dn)'}}>{stats.pnl>=0?'+':''}{stats.pnl.toFixed(0)}$</div><div className="adm-stat-l">PnL net session</div></div>
      </div>
      <div className="acc-grid">
        <div className="acc-card">
          <div className="acc-hd">⚙ Paramètres Globaux</div>
          <div className="acc-body">
            <div className="fld">
              <div className="flbl">Risque par trade (max 10%)</div>
              <div className="flex g8 mb4"><span className="f11 mono cgold">{globalRisk.toFixed(1)}%</span></div>
              <input type="range" min="0.1" max="10" step="0.1" value={globalRisk} onChange={e=>setGlobalRisk(+e.target.value)} className="slider"/>
              <div className="risk-presets" style={{marginTop:'8px'}}>
                {[[0.5,'Prudent'],[1,'Normal'],[2,'Actif'],[4,'Conservateur'],[8,'Agressif'],[10,'Extrême']].map(([v,l])=>(
                  <button key={l} className={`risk-btn${globalRisk===v?' act':''}`} onClick={()=>setGlobalRisk(v)}>
                    {v}%<br/><span style={{fontSize:'7px',fontWeight:400}}>{l}</span>
                  </button>
                ))}
              </div>
            </div>
            <div className="fld">
              <div className="flbl">Levier</div>
              <div className="flex g8 mb4"><span className="f11 mono cgold">{globalLev}x</span></div>
              <input type="range" min="1" max="50" step="1" value={globalLev} onChange={e=>setGlobalLev(+e.target.value)} className="slider"/>
            </div>
            <div className="fld">
              <div className="flbl">Marge maximum par trade (USDT)</div>
              <div className="flex g8 mb4"><span className="f11 mono cgold">{globalMargin} $</span></div>
              <input type="range" min="5" max="1000" step="5" value={globalMargin} onChange={e=>setGlobalMargin(+e.target.value)} className="slider"/>
              <div style={{display:'flex',gap:'5px',marginTop:'6px',flexWrap:'wrap'}}>
                {[10,25,50,100,250,500].map(v=>(
                  <button key={v} className={`risk-btn${globalMargin===v?' act':''}`} style={{fontSize:'10px',padding:'4px 8px'}} onClick={()=>setGlobalMargin(v)}>{v}$</button>
                ))}
              </div>
            </div>
            <div className="fld">
              <div className="flbl">Score minimum signaux</div>
              <div className="flex g8 mb4"><span className="f11 mono cgold">{globalScore}/100</span></div>
              <input type="range" min="60" max="90" step="1" value={globalScore} onChange={e=>setGlobalScore(+e.target.value)} className="slider"/>
            </div>
            <div className="fld">
              <div className="flbl">Solde de test</div>
              <input className="inp" type="number" min="1" value={testBalance} onChange={e=>setTestBalance(e.target.value)}/>
            </div>
            <button className="btn btn-gold btn-full" onClick={apply}>✅ Appliquer les paramètres</button>
          </div>
        </div>
        <div className="acc-card">
          <div className="acc-hd">👥 Utilisateurs ({users.length})</div>
          <div className="acc-body" style={{maxHeight:'380px',overflowY:'auto'}}>
            {users.length===0?<div className="nodata">Aucun compte</div>:users.map(u=>(
              <div key={u.email} className="adm-row">
                <div>
                  <div className="f11 bold">{u.email.split('@')[0]}</div>
                  <div className="f9 tx2">{u.isAdmin?'⚙ Admin ':''}{!u.verified?'(non vérifié)':'✅'}</div>
                </div>
                <div style={{textAlign:'right'}}>
                  <div className="f10 cgold mono">{u.refCode}</div>
                  <div className="f9 tx2">{u.refCount||0} parr.</div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
