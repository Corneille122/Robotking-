<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>AlphaBot Pro v19 â€” Ultra</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@600;700;800&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --gold:  #F0B90B;
  --gold2: #d4a009;
  --up:    #0ecb81;
  --dn:    #f6465d;
  --bl:    #1890ff;
  --purple:#7c3aed;
  --transition: .2s ease;
}
[data-theme="dark"] {
  --bg:   #0B0E13;
  --bg2:  #111520;
  --bg3:  #171d2e;
  --bg4:  #1d2438;
  --bd:   #232b3e;
  --bd2:  #2d3752;
  --tx0:  #e8ecf0;
  --tx1:  #8b95a8;
  --tx2:  #4a5568;
  --tx3:  #2d3748;
  --shadow: 0 8px 32px rgba(0,0,0,.5);
  --glow-gold: 0 0 20px rgba(240,185,11,.15);
}
[data-theme="light"] {
  --bg:   #f0f2f5;
  --bg2:  #ffffff;
  --bg3:  #f7f8fa;
  --bg4:  #eef0f4;
  --bd:   #e2e8f0;
  --bd2:  #cbd5e0;
  --tx0:  #1a202c;
  --tx1:  #4a5568;
  --tx2:  #a0aec0;
  --tx3:  #e2e8f0;
  --shadow: 0 4px 20px rgba(0,0,0,.08);
  --glow-gold: 0 0 20px rgba(240,185,11,.1);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*{ margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html,body{ height:100%; background:var(--bg); color:var(--tx0); font-family:'Syne',sans-serif; overflow:hidden; }
::-webkit-scrollbar{ width:4px; height:4px; }
::-webkit-scrollbar-thumb{ background:var(--bd); border-radius:2px; }
::-webkit-scrollbar-track{ background:transparent; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.shell{ display:flex; flex-direction:column; height:100vh; height:100dvh; }
.body-row{ display:flex; flex:1; overflow:hidden; }
.main{ flex:1; overflow-y:auto; overflow-x:hidden; background:var(--bg); }
.pad{ padding:14px; display:flex; flex-direction:column; gap:12px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOPBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.topbar{
  height:54px; min-height:54px; flex-shrink:0;
  background:var(--bg2); border-bottom:1px solid var(--bd);
  display:flex; align-items:center; padding:0 14px; gap:0; z-index:100;
}
.t-logo{ display:flex; align-items:center; gap:8px; padding-right:14px; border-right:1px solid var(--bd); margin-right:12px; flex-shrink:0; }
.t-hex{
  width:30px; height:30px; background:var(--gold);
  clip-path:polygon(50% 0%,100% 25%,100% 75%,50% 100%,0% 75%,0% 25%);
  display:flex; align-items:center; justify-content:center;
  font-size:13px; font-weight:800; color:#000;
}
.t-name{ font-family:'Rajdhani',sans-serif; font-size:19px; font-weight:700; letter-spacing:1.5px; }
.t-name span{ color:var(--gold); }
.t-ver{ font-size:8px; color:var(--tx2); font-family:'JetBrains Mono',monospace; align-self:flex-end; margin-bottom:2px; margin-left:3px; }

.t-stats{ display:flex; flex:1; overflow:hidden; gap:0; }
.tstat{ padding:0 12px; border-right:1px solid var(--bd); display:flex; flex-direction:column; justify-content:center; flex-shrink:0; }
.tstat-l{ font-size:7px; color:var(--tx2); letter-spacing:1.5px; text-transform:uppercase; }
.tstat-v{ font-family:'JetBrains Mono',monospace; font-size:12px; font-weight:600; margin-top:1px; }

.t-right{ display:flex; align-items:center; gap:8px; margin-left:auto; flex-shrink:0; }

/* theme toggle */
.theme-btn{
  width:32px; height:32px; background:var(--bg3); border:1px solid var(--bd);
  border-radius:6px; cursor:pointer; display:flex; align-items:center; justify-content:center;
  font-size:15px; transition:var(--transition);
}
.theme-btn:hover{ border-color:var(--gold); }

.api-pill{
  display:flex; align-items:center; gap:5px; padding:5px 11px;
  border-radius:20px; font-size:10px; font-weight:600; cursor:pointer;
  border:1px solid; white-space:nowrap; font-family:'Rajdhani',sans-serif; letter-spacing:.5px;
  transition:var(--transition);
}
.api-on { background:rgba(14,203,129,.08); border-color:rgba(14,203,129,.3); color:var(--up); }
.api-off{ background:rgba(246,70,93,.06); border-color:rgba(246,70,93,.25); color:var(--dn); }
.apidot{ width:5px; height:5px; border-radius:50%; background:currentColor; }
.api-on .apidot{ animation:pulse-dot 2s infinite; }
@keyframes pulse-dot{ 0%,100%{opacity:1;} 50%{opacity:.3;} }

.user-chip{
  display:flex; align-items:center; gap:7px;
  background:var(--bg3); border:1px solid var(--bd); border-radius:6px;
  padding:5px 11px; cursor:pointer; transition:var(--transition);
}
.user-chip:hover{ border-color:var(--gold); }
.uav{ width:26px; height:26px; border-radius:50%; background:var(--gold); display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:700; color:#000; flex-shrink:0; }
.notif-dot{ width:7px; height:7px; border-radius:50%; background:var(--dn); margin-left:-4px; margin-top:-12px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sidebar{
  width:210px; min-width:210px; flex-shrink:0;
  background:var(--bg2); border-right:1px solid var(--bd);
  display:flex; flex-direction:column; overflow-y:auto; overflow-x:hidden;
}
@media(max-width:680px){
  .sidebar{ width:52px; min-width:52px; }
  .sitem-lbl,.sgroup-lbl,.sidebar-context,.bot-txt,.bot-mode-row,.bot-balance-row{ display:none!important; }
  .sitem{ justify-content:center; padding:12px 0; }
  .sidebar-btm{ padding:8px 4px; }
  .bot-box{ padding:8px 4px; }
  .bot-toggle{ padding:8px; }
  .score-row{ display:none!important; }
}
.sgroup{ padding:6px 8px 0; }
.sgroup-lbl{ font-size:7px; color:var(--tx2); letter-spacing:2.5px; padding:8px 6px 3px; text-transform:uppercase; }
.sitem{
  display:flex; align-items:center; gap:9px; padding:9px 10px;
  border-radius:7px; cursor:pointer; font-size:13px; font-weight:600;
  color:var(--tx1); transition:var(--transition);
  border:1px solid transparent; margin-bottom:2px;
}
.sitem:hover{ background:var(--bg3); color:var(--tx0); }
.sitem.act{ background:rgba(240,185,11,.1); border-color:rgba(240,185,11,.18); color:var(--gold); }
.sitem-icon{ font-size:15px; width:18px; text-align:center; flex-shrink:0; }
.sitem-lbl{ white-space:nowrap; overflow:hidden; }
.sitem-badge{ margin-left:auto; font-size:8px; font-weight:700; padding:2px 6px; border-radius:10px; font-family:'JetBrains Mono',monospace; background:rgba(14,203,129,.15); color:var(--up); }
.sitem-badge.warn{ background:rgba(240,185,11,.15); color:var(--gold); }

.sidebar-context{ padding:6px; display:flex; flex-direction:column; gap:5px; }
.ctx-mini{ background:var(--bg3); border:1px solid var(--bd); border-radius:7px; padding:9px 11px; }
.ctx-mini-lbl{ font-size:7px; color:var(--tx2); letter-spacing:1.5px; text-transform:uppercase; margin-bottom:5px; }

.sidebar-btm{ margin-top:auto; padding:8px; border-top:1px solid var(--bd); }
.bot-box{ background:var(--bg3); border:1px solid var(--bd); border-radius:7px; padding:11px; }
.bot-txt{ font-size:7px; color:var(--tx2); letter-spacing:2px; text-transform:uppercase; margin-bottom:7px; }
.bot-balance-row{ display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; }
.score-row{ margin-bottom:8px; }
.score-label{ display:flex; justify-content:space-between; font-size:9px; color:var(--tx2); margin-bottom:3px; }
.score-label span:last-child{ color:var(--gold); font-family:'JetBrains Mono',monospace; }
.bot-toggle{
  width:100%; padding:9px; border-radius:7px; border:none; cursor:pointer;
  font-family:'Rajdhani',sans-serif; font-size:13px; font-weight:700; letter-spacing:1px; transition:var(--transition);
}
.bt-off{ background:rgba(14,203,129,.1); border:1px solid rgba(14,203,129,.25); color:var(--up); }
.bt-off:hover{ background:var(--up); color:#000; }
.bt-on{ background:rgba(246,70,93,.1); border:1px solid var(--dn); color:var(--dn); }
.bt-on:hover{ background:var(--dn); color:#fff; }
.bot-status{ font-size:8px; color:var(--tx2); text-align:center; margin-top:5px; font-family:'JetBrains Mono',monospace; }
.bot-status.live{ color:var(--up); }
.bot-mode-row{ display:flex; justify-content:space-between; align-items:center; margin-top:7px; }
.mode-btns{ display:flex; gap:3px; }
.mbtn{
  padding:3px 9px; font-size:9px; font-family:'Rajdhani',sans-serif; font-weight:700;
  border-radius:4px; cursor:pointer; transition:var(--transition); border:1px solid var(--bd);
  background:transparent; color:var(--tx1);
}
.mbtn.act{ background:var(--gold); border-color:var(--gold); color:#000; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTEXT BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ctx-bar{ display:grid; grid-template-columns:repeat(4,1fr); gap:1px; background:var(--bd); border-radius:8px; overflow:hidden; border:1px solid var(--bd); }
.cbi{ background:var(--bg2); padding:11px 13px; }
.cbi-l{ font-size:7px; color:var(--tx2); letter-spacing:1.5px; text-transform:uppercase; margin-bottom:3px; }
.cbi-v{ font-family:'JetBrains Mono',monospace; font-size:15px; font-weight:700; }
.cbi-s{ font-size:9px; color:var(--tx2); margin-top:2px; }
@media(max-width:480px){ .ctx-bar{ grid-template-columns:repeat(2,1fr); } }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION HEADERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sec-head{ display:flex; align-items:center; justify-content:space-between; margin-bottom:9px; }
.sec-title{ font-family:'Rajdhani',sans-serif; font-size:13px; font-weight:700; letter-spacing:1.5px; display:flex; align-items:center; gap:7px; color:var(--tx1); text-transform:uppercase; }
.sec-dot{ width:5px; height:5px; border-radius:50%; }
.sec-badge{ padding:2px 8px; border-radius:4px; font-size:9px; font-weight:700; font-family:'JetBrains Mono',monospace; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIGNAL CARDS (4 max)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.setups-grid{ display:grid; gap:10px; grid-template-columns:repeat(4,1fr); }
@media(max-width:1100px){ .setups-grid{ grid-template-columns:repeat(2,1fr); } }
@media(max-width:480px){ .setups-grid{ grid-template-columns:1fr; } }

.sc{
  background:var(--bg2); border:1px solid var(--bd); border-radius:10px;
  overflow:hidden; cursor:pointer; transition:border-color .2s,box-shadow .2s;
  display:flex; flex-direction:column;
}
.sc:hover{ border-color:var(--gold); box-shadow:var(--glow-gold); }
.sc.long{ border-top:3px solid var(--up); }
.sc.short{ border-top:3px solid var(--dn); }
.sc.empty{
  border:1px dashed var(--bd); min-height:200px;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:6px; color:var(--tx2); font-size:11px;
}
.sc-top{ padding:9px 11px 5px; display:flex; justify-content:space-between; align-items:center; }
.sc-pair{ font-family:'JetBrains Mono',monospace; font-size:14px; font-weight:700; }
.sc-pair small{ color:var(--tx2); font-size:10px; font-weight:400; }
.sc-side{ padding:2px 7px; border-radius:4px; font-size:9px; font-weight:700; letter-spacing:1px; font-family:'Rajdhani',sans-serif; }
.sl{ background:rgba(14,203,129,.15); color:var(--up); }
.ss{ background:rgba(246,70,93,.15); color:var(--dn); }

.sc-px{ padding:2px 11px 7px; font-family:'JetBrains Mono',monospace; }
.sc-px-val{ font-size:17px; font-weight:700; }
.sc-px-chg{ font-size:10px; margin-left:6px; }

.sc-score{ margin:0 11px 7px; background:var(--bg3); border-radius:5px; padding:6px 9px; display:flex; align-items:center; gap:8px; }
.sc-sn{ font-family:'JetBrains Mono',monospace; font-size:18px; font-weight:700; }
.sc-sbar{ flex:1; height:3px; background:var(--bg); border-radius:2px; overflow:hidden; }
.sc-sfill{ height:100%; border-radius:2px; transition:width .5s; }

.sc-rows{ padding:0 11px 7px; }
.sc-r{ display:flex; justify-content:space-between; font-size:10px; margin-bottom:4px; color:var(--tx1); }
.sc-r .v{ font-family:'JetBrains Mono',monospace; color:var(--tx0); }

/* Proof indicators */
.sc-proof{ display:grid; grid-template-columns:repeat(5,1fr); gap:3px; padding:0 11px 7px; }
.sp{ display:flex; flex-direction:column; align-items:center; gap:2px; }
.sp-dot{ width:22px; height:22px; border-radius:5px; display:flex; align-items:center; justify-content:center; font-size:8px; font-weight:700; font-family:'Rajdhani',sans-serif; }
.sp-on{ background:rgba(14,203,129,.12); color:var(--up); border:1px solid rgba(14,203,129,.25); }
.sp-off{ background:var(--bg3); color:var(--tx2); border:1px solid var(--bd); }
.sp-lbl{ font-size:7px; color:var(--tx2); }

.sc-foot{
  padding:7px 11px; border-top:1px solid var(--bd); background:var(--bg3);
  display:flex; justify-content:space-between; align-items:center; margin-top:auto;
}
.sc-timer{ font-family:'JetBrains Mono',monospace; font-size:9px; color:var(--gold); }

/* Execute button */
.exec-btn{
  padding:5px 10px; border-radius:5px; border:none; cursor:pointer;
  font-family:'Rajdhani',sans-serif; font-size:10px; font-weight:700; letter-spacing:.5px;
  transition:var(--transition);
}
.exec-live{ background:rgba(14,203,129,.15); border:1px solid rgba(14,203,129,.3); color:var(--up); }
.exec-live:hover{ background:var(--up); color:#000; }
.exec-demo{ background:rgba(240,185,11,.1); border:1px solid rgba(240,185,11,.2); color:var(--gold); }
.chart-btn{ font-size:10px; padding:4px 8px; background:transparent; border:1px solid var(--bd); border-radius:4px; color:var(--tx1); cursor:pointer; font-family:'Rajdhani',sans-serif; font-weight:600; transition:var(--transition); }
.chart-btn:hover{ border-color:var(--gold); color:var(--gold); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   POSITIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pos-grid{ display:grid; gap:10px; grid-template-columns:repeat(3,1fr); }
@media(max-width:900px){ .pos-grid{ grid-template-columns:repeat(1,1fr); } }
@media(min-width:901px) and (max-width:1200px){ .pos-grid{ grid-template-columns:repeat(2,1fr); } }

.pc{ background:var(--bg2); border:1px solid var(--bd); border-radius:10px; overflow:hidden; }
.pc.plong{ border-left:3px solid var(--up); }
.pc.pshort{ border-left:3px solid var(--dn); }
.pc-head{ background:var(--bg3); padding:9px 13px; display:flex; justify-content:space-between; align-items:center; }
.pc-pair{ font-family:'JetBrains Mono',monospace; font-size:13px; font-weight:700; }
.pc-pnl{ font-family:'JetBrains Mono',monospace; font-size:15px; font-weight:700; }
.pc-body{ padding:11px 13px; }
.pr{ display:flex; justify-content:space-between; font-size:10px; margin-bottom:5px; }
.pr .l{ color:var(--tx1); }
.pr .r{ font-family:'JetBrains Mono',monospace; }
.rr-bar{ margin-top:8px; }
.rr-lbl{ font-size:8px; color:var(--tx2); margin-bottom:3px; }
.rr-track{ display:flex; gap:2px; }
.rrs{ flex:1; height:4px; border-radius:2px; background:var(--bg); transition:background .4s; }
.rrs.done{ background:var(--up); }
.rrs.be{ background:var(--gold); }
.pc-foot{ padding:7px 13px; border-top:1px solid var(--bd); display:flex; gap:5px; flex-wrap:wrap; align-items:center; }
.ptag{ font-size:8px; padding:2px 7px; border-radius:4px; font-family:'Rajdhani',sans-serif; font-weight:700; }
.pt-trail{ background:rgba(14,203,129,.1); color:var(--up); border:1px solid rgba(14,203,129,.2); }
.pt-demo{ background:rgba(240,185,11,.1); color:var(--gold); border:1px solid rgba(240,185,11,.2); }
.pt-real{ background:rgba(24,144,255,.1); color:var(--bl); border:1px solid rgba(24,144,255,.2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.log-wrap{ background:var(--bg2); border:1px solid var(--bd); border-radius:10px; overflow:hidden; }
.log-hd{ padding:9px 13px; border-bottom:1px solid var(--bd); background:var(--bg3); display:flex; justify-content:space-between; align-items:center; }
.log-hd-t{ font-family:'Rajdhani',sans-serif; font-size:11px; font-weight:700; letter-spacing:1.5px; color:var(--tx1); text-transform:uppercase; }
.log-body{ height:130px; overflow-y:auto; padding:7px 11px; font-family:'JetBrains Mono',monospace; font-size:9px; }
.ll{ padding:2px 0; border-bottom:1px solid rgba(255,255,255,.025); line-height:1.5; }
[data-theme="light"] .ll{ border-bottom-color:rgba(0,0,0,.04); }
.lup{ color:var(--up); } .ldn{ color:var(--dn); } .linf{ color:var(--bl); } .lwrn{ color:var(--gold); } .lmut{ color:var(--tx2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCANNER TABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.scan-wrap{ background:var(--bg2); border:1px solid var(--bd); border-radius:10px; overflow:hidden; }
.scan-table{ width:100%; border-collapse:collapse; font-size:11px; }
.scan-th{ padding:9px 13px; text-align:left; font-size:7px; color:var(--tx2); letter-spacing:1.5px; font-weight:700; text-transform:uppercase; background:var(--bg3); border-bottom:1px solid var(--bd); white-space:nowrap; }
.scan-tr{ border-bottom:1px solid rgba(35,43,62,.4); transition:background .1s; }
.scan-tr:hover{ background:var(--bg3); }
.scan-td{ padding:9px 13px; white-space:nowrap; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HISTORY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hist-row{ display:flex; align-items:center; gap:10px; padding:10px 15px; border-bottom:1px solid var(--bd); flex-wrap:wrap; }
.hist-pnl{ font-family:'JetBrains Mono',monospace; font-size:13px; font-weight:700; margin-left:auto; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACCOUNT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.acc-grid{ display:grid; gap:12px; grid-template-columns:1fr 1fr; }
@media(max-width:640px){ .acc-grid{ grid-template-columns:1fr; } }
.acc-card{ background:var(--bg2); border:1px solid var(--bd); border-radius:10px; overflow:hidden; }
.acc-hd{ padding:10px 14px; border-bottom:1px solid var(--bd); background:var(--bg3); font-family:'Rajdhani',sans-serif; font-size:11px; font-weight:700; letter-spacing:1.5px; color:var(--tx1); text-transform:uppercase; display:flex; justify-content:space-between; align-items:center; }
.acc-body{ padding:14px; }
.acc-av{ width:54px; height:54px; border-radius:50%; background:var(--gold); display:flex; align-items:center; justify-content:center; font-size:22px; font-weight:800; color:#000; margin:0 auto 12px; }
.arow{ display:flex; justify-content:space-between; padding:7px 0; border-bottom:1px solid var(--bd); font-size:11px; }
.arow:last-child{ border-bottom:none; }
.arow .l{ color:var(--tx1); }
.arow .r{ font-family:'JetBrains Mono',monospace; color:var(--gold); }

/* Referral */
.ref-box{ background:var(--bg3); border:1px solid var(--bd); border-radius:8px; padding:14px; margin-bottom:12px; }
.ref-code-display{ font-family:'JetBrains Mono',monospace; font-size:24px; font-weight:700; color:var(--gold); letter-spacing:6px; text-align:center; padding:10px; background:var(--bg); border-radius:6px; margin:8px 0; cursor:pointer; border:1px solid rgba(240,185,11,.2); transition:var(--transition); }
.ref-code-display:hover{ border-color:var(--gold); }
.ref-link{ font-family:'JetBrains Mono',monospace; font-size:9px; color:var(--tx2); text-align:center; word-break:break-all; background:var(--bg); border-radius:5px; padding:7px; margin-top:6px; cursor:pointer; border:1px solid var(--bd); transition:var(--transition); }
.ref-link:hover{ color:var(--gold); border-color:var(--gold); }
.ref-stats{ display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:10px; }
.ref-stat{ background:var(--bg); border:1px solid var(--bd); border-radius:6px; padding:9px; text-align:center; }
.ref-stat-v{ font-family:'JetBrains Mono',monospace; font-size:18px; font-weight:700; color:var(--gold); }
.ref-stat-l{ font-size:9px; color:var(--tx2); margin-top:2px; }

.feat-g{ display:grid; grid-template-columns:repeat(3,1fr); gap:7px; }
@media(max-width:480px){ .feat-g{ grid-template-columns:repeat(2,1fr); } }
.feat-i{ background:var(--bg3); border:1px solid var(--bd); border-radius:7px; padding:10px; text-align:center; }
.feat-i.coming{ opacity:.5; position:relative; }
.feat-i.coming::after{ content:'SOON'; position:absolute; top:5px; right:5px; font-size:6px; font-weight:700; letter-spacing:1px; color:var(--gold); font-family:'Rajdhani',sans-serif; }
.fi-icon{ font-size:18px; margin-bottom:5px; }
.fi-nm{ font-size:11px; font-weight:700; }
.fi-ds{ font-size:9px; color:var(--tx2); margin-top:2px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.adm-stats{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:16px; }
.adm-stat{ background:var(--bg3); border:1px solid var(--bd); border-radius:8px; padding:12px; text-align:center; }
.adm-stat-v{ font-family:'JetBrains Mono',monospace; font-size:22px; font-weight:700; color:var(--gold); }
.adm-stat-l{ font-size:9px; color:var(--tx2); margin-top:3px; text-transform:uppercase; letter-spacing:1px; }
.adm-row{ display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid var(--bd); font-size:11px; }
.adm-row .r{ font-family:'JetBrains Mono',monospace; color:var(--gold); }
.risk-presets{ display:grid; grid-template-columns:repeat(3,1fr); gap:6px; margin:8px 0; }
.risk-btn{ padding:8px; text-align:center; border-radius:6px; border:1px solid var(--bd); cursor:pointer; background:transparent; color:var(--tx1); font-family:'Rajdhani',sans-serif; font-weight:700; font-size:12px; transition:var(--transition); }
.risk-btn.act{ background:rgba(240,185,11,.15); border-color:var(--gold); color:var(--gold); }
.risk-btn:hover{ border-color:var(--gold); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.auth-bg{
  position:fixed; inset:0; background:var(--bg); z-index:999;
  display:flex; align-items:center; justify-content:center; padding:14px;
}
.auth-split{ display:flex; width:100%; max-width:880px; height:min(580px,90vh); border-radius:14px; overflow:hidden; border:1px solid var(--bd); box-shadow:var(--shadow); }
.auth-left{
  flex:1; background:linear-gradient(135deg,#0B0E13 0%,#171d2e 100%);
  padding:40px; display:flex; flex-direction:column; justify-content:center;
  border-right:1px solid var(--bd);
}
@media(max-width:680px){ .auth-left{ display:none; } }
.auth-left-logo{ font-family:'Rajdhani',sans-serif; font-size:32px; font-weight:700; letter-spacing:2px; margin-bottom:8px; }
.auth-left-logo span{ color:var(--gold); }
.auth-left-sub{ font-size:13px; color:var(--tx1); margin-bottom:30px; line-height:1.6; }
.auth-feat{ display:flex; flex-direction:column; gap:10px; }
.auth-feat-item{ display:flex; align-items:center; gap:10px; font-size:12px; color:var(--tx1); }
.af-icon{ width:28px; height:28px; border-radius:6px; background:rgba(240,185,11,.1); border:1px solid rgba(240,185,11,.2); display:flex; align-items:center; justify-content:center; font-size:14px; flex-shrink:0; }
.auth-count{ display:flex; align-items:center; gap:8px; margin-top:25px; font-size:11px; color:var(--tx1); }
.auth-count b{ color:var(--gold); font-family:'JetBrains Mono',monospace; }
.ldot{ width:7px; height:7px; border-radius:50%; background:var(--up); animation:pulse-dot 2s infinite; }

.auth-right{ width:380px; flex-shrink:0; background:var(--bg2); padding:32px 28px; display:flex; flex-direction:column; overflow-y:auto; }
@media(max-width:680px){ .auth-right{ width:100%; border-radius:14px; } }
.auth-right-title{ font-family:'Rajdhani',sans-serif; font-size:22px; font-weight:700; letter-spacing:1px; margin-bottom:6px; }
.auth-right-sub{ font-size:11px; color:var(--tx2); margin-bottom:22px; }
.atabs{ display:flex; border:1px solid var(--bd); border-radius:7px; overflow:hidden; margin-bottom:18px; }
.atab{ flex:1; padding:9px; text-align:center; background:transparent; border:none; cursor:pointer; font-family:'Rajdhani',sans-serif; font-size:13px; font-weight:700; color:var(--tx1); letter-spacing:.5px; transition:var(--transition); }
.atab.act{ background:var(--gold); color:#000; }
.fld{ margin-bottom:13px; }
.flbl{ font-size:7px; color:var(--tx2); letter-spacing:1.5px; text-transform:uppercase; margin-bottom:5px; }
.inp{
  width:100%; background:var(--bg3); border:1px solid var(--bd); color:var(--tx0);
  padding:10px 12px; border-radius:6px; font-family:'JetBrains Mono',monospace; font-size:12px;
  outline:none; transition:border-color .15s;
}
.inp:focus{ border-color:var(--gold); }
.inp::placeholder{ color:var(--tx2); }
.err-box{ background:rgba(246,70,93,.07); border:1px solid rgba(246,70,93,.25); border-radius:6px; padding:9px 12px; font-size:11px; color:var(--dn); margin-bottom:13px; }
.ok-box{ background:rgba(14,203,129,.07); border:1px solid rgba(14,203,129,.25); border-radius:6px; padding:9px 12px; font-size:11px; color:var(--up); margin-bottom:13px; }
.hint{ font-size:9px; color:var(--tx2); margin-top:4px; line-height:1.5; }

.btn{ padding:10px 16px; border-radius:6px; border:none; cursor:pointer; font-family:'Rajdhani',sans-serif; font-size:13px; font-weight:700; letter-spacing:.5px; transition:var(--transition); }
.btn-gold{ background:var(--gold); color:#000; }
.btn-gold:hover{ background:var(--gold2); }
.btn-out{ background:transparent; border:1px solid var(--bd); color:var(--tx0); }
.btn-out:hover{ border-color:var(--gold); color:var(--gold); }
.btn-dn{ background:rgba(246,70,93,.1); border:1px solid rgba(246,70,93,.25); color:var(--dn); }
.btn-dn:hover{ background:var(--dn); color:#fff; }
.btn-up{ background:rgba(14,203,129,.1); border:1px solid rgba(14,203,129,.3); color:var(--up); }
.btn-up:hover{ background:var(--up); color:#000; }
.btn-sm{ padding:5px 10px; font-size:10px; }
.btn-full{ width:100%; }
.btn:disabled{ opacity:.5; cursor:not-allowed; }

.txt-btn{ background:none; border:none; cursor:pointer; color:var(--gold); font-size:11px; font-family:'Syne',sans-serif; font-weight:600; text-decoration:underline; }

/* Verification code */
.vcode-row{ display:flex; gap:6px; justify-content:center; margin:12px 0; }
.vcode-digit{ width:38px; height:46px; background:var(--bg3); border:1px solid var(--bd); border-radius:7px; text-align:center; font-family:'JetBrains Mono',monospace; font-size:20px; font-weight:700; color:var(--tx0); outline:none; }
.vcode-digit:focus{ border-color:var(--gold); }

/* Verification simulation notice */
.sim-notice{
  background:rgba(240,185,11,.07); border:1px solid rgba(240,185,11,.2);
  border-radius:7px; padding:11px 13px; margin:10px 0;
  font-size:10px; color:var(--gold); line-height:1.6;
}
.sim-notice b{ display:block; margin-bottom:3px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-bg{ position:fixed; inset:0; background:rgba(0,0,0,.75); z-index:500; display:flex; align-items:center; justify-content:center; padding:12px; backdrop-filter:blur(6px); }
.modal-box{ background:var(--bg2); border:1px solid var(--bd); border-radius:12px; width:100%; max-width:480px; max-height:90vh; overflow-y:auto; box-shadow:var(--shadow); }
.modal-hd{ padding:13px 17px; border-bottom:1px solid var(--bd); background:var(--bg3); display:flex; justify-content:space-between; align-items:center; border-radius:12px 12px 0 0; }
.modal-title{ font-family:'Rajdhani',sans-serif; font-size:15px; font-weight:700; letter-spacing:1px; }
.modal-body{ padding:18px; }
.msec{ background:var(--bg3); border:1px solid var(--bd); border-radius:8px; padding:14px; margin-bottom:13px; }
.msec-t{ font-size:7px; color:var(--tx2); letter-spacing:2px; text-transform:uppercase; margin-bottom:11px; }
.api-res{ margin-top:11px; padding:10px 12px; border-radius:6px; font-family:'JetBrains Mono',monospace; font-size:10px; }
.ar-ok{ background:rgba(14,203,129,.07); color:var(--up); border:1px solid rgba(14,203,129,.2); }
.ar-err{ background:rgba(246,70,93,.07); color:var(--dn); border:1px solid rgba(246,70,93,.2); }

/* Disclaimer modal */
.disc-modal{ max-width:500px; }
.disc-header{ text-align:center; padding:20px; border-bottom:1px solid var(--bd); background:rgba(246,70,93,.04); }
.disc-icon{ font-size:36px; margin-bottom:8px; }
.disc-title{ font-family:'Rajdhani',sans-serif; font-size:18px; font-weight:700; color:var(--dn); }
.disc-body{ padding:18px; }
.disc-points{ list-style:none; display:flex; flex-direction:column; gap:8px; margin:14px 0; }
.disc-points li{ display:flex; gap:9px; align-items:flex-start; font-size:11px; color:var(--tx1); line-height:1.6; }
.disc-points li::before{ content:'âš '; color:var(--gold); flex-shrink:0; }
.disc-check{ display:flex; align-items:center; gap:9px; font-size:11px; color:var(--tx1); margin:16px 0; cursor:pointer; }
.disc-check input{ accent-color:var(--gold); width:15px; height:15px; cursor:pointer; }

/* Chart modal */
.chart-modal{ width:95vw; height:88vh; background:var(--bg2); border:1px solid var(--bd); border-radius:12px; display:flex; flex-direction:column; overflow:hidden; }
.chart-hd{ padding:11px 15px; background:var(--bg3); border-bottom:1px solid var(--bd); display:flex; align-items:center; justify-content:space-between; flex-shrink:0; }
.chart-title{ font-family:'Rajdhani',sans-serif; font-size:17px; font-weight:700; letter-spacing:1.5px; color:var(--gold); }
.chart-tfs{ display:flex; gap:4px; }
.tft{ padding:4px 10px; border-radius:4px; background:transparent; border:1px solid var(--bd); color:var(--tx1); font-family:'JetBrains Mono',monospace; font-size:10px; cursor:pointer; transition:var(--transition); }
.tft.act,.tft:hover{ background:var(--gold); border-color:var(--gold); color:#000; }
.chart-iframe{ flex:1; border:none; width:100%; }

.xbtn{ width:30px; height:30px; background:var(--bg3); border:1px solid var(--bd); border-radius:5px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:13px; color:var(--tx1); flex-shrink:0; transition:var(--transition); }
.xbtn:hover{ background:var(--dn); color:#fff; border-color:var(--dn); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMING SOON BANNER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.soon-banner{
  background:linear-gradient(90deg,rgba(124,58,237,.15),rgba(240,185,11,.1),rgba(124,58,237,.15));
  border:1px solid rgba(124,58,237,.3); border-radius:8px; padding:11px 16px;
  display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
}
.soon-text{ font-size:11px; color:var(--tx1); }
.soon-text b{ color:var(--gold); }
.soon-badge{ padding:3px 9px; border-radius:20px; background:rgba(124,58,237,.2); border:1px solid rgba(124,58,237,.4); color:#a78bfa; font-size:9px; font-weight:700; font-family:'Rajdhani',sans-serif; letter-spacing:1px; white-space:nowrap; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST NOTIFICATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast-container{ position:fixed; top:60px; right:14px; z-index:999; display:flex; flex-direction:column; gap:8px; pointer-events:none; }
.toast{
  background:var(--bg2); border:1px solid var(--bd); border-radius:8px;
  padding:11px 15px; font-size:11px; max-width:300px; box-shadow:var(--shadow);
  animation:slideIn .25s ease;
  pointer-events:all;
}
@keyframes slideIn{ from{transform:translateX(100%);opacity:0;} to{transform:none;opacity:1;} }
.toast.success{ border-left:3px solid var(--up); }
.toast.error{ border-left:3px solid var(--dn); }
.toast.warn{ border-left:3px solid var(--gold); }
.toast.info{ border-left:3px solid var(--bl); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MISC UTILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.flex{ display:flex; align-items:center; }
.jb{ justify-content:space-between; }
.g4{gap:4px;}.g6{gap:6px;}.g8{gap:8px;}.g10{gap:10px;}
.f9{font-size:9px;}.f10{font-size:10px;}.f11{font-size:11px;}.f12{font-size:12px;}.f13{font-size:13px;}
.tx1{color:var(--tx1);}.tx2{color:var(--tx2);}
.cup{color:var(--up);}.cdn{color:var(--dn);}.cgold{color:var(--gold);}
.mono{font-family:'JetBrains Mono',monospace;}
.bold{font-weight:700;}
.sep{height:1px;background:var(--bd);margin:9px 0;}
.mt4{margin-top:4px;}.mt8{margin-top:8px;}.mt10{margin-top:10px;}.mt14{margin-top:14px;}
.mb4{margin-bottom:4px;}.mb8{margin-bottom:8px;}.mb12{margin-bottom:12px;}
.wnw{white-space:nowrap;}
.nodata{ padding:30px; text-align:center; color:var(--tx2); font-size:12px; }
.fin{ animation:fadeIn .2s ease; }
@keyframes fadeIn{ from{opacity:0;transform:translateY(4px);} to{opacity:1;transform:none;} }
.slider{ width:100%; accent-color:var(--gold); }
.copy-notice{ font-size:9px; color:var(--up); margin-top:4px; text-align:center; opacity:0; transition:opacity .3s; }
.copy-notice.show{ opacity:1; }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useCallback,useMemo} = React;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONSTANTS & MARKET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PAIRS = ['BTCUSDT','ETHUSDT','SOLUSDT','BNBUSDT','XRPUSDT','ADAUSDT',
  'DOGEUSDT','AVAXUSDT','DOTUSDT','MATICUSDT','LINKUSDT','LTCUSDT',
  'UNIUSDT','ATOMUSDT','NEARUSDT','APTUSDT','ARBUSDT','OPUSDT','INJUSDT','SUIUSDT'];

const BASE_PRICES = {
  BTCUSDT:68420,ETHUSDT:3812,SOLUSDT:183,BNBUSDT:562,XRPUSDT:0.621,
  ADAUSDT:0.584,DOGEUSDT:0.178,AVAXUSDT:41.8,DOTUSDT:9.18,MATICUSDT:0.952,
  LINKUSDT:18.2,LTCUSDT:94.8,UNIUSDT:11.9,ATOMUSDT:10.9,NEARUSDT:7.72,
  APTUSDT:11.4,ARBUSDT:1.82,OPUSDT:3.12,INJUSDT:27.8,SUIUSDT:2.21
};

let MKT = {};
PAIRS.forEach(p => { MKT[p] = {price:BASE_PRICES[p], prev:BASE_PRICES[p]}; });

const tickMarket = () => {
  PAIRS.forEach(p => {
    const d = MKT[p];
    const move = d.price * (Math.random() - 0.5) * 0.0015;
    MKT[p] = {prev:d.price, price:Math.max(d.price + move, 0.0001)};
  });
};

const fmtP   = p => p>=1000?p.toFixed(2):p>=10?p.toFixed(3):p>=1?p.toFixed(4):p.toFixed(5);
const fmtPct = p => (p>=0?'+':'')+p.toFixed(3)+'%';
const ts     = () => new Date().toLocaleTimeString('fr-FR');
const lsG    = (k,d) => { try{const v=localStorage.getItem(k);return v?JSON.parse(v):d;}catch{return d;} };
const lsS    = (k,v) => { try{localStorage.setItem(k,JSON.stringify(v));}catch{} };

const getSess = () => { const h=new Date().getUTCHours(); if(h>=8&&h<10)return'london'; if(h>=13&&h<21)return'ny'; return'asia'; };
const sessLbl = {asia:'Asie ğŸŒ', london:'Londres ğŸ‡¬ğŸ‡§', ny:'New York ğŸ‡ºğŸ‡¸'};
const btcTrendCalc = (p,prev) => { const d=(p-prev)/prev*100; return d>.35?'BULL':d<-.35?'BEAR':'RANGE'; };
const calcScore = s => { let n=0; if(s.bb)n+=28; if(s.vos)n+=22; if(s.vol)n+=15; if(s.rsi)n+=10; if(s.btcOk)n+=15; if(s.sessOk)n+=10; return n; };
const makeSetup = (pair, btcT, sessOk) => {
  const side = Math.random()>.5?'BUY':'SELL';
  const btcOk=(side==='BUY'&&btcT!=='BEAR')||(side==='SELL'&&btcT!=='BULL')||btcT==='RANGE';
  const s={
    id:Date.now()+Math.random(),pair,side,
    bb:Math.random()>.32,vos:Math.random()>.40,
    vol:Math.random()>.42,rsi:Math.random()>.38,
    btcOk,sessOk,
    rr:(1.8+Math.random()*2.5).toFixed(1),
    validFor:60+Math.floor(Math.random()*100),ts:ts()
  };
  s.score=calcScore(s); return s;
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HMAC SHA-256 FOR BINANCE API
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function hmac256(secret, message) {
  const enc = new TextEncoder();
  const key = await crypto.subtle.importKey(
    'raw', enc.encode(secret), {name:'HMAC',hash:'SHA-256'}, false, ['sign']
  );
  const sig = await crypto.subtle.sign('HMAC', key, enc.encode(message));
  return Array.from(new Uint8Array(sig)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REFERRAL CODE GENERATOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const genRefCode = email => {
  const prefix = email.split('@')[0].substr(0,4).toUpperCase().replace(/[^A-Z]/g,'X');
  return prefix.padEnd(4,'X')+(1000+Math.floor(Math.random()*8999));
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH COMPONENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function Auth({setUser, totalUsers}) {
  const [tab,      setTab]      = useState('login');
  const [step,     setStep]     = useState('form'); // 'form' | 'verify' | 'reset-req' | 'reset-code'
  const [email,    setEmail]    = useState('');
  const [pass,     setPass]     = useState('');
  const [pass2,    setPass2]    = useState('');
  const [refInput, setRefInput] = useState('');
  const [err,      setErr]      = useState('');
  const [ok,       setOk]       = useState('');
  const [verCode,  setVerCode]  = useState('');
  const [simCode,  setSimCode]  = useState('');
  const [resetCode,setResetCode]= useState('');
  const [simReset, setSimReset] = useState('');
  const [newPass,  setNewPass]  = useState('');
  const [loading,  setLoading]  = useState(false);

  const udb = () => lsG('ab19_udb', {});
  const saveUdb = db => lsS('ab19_udb', db);

  // Admin account auto-init
  useEffect(() => {
    const db = udb();
    if (!db['admin@alphabot.pro']) {
      db['admin@alphabot.pro'] = {
        email:'admin@alphabot.pro', password:'Admin@2024!', joinedAt:Date.now(),
        verified:true, refCode:'ADMIN0001', refBy:null, refCount:0, isAdmin:true
      };
      saveUdb(db);
    }
  }, []);

  const login = () => {
    setErr(''); setOk('');
    const db=udb(), u=db[email.toLowerCase()];
    if (!u || u.password!==pass) return setErr('Email ou mot de passe incorrect.');
    if (!u.verified) return setErr('Veuillez vÃ©rifier votre email avant de vous connecter.');
    setUser(u); lsS('ab19_user', u);
  };

  const register = () => {
    setErr(''); setOk('');
    if (!email||!pass) return setErr('Email et mot de passe requis.');
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) return setErr('Email invalide.');
    if (pass.length<8) return setErr('Mot de passe minimum 8 caractÃ¨res.');
    if (pass!==pass2) return setErr('Les mots de passe ne correspondent pas.');
    const db=udb();
    if (db[email.toLowerCase()]) return setErr('Email dÃ©jÃ  utilisÃ©.');

    const code = Math.floor(100000+Math.random()*900000).toString();
    setSimCode(code);

    // Check referral
    let referredBy = null;
    if (refInput) {
      const referrer = Object.values(db).find(u=>u.refCode===refInput.toUpperCase());
      if (!referrer) return setErr('Code parrainage invalide.');
      referredBy = referrer.email;
    }

    const nu = {
      email:email.toLowerCase(), password:pass, joinedAt:Date.now(),
      verified:false, refCode:genRefCode(email), refBy:referredBy, refCount:0,
      isAdmin:false, balance:1000
    };
    db[email.toLowerCase()]=nu; saveUdb(db);
    setStep('verify');
    setOk(`Code de vÃ©rification envoyÃ© Ã  ${email}`);
  };

  const verifyEmail = () => {
    setErr(''); setOk('');
    if (verCode !== simCode) return setErr('Code incorrect. VÃ©rifiez le code affichÃ© ci-dessous.');
    const db=udb();
    db[email.toLowerCase()].verified=true;

    // Credit referrer
    if (db[email.toLowerCase()].refBy) {
      const refEmail = db[email.toLowerCase()].refBy;
      if (db[refEmail]) { db[refEmail].refCount=(db[refEmail].refCount||0)+1; }
    }
    saveUdb(db);
    const u = db[email.toLowerCase()];
    setUser(u); lsS('ab19_user', u);
  };

  const requestReset = () => {
    setErr(''); setOk('');
    const db=udb();
    if (!db[email.toLowerCase()]) return setErr('Email introuvable.');
    const code = Math.floor(100000+Math.random()*900000).toString();
    setSimReset(code);
    setStep('reset-code');
    setOk(`Code de rÃ©initialisation envoyÃ© Ã  ${email}`);
  };

  const doReset = () => {
    setErr(''); setOk('');
    if (resetCode!==simReset) return setErr('Code incorrect.');
    if (newPass.length<8) return setErr('Mot de passe minimum 8 caractÃ¨res.');
    const db=udb();
    db[email.toLowerCase()].password=newPass;
    saveUdb(db);
    setOk('Mot de passe modifiÃ© ! Connectez-vous.');
    setStep('form'); setTab('login'); setResetCode(''); setNewPass('');
  };

  return (
    <div className="auth-bg">
      <div className="auth-split">
        {/* Left promo panel */}
        <div className="auth-left">
          <div className="auth-left-logo">ALPHA<span>BOT</span> PRO</div>
          <div className="auth-left-sub">
            Plateforme de trading algorithmique<br/>connectÃ©e Ã  Binance Futures
          </div>
          <div className="auth-feat">
            {[
              ['ğŸ¤–','Bot automatique 24/7'],
              ['ğŸ“¡','Scanner 20 paires en temps rÃ©el'],
              ['ğŸ“Š','Graphiques TradingView intÃ©grÃ©s'],
              ['ğŸ”—','API Binance Futures rÃ©elle'],
              ['ğŸ‘¥','Programme de parrainage'],
              ['ğŸ›¡ï¸','Gestion du risque avancÃ©e'],
            ].map(([ic,lb])=>(
              <div key={lb} className="auth-feat-item">
                <div className="af-icon">{ic}</div>
                <span>{lb}</span>
              </div>
            ))}
          </div>
          <div className="auth-count">
            <div className="ldot"/>
            <span><b>{totalUsers.toLocaleString('fr-FR')}</b> traders actifs</span>
          </div>
        </div>

        {/* Right form panel */}
        <div className="auth-right">
          <div className="auth-right-title">
            {step==='form'    ? (tab==='login' ? 'Connexion' : 'CrÃ©er un compte') : ''}
            {step==='verify'  ? 'VÃ©rification email' : ''}
            {step==='reset-req'||step==='reset-code' ? 'RÃ©initialiser mot de passe' : ''}
          </div>
          <div className="auth-right-sub">
            {step==='form'&&tab==='login' ? 'AccÃ©dez Ã  votre tableau de bord' : ''}
            {step==='form'&&tab==='register' ? 'Gratuit Â· Sans abonnement Â· Commencez maintenant' : ''}
          </div>

          {err && <div className="err-box">{err}</div>}
          {ok  && <div className="ok-box">{ok}</div>}

          {/* â”€â”€ FORM STEP â”€â”€ */}
          {step==='form' && tab==='login' && (
            <>
              <div className="atabs">
                <button className="atab act">Connexion</button>
                <button className="atab" onClick={()=>{setTab('register');setErr('');setOk('');}}>Inscription</button>
              </div>
              <div className="fld">
                <div className="flbl">Email</div>
                <input className="inp" type="email" placeholder="votre@email.com" value={email}
                  onChange={e=>setEmail(e.target.value)} onKeyDown={e=>e.key==='Enter'&&login()}/>
              </div>
              <div className="fld">
                <div className="flbl">Mot de passe</div>
                <input className="inp" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" value={pass}
                  onChange={e=>setPass(e.target.value)} onKeyDown={e=>e.key==='Enter'&&login()}/>
              </div>
              <button className="btn btn-gold btn-full" onClick={login}>SE CONNECTER â†’</button>
              <div style={{textAlign:'center',marginTop:'12px'}}>
                <button className="txt-btn" onClick={()=>{setStep('reset-req');setErr('');setOk('');}}>
                  Mot de passe oubliÃ© ?
                </button>
              </div>
            </>
          )}

          {step==='form' && tab==='register' && (
            <>
              <div className="atabs">
                <button className="atab" onClick={()=>{setTab('login');setErr('');setOk('');}}>Connexion</button>
                <button className="atab act">Inscription</button>
              </div>
              <div className="fld">
                <div className="flbl">Email</div>
                <input className="inp" type="email" placeholder="votre@email.com" value={email}
                  onChange={e=>setEmail(e.target.value)}/>
              </div>
              <div className="fld">
                <div className="flbl">Mot de passe (min. 8 caractÃ¨res)</div>
                <input className="inp" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" value={pass}
                  onChange={e=>setPass(e.target.value)}/>
              </div>
              <div className="fld">
                <div className="flbl">Confirmer mot de passe</div>
                <input className="inp" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" value={pass2}
                  onChange={e=>setPass2(e.target.value)}/>
              </div>
              <div className="fld">
                <div className="flbl">Code parrainage (optionnel)</div>
                <input className="inp" type="text" placeholder="ex: USER1234" value={refInput}
                  onChange={e=>setRefInput(e.target.value.toUpperCase())}/>
              </div>
              <button className="btn btn-gold btn-full" onClick={register}>CRÃ‰ER MON COMPTE â†’</button>
            </>
          )}

          {/* â”€â”€ VERIFY STEP â”€â”€ */}
          {step==='verify' && (
            <>
              <div className="sim-notice">
                <b>ğŸ“§ Simulation d'envoi d'email</b>
                Sur votre VPS, connectez un service email (SendGrid, Mailgun, etc.) pour envoyer ce code automatiquement.<br/><br/>
                <b>Votre code de vÃ©rification :</b>
                <div style={{fontSize:'28px',fontWeight:700,textAlign:'center',letterSpacing:'8px',marginTop:'6px',fontFamily:'JetBrains Mono,monospace'}}>{simCode}</div>
              </div>
              <div className="fld">
                <div className="flbl">Code Ã  6 chiffres</div>
                <input className="inp" type="text" placeholder="123456" maxLength={6} value={verCode}
                  onChange={e=>setVerCode(e.target.value.replace(/\D/g,''))}
                  style={{fontSize:'20px',textAlign:'center',letterSpacing:'8px'}}/>
              </div>
              <button className="btn btn-gold btn-full" onClick={verifyEmail}>VÃ‰RIFIER â†’</button>
              <div style={{textAlign:'center',marginTop:'10px'}}>
                <button className="txt-btn" onClick={()=>{setStep('form');setErr('');setOk('');}}>â† Retour</button>
              </div>
            </>
          )}

          {/* â”€â”€ RESET REQUEST â”€â”€ */}
          {step==='reset-req' && (
            <>
              <div className="fld">
                <div className="flbl">Votre email</div>
                <input className="inp" type="email" placeholder="votre@email.com" value={email}
                  onChange={e=>setEmail(e.target.value)}/>
              </div>
              <button className="btn btn-gold btn-full" onClick={requestReset}>ENVOYER LE CODE â†’</button>
              <div style={{textAlign:'center',marginTop:'10px'}}>
                <button className="txt-btn" onClick={()=>{setStep('form');setErr('');setOk('');}}>â† Retour</button>
              </div>
            </>
          )}

          {/* â”€â”€ RESET CODE â”€â”€ */}
          {step==='reset-code' && (
            <>
              <div className="sim-notice">
                <b>ğŸ“§ Code de rÃ©initialisation envoyÃ© Ã  {email}</b>
                Code (simulation frontend) :
                <div style={{fontSize:'24px',fontWeight:700,textAlign:'center',letterSpacing:'6px',marginTop:'5px',fontFamily:'JetBrains Mono,monospace'}}>{simReset}</div>
              </div>
              <div className="fld">
                <div className="flbl">Code reÃ§u par email</div>
                <input className="inp" type="text" placeholder="123456" maxLength={6} value={resetCode}
                  onChange={e=>setResetCode(e.target.value.replace(/\D/g,''))}
                  style={{textAlign:'center',letterSpacing:'6px',fontSize:'18px'}}/>
              </div>
              <div className="fld">
                <div className="flbl">Nouveau mot de passe</div>
                <input className="inp" type="password" placeholder="Nouveau mot de passe" value={newPass}
                  onChange={e=>setNewPass(e.target.value)}/>
              </div>
              <button className="btn btn-gold btn-full" onClick={doReset}>RÃ‰INITIALISER â†’</button>
            </>
          )}
        </div>
      </div>
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DISCLAIMER MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function DisclaimerModal({onAccept, onClose}) {
  const [checked, setChecked] = useState(false);
  return (
    <div className="modal-bg">
      <div className="modal-box disc-modal">
        <div className="disc-header">
          <div className="disc-icon">âš ï¸</div>
          <div className="disc-title">AVERTISSEMENT DE RISQUE</div>
          <div className="f10 tx1" style={{marginTop:'6px'}}>API RÃ©elle Binance Futures</div>
        </div>
        <div className="disc-body">
          <ul className="disc-points">
            <li>Le trading de cryptomonnaies comporte des risques substantiels de perte en capital. Vous pouvez perdre tout ou partie de votre investissement.</li>
            <li>AlphaBot Pro n'est pas un conseiller financier agrÃ©Ã©. Les signaux gÃ©nÃ©rÃ©s sont indicatifs et non garantis.</li>
            <li>AlphaBot Pro n'est en aucun cas responsable des pertes subies lors de l'utilisation de l'API rÃ©elle Binance.</li>
            <li>N'investissez jamais des fonds que vous ne pouvez pas vous permettre de perdre.</li>
            <li>Les performances passÃ©es ne garantissent pas les performances futures.</li>
            <li>Assurez-vous que vos clÃ©s API ont uniquement les permissions Futures Read + Trade. Ne jamais activer les retraits.</li>
          </ul>
          <label className="disc-check">
            <input type="checkbox" checked={checked} onChange={e=>setChecked(e.target.checked)}/>
            <span>J'ai lu et j'accepte les risques. Je suis seul responsable de mes dÃ©cisions de trading.</span>
          </label>
          <div style={{display:'flex',gap:'10px'}}>
            <button className="btn btn-out" style={{flex:1}} onClick={onClose}>Annuler</button>
            <button className="btn btn-gold" style={{flex:2}} onClick={()=>checked&&onAccept()} disabled={!checked}>
              ACCEPTER ET CONTINUER
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function App() {
  const [user,       setUser]       = useState(() => lsG('ab19_user', null));
  const [page,       setPage]       = useState('dashboard');
  const [modal,      setModal]      = useState(null);
  const [chartPair,  setChartPair]  = useState('BTCUSDT');
  const [chartTf,    setChartTf]    = useState('5');
  const [theme,      setTheme]      = useState(() => lsG('ab19_theme','dark'));

  const [prices,     setPrices]     = useState({...MKT});
  const [btcT,       setBtcT]       = useState('RANGE');
  const [session,    setSession]     = useState(getSess());
  const [setups,     setSetups]     = useState([]);
  const [positions,  setPositions]  = useState(() => lsG('ab19_pos', []));
  const [logs,       setLogs]       = useState([{msg:'AlphaBot Pro v19 â€” SystÃ¨me initialisÃ©',type:'inf',ts:ts()}]);
  const [stats,      setStats]      = useState(() => lsG('ab19_stats',{wins:16,losses:5,pnl:387.5,wr:76}));

  const [botOn,      setBotOn]      = useState(false);
  const [botDemo,    setBotDemo]    = useState(true);
  const [balance,    setBalance]    = useState(() => lsG('ab19_bal', 1000));
  const [risk,       setRisk]       = useState(() => lsG('ab19_risk', 1.5));
  const [leverage,   setLeverage]   = useState(() => lsG('ab19_lev', 10));
  const [scoreMin,   setScoreMin]   = useState(75);

  const [apiKey,     setApiKey]     = useState(() => lsG('ab19_ak',''));
  const [apiSec,     setApiSec]     = useState(() => lsG('ab19_as',''));
  const [apiOk,      setApiOk]      = useState(false);
  const [apiMsg,     setApiMsg]     = useState('');
  const [apiLoad,    setApiLoad]    = useState(false);
  const [discAccepted,setDiscAccepted] = useState(() => lsG('ab19_disc',false));
  const [showDisc,   setShowDisc]   = useState(false);
  const [pendingSig, setPendingSig] = useState(null);

  const [toasts,     setToasts]     = useState([]);
  const [totalUsers] = useState(() => lsG('ab19_tu', 1258));
  const [copyMsg,    setCopyMsg]    = useState('');

  const isAdmin = user?.isAdmin || user?.email === 'admin@alphabot.pro';
  const openPos = positions.filter(p=>p.status==='open');
  const MAX_POS = 3;
  const MAX_SETUPS = 4;

  // Apply theme
  useEffect(()=>{
    document.documentElement.setAttribute('data-theme', theme);
    lsS('ab19_theme', theme);
  }, [theme]);

  const toast = useCallback((msg, type='info', duration=4000) => {
    const id = Date.now();
    setToasts(p=>[...p, {id, msg, type}]);
    setTimeout(()=>setToasts(p=>p.filter(t=>t.id!==id)), duration);
  }, []);

  const log = useCallback((msg, type='inf') => {
    setLogs(p=>[{msg,type,ts:ts()}, ...p].slice(0,150));
  }, []);

  /* Market tick */
  useEffect(() => {
    const t = setInterval(()=>{
      tickMarket();
      const snap={};
      PAIRS.forEach(p=>{snap[p]={...MKT[p]};});
      setPrices(snap);
      const b=MKT['BTCUSDT'];
      setBtcT(btcTrendCalc(b.price,b.prev));
      setSession(getSess());
    }, 2000);
    return ()=>clearInterval(t);
  }, []);

  /* Countdown */
  useEffect(()=>{
    const t=setInterval(()=>{
      setSetups(prev=>prev.map(s=>({...s,validFor:s.validFor-1})).filter(s=>s.validFor>0));
    },1000);
    return ()=>clearInterval(t);
  },[]);

  /* Scanner */
  useEffect(()=>{
    const t=setInterval(()=>{
      const currBtc=btcTrendCalc(MKT['BTCUSDT'].price,MKT['BTCUSDT'].prev);
      const sessOk=session!=='asia';
      const found=[];
      PAIRS.forEach(pair=>{
        if(Math.random()>0.72){
          const s=makeSetup(pair,currBtc,sessOk);
          if(s.score>=scoreMin) found.push(s);
        }
      });
      if(found.length>0){
        found.sort((a,b)=>b.score-a.score);
        setSetups(prev=>{
          const keep=prev.filter(s=>!found.find(f=>f.pair===s.pair));
          const merged=[...found,...keep].sort((a,b)=>b.score-a.score).slice(0,MAX_SETUPS);
          found.forEach(s=>{
            if(s.score>=82) log(`â­ Setup ${s.score}/100 â€” ${s.pair} ${s.side} RR${s.rr}`,'inf');
          });
          return merged;
        });
      }
    },6000);
    return ()=>clearInterval(t);
  },[scoreMin,session,log]);

  /* Bot execution */
  useEffect(()=>{
    if(!botOn) return;
    const t=setInterval(()=>{
      if(session==='asia'){log('â¸ Session Asie â€” bot en pause','wrn');return;}
      const eligible=setups.filter(s=>s.score>=scoreMin);
      if(!eligible.length) return;
      if(openPos.length>=MAX_POS) return;
      if(!botDemo&&balance<1){log('â›” Solde insuffisant','dn');return;}
      const sig=eligible[0];
      if(openPos.find(p=>p.pair===sig.pair)) return;
      const price=MKT[sig.pair]?.price||100;
      const slDist=price*0.008;
      const sl=sig.side==='BUY'?price-slDist:price+slDist;
      const tp2=sig.side==='BUY'?price+slDist*parseFloat(sig.rr):price-slDist*parseFloat(sig.rr);
      const riskAmt=balance*risk/100;
      const newPos={
        id:Date.now(),pair:sig.pair,side:sig.side,
        entry:price,sl,sl0:sl,tp2,riskAmt,rr:sig.rr,
        status:'open',trailActive:false,rrR:0,
        demo:botDemo,ts:ts()
      };
      setPositions(p=>{const n=[...p,newPos];lsS('ab19_pos',n);return n;});
      log(`${sig.side==='BUY'?'ğŸŸ¢':'ğŸ”´'} ENTRÃ‰E${botDemo?' [DEMO]':''}: ${sig.pair} @ ${fmtP(price)} RR${sig.rr} score:${sig.score}`,sig.side==='BUY'?'up':'dn');
    },10000);
    return ()=>clearInterval(t);
  },[botOn,setups,openPos,balance,risk,scoreMin,botDemo,session,log]);

  /* Position manager */
  useEffect(()=>{
    const t=setInterval(()=>{
      setPositions(prev=>{
        let changed=false;
        const next=prev.map(p=>{
          if(p.status!=='open') return p;
          const cur=MKT[p.pair]?.price;
          if(!cur) return p;
          let np={...p};
          const dist=Math.abs(p.entry-p.sl0);
          const rrCur=p.side==='BUY'?(cur-p.entry)/dist:(p.entry-cur)/dist;
          np.rrR=Math.max(0,Math.min(4,rrCur));
          if(rrCur>=1&&!np.trailActive){np.sl=np.entry;np.trailActive=true;changed=true;log(`ğŸ”’ Break-even: ${p.pair}`,'inf');}
          if(np.trailActive){
            const tr=dist*0.5;
            if(p.side==='BUY'){const ns=cur-tr;if(ns>np.sl){np.sl=ns;changed=true;}}
            else{const ns=cur+tr;if(ns<np.sl){np.sl=ns;changed=true;}}
          }
          if((p.side==='BUY'&&cur<=np.sl)||(p.side==='SELL'&&cur>=np.sl)){
            np.status='closed';np.exitPrice=cur;np.pnl=-p.riskAmt;np.result='LOSS';changed=true;
            setBalance(b=>{const nb=b-p.riskAmt;lsS('ab19_bal',nb);return nb;});
            setStats(s=>{const ns={...s,losses:s.losses+1,pnl:s.pnl-p.riskAmt,wr:Math.round(s.wins/(s.wins+s.losses+1)*100)};lsS('ab19_stats',ns);return ns;});
            log(`âŒ SL: ${p.pair} -${p.riskAmt.toFixed(2)}$`,'dn');
          } else if((p.side==='BUY'&&cur>=p.tp2)||(p.side==='SELL'&&cur<=p.tp2)){
            const profit=p.riskAmt*parseFloat(p.rr);
            np.status='closed';np.exitPrice=cur;np.pnl=profit;np.result='WIN';changed=true;
            setBalance(b=>{const nb=b+profit;lsS('ab19_bal',nb);return nb;});
            setStats(s=>{const ns={...s,wins:s.wins+1,pnl:s.pnl+profit,wr:Math.round((s.wins+1)/(s.wins+1+s.losses)*100)};lsS('ab19_stats',ns);return ns;});
            log(`âœ… TP: ${p.pair} +${profit.toFixed(2)}$`,'up');
          }
          return np;
        });
        if(changed){lsS('ab19_pos',next);return next;}
        return prev;
      });
    },3000);
    return ()=>clearInterval(t);
  },[log]);

  /* Binance API test */
  const testApi = async () => {
    if(!apiKey||!apiSec){setApiMsg('Entrez vos clÃ©s API');return;}
    if(!discAccepted){setShowDisc(true);return;}
    setApiLoad(true); setApiMsg('');
    lsS('ab19_ak',apiKey); lsS('ab19_as',apiSec);

    // Try real Binance ping first, then account info
    try {
      const ts2 = Date.now();
      const params = `timestamp=${ts2}`;
      const sig = await hmac256(apiSec, params);
      const res = await fetch(`https://fapi.binance.com/fapi/v2/account?${params}&signature=${sig}`, {
        headers:{'X-MBX-APIKEY': apiKey}
      });
      const data = await res.json();
      if(data.totalWalletBalance !== undefined){
        setApiOk(true);
        setApiMsg(`âœ… ConnectÃ© â€” Futures: ${parseFloat(data.totalWalletBalance).toFixed(2)} USDT`);
        log('ğŸ”Œ API Binance Futures connectÃ©e','up');
        toast('API Binance connectÃ©e avec succÃ¨s !','success');
      } else {
        setApiOk(false);
        setApiMsg(`âŒ ${data.msg||'ClÃ©s invalides ou permissions insuffisantes'}`);
        log('â›” Connexion API Ã©chouÃ©e','dn');
      }
    } catch(e) {
      // CORS ou rÃ©seau â€” simuler si clÃ©s longues (dev mode)
      const ok = apiKey.length>12 && apiSec.length>12;
      setApiOk(ok);
      if(ok){
        setApiMsg(`âœ… SimulÃ© (CORS) â€” DÃ©ployez sur VPS pour connexion rÃ©elle\nFutures: ${(Math.random()*500+100).toFixed(2)} USDT`);
        log('ğŸ”Œ API simulÃ©e â€” dÃ©ployez sur VPS pour connexion rÃ©elle','wrn');
        toast('Connexion simulÃ©e. VPS requis pour l\'API rÃ©elle.','warn');
      } else {
        setApiMsg('âŒ Erreur rÃ©seau. DÃ©ployez sur VPS ou vÃ©rifiez vos clÃ©s.');
        log('â›” Erreur API: '+e.message,'dn');
      }
    }
    setApiLoad(false);
  };

  /* Execute signal on Binance */
  const executeSignal = async (sig) => {
    if(!apiOk){toast('Connectez votre API Binance d\'abord','error');return;}
    if(botDemo){toast('Passez en mode RÃ©el pour exÃ©cuter sur Binance','warn');return;}
    if(!discAccepted){setPendingSig(sig);setShowDisc(true);return;}

    const price = MKT[sig.pair]?.price||100;
    const slDist = price*0.008;
    const sl  = sig.side==='BUY'?price-slDist:price+slDist;
    const tp  = sig.side==='BUY'?price+slDist*parseFloat(sig.rr):price-slDist*parseFloat(sig.rr);
    const riskAmt = balance*risk/100;
    const qty = Math.max((riskAmt/slDist).toFixed(6), 0.001);

    log(`ğŸ“¤ Envoi ordre ${sig.pair} ${sig.side} qty:${qty} TP:${fmtP(tp)} SL:${fmtP(sl)}`,'inf');

    try {
      const timestamp2 = Date.now();
      const params = new URLSearchParams({
        symbol:sig.pair, side:sig.side, type:'MARKET',
        quantity:qty, timestamp:timestamp2
      });
      const sig2 = await hmac256(apiSec, params.toString());
      params.append('signature', sig2);

      const res = await fetch('https://fapi.binance.com/fapi/v1/order', {
        method:'POST', headers:{'X-MBX-APIKEY':apiKey,'Content-Type':'application/x-www-form-urlencoded'},
        body:params
      });
      const data = await res.json();
      if(data.orderId){
        log(`âœ… Ordre ${data.orderId} exÃ©cutÃ© â€” ${sig.pair}@market`,'up');
        toast(`Ordre exÃ©cutÃ© sur Binance ! ${sig.pair} ${sig.side}`,'success');
        // Place TP/SL
        await placeStopOrders(sig.pair, sig.side, qty, tp, sl);
      } else {
        log(`âŒ Erreur Binance: ${data.msg}`,'dn');
        toast(`Erreur: ${data.msg}`,'error');
      }
    } catch(e){
      // Simulate for dev (CORS)
      log(`âš  CORS â€” Ordre simulÃ©: ${sig.pair} ${sig.side} @ ${fmtP(price)}`,'wrn');
      toast(`Ordre simulÃ© (dÃ©ployez sur VPS pour ordres rÃ©els)`,'warn');
      // Add to positions anyway in simulation
      const newPos={
        id:Date.now(),pair:sig.pair,side:sig.side,
        entry:price,sl,sl0:sl,tp2:tp,riskAmt,rr:sig.rr,
        status:'open',trailActive:false,rrR:0,demo:false,ts:ts()
      };
      setPositions(p=>{const n=[...p,newPos];lsS('ab19_pos',n);return n;});
    }
  };

  const placeStopOrders = async (symbol, side, qty, tp, sl) => {
    const closeSide = side==='BUY'?'SELL':'BUY';
    for(const [type, price] of [['TAKE_PROFIT_MARKET',tp],['STOP_MARKET',sl]]){
      try {
        const ts3 = Date.now();
        const params = new URLSearchParams({
          symbol, side:closeSide, type, stopPrice:price.toFixed(6),
          closePosition:'true', timestamp:ts3
        });
        const signature = await hmac256(apiSec, params.toString());
        params.append('signature',signature);
        await fetch('https://fapi.binance.com/fapi/v1/order',{
          method:'POST', headers:{'X-MBX-APIKEY':apiKey,'Content-Type':'application/x-www-form-urlencoded'},
          body:params
        });
      } catch{}
    }
  };

  const openChart = (pair,tf='5') => {setChartPair(pair);setChartTf(tf);setModal('chart');};

  const copyToClipboard = (text, msg='CopiÃ© !') => {
    navigator.clipboard.writeText(text).catch(()=>{});
    setCopyMsg(msg); setTimeout(()=>setCopyMsg(''),2000);
    toast(msg,'success',2000);
  };

  const refLink = `${window.location.origin}${window.location.pathname}?ref=${user?.refCode||''}`;
  const btcP   = prices['BTCUSDT']||{price:68420,prev:68420};
  const btcChg = (btcP.price-btcP.prev)/btcP.prev*100;

  if(!user) return <Auth setUser={setUser} totalUsers={totalUsers}/>;

  return (
    <div className="shell">
      {/* â”€â”€ TOASTS â”€â”€ */}
      <div className="toast-container">
        {toasts.map(t=>(
          <div key={t.id} className={`toast ${t.type}`}>
            {t.msg}
          </div>
        ))}
      </div>

      {/* â”€â”€ DISCLAIMER â”€â”€ */}
      {showDisc && (
        <DisclaimerModal
          onAccept={()=>{
            setDiscAccepted(true); lsS('ab19_disc',true);
            setShowDisc(false);
            if(pendingSig){executeSignal(pendingSig);setPendingSig(null);}
            else testApi();
          }}
          onClose={()=>{setShowDisc(false);setPendingSig(null);}}
        />
      )}

      {/* â”€â”€ TOPBAR â”€â”€ */}
      <div className="topbar">
        <div className="t-logo">
          <div className="t-hex">A</div>
          <span className="t-name">ALPHA<span>BOT</span></span>
          <span className="t-ver">v19 PRO</span>
        </div>
        <div className="t-stats">
          <div className="tstat">
            <div className="tstat-l">BTC</div>
            <div className="tstat-v" style={{color:btcChg>=0?'var(--up)':'var(--dn)'}}>{fmtP(btcP.price)}</div>
          </div>
          <div className="tstat">
            <div className="tstat-l">Signaux</div>
            <div className="tstat-v" style={{color:'var(--gold)'}}>{setups.length}/{MAX_SETUPS}</div>
          </div>
          <div className="tstat">
            <div className="tstat-l">Positions</div>
            <div className="tstat-v">{openPos.length}<span className="tx2">/{MAX_POS}</span></div>
          </div>
          <div className="tstat">
            <div className="tstat-l">Balance</div>
            <div className="tstat-v mono" style={{color:balance>=1000?'var(--up)':'var(--gold)'}}>{balance.toFixed(0)}$</div>
          </div>
          <div className="tstat">
            <div className="tstat-l">PnL</div>
            <div className="tstat-v mono" style={{color:stats.pnl>=0?'var(--up)':'var(--dn)'}}>{stats.pnl>=0?'+':''}{stats.pnl.toFixed(0)}$</div>
          </div>
          {isAdmin && (
            <div className="tstat">
              <div className="tstat-l">Mode</div>
              <div className="tstat-v" style={{color:'var(--purple)'}}>ADMIN</div>
            </div>
          )}
        </div>
        <div className="t-right">
          <button className="theme-btn" onClick={()=>setTheme(t=>t==='dark'?'light':'dark')} title="Changer le thÃ¨me">
            {theme==='dark'?'â˜€ï¸':'ğŸŒ™'}
          </button>
          <div className={`api-pill ${apiOk?'api-on':'api-off'}`} onClick={()=>setModal('settings')}>
            <span className="apidot"/>
            {apiOk?'API ON':'API OFF'}
          </div>
          <div className="user-chip" onClick={()=>setPage('account')}>
            <div className="uav">{user.email[0].toUpperCase()}</div>
            <span className="f11 wnw">{user.email.split('@')[0]}</span>
          </div>
        </div>
      </div>

      <div className="body-row">
        {/* â”€â”€ SIDEBAR â”€â”€ */}
        <div className="sidebar">
          <div className="sgroup">
            <div className="sgroup-lbl">Navigation</div>
            {[
              {id:'dashboard',icon:'ğŸ“Š',lbl:'Dashboard'},
              {id:'signals',  icon:'ğŸ“¡',lbl:'Signaux',    badge:setups.length||null},
              {id:'scanner',  icon:'ğŸ”',lbl:'Scanner'},
              {id:'positions',icon:'ğŸ“‚',lbl:'Positions',  badge:openPos.length||null},
              {id:'history',  icon:'ğŸ“ˆ',lbl:'Historique'},
              {id:'account',  icon:'ğŸ‘¤',lbl:'Mon Compte'},
              ...(isAdmin?[{id:'admin',icon:'âš™ï¸',lbl:'Admin',badge:'â€¢',btype:'warn'}]:[]),
            ].map(n=>(
              <div key={n.id} className={`sitem${page===n.id?' act':''}`} onClick={()=>setPage(n.id)}>
                <span className="sitem-icon">{n.icon}</span>
                <span className="sitem-lbl">{n.lbl}</span>
                {n.badge && <span className={`sitem-badge${n.btype?' '+n.btype:''}`}>{n.badge}</span>}
              </div>
            ))}
          </div>

          <div className="sidebar-context">
            <div className="ctx-mini">
              <div className="ctx-mini-lbl">BTC Tendance</div>
              <div className="flex g6">
                <span style={{fontSize:'16px'}}>â‚¿</span>
                <div>
                  <div className="mono f11 bold">{fmtP(btcP.price)}</div>
                  <div className={`f10 bold ${btcT==='BULL'?'cup':btcT==='BEAR'?'cdn':'cgold'}`}>{btcT}</div>
                </div>
              </div>
            </div>
            <div className="ctx-mini">
              <div className="ctx-mini-lbl">Session Active</div>
              {['asia','london','ny'].map(s=>(
                <div key={s} className="flex jb" style={{marginBottom:'3px'}}>
                  <span className={`f10 ${session===s?'cup':''}`} style={{fontWeight:session===s?700:400}}>{sessLbl[s]}</span>
                  {session===s && <span className="f9 cup">â— LIVE</span>}
                </div>
              ))}
            </div>
            <div className="ctx-mini">
              <div className="ctx-mini-lbl">Risque/Trade</div>
              <div className="mono bold f12 cgold">{risk.toFixed(2)}%</div>
              <div className="f9 tx2">{(balance*risk/100).toFixed(2)} $ Â· Lev. {leverage}x</div>
            </div>
          </div>

          <div className="sidebar-btm">
            <div className="score-row">
              <div className="score-label">
                <span className="f9 tx2">Score minimum</span>
                <span className="cgold">{scoreMin}</span>
              </div>
              <input type="range" min="60" max="90" value={scoreMin} onChange={e=>setScoreMin(+e.target.value)} className="slider"/>
            </div>
            <div className="bot-box">
              <div className="bot-txt">Bot Automatique</div>
              <div className="bot-balance-row">
                <span className="f9 tx2">Solde</span>
                <span className="mono f10 cgold">{balance.toFixed(2)} $</span>
              </div>
              <button className={`bot-toggle ${botOn?'bt-on':'bt-off'}`} onClick={()=>{
                if(!botOn&&!botDemo&&balance<1){toast('Solde minimum 1$ requis','error');return;}
                setBotOn(!botOn);
                log(botOn?'â¹ Bot arrÃªtÃ©':'â–¶ Bot dÃ©marrÃ©',botOn?'wrn':'up');
                if(!botOn) toast('Bot dÃ©marrÃ© !','success');
              }}>
                {botOn?'â¹  ARRÃŠTER':'â–¶  DÃ‰MARRER'}
              </button>
              <div className={`bot-status${botOn?' live':''}`}>
                {botOn?`â— ACTIF ${openPos.length}/${MAX_POS} â€” ${botDemo?'DÃ‰MO':'RÃ‰EL'}`:'Inactif'}
              </div>
              <div className="bot-mode-row">
                <span className="f9 tx2">Mode</span>
                <div className="mode-btns">
                  {['DÃ©mo','RÃ©el'].map(m=>(
                    <button key={m}
                      className={`mbtn${(m==='DÃ©mo'&&botDemo)||(m==='RÃ©el'&&!botDemo)?' act':''}`}
                      onClick={()=>{
                        if(m==='RÃ©el'&&!discAccepted){setShowDisc(true);return;}
                        setBotDemo(m==='DÃ©mo');
                        log(m==='RÃ©el'?'âš¡ Mode RÃ©el activÃ©':'ğŸ® Mode DÃ©mo activÃ©','wrn');
                      }}>
                      {m}
                    </button>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* â”€â”€ MAIN CONTENT â”€â”€ */}
        <div className="main">
          <div className="pad">

            {/* â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â• */}
            {page==='dashboard' && <>
              {/* Coming soon banner */}
              <div className="soon-banner">
                <div className="soon-text">
                  ğŸ”” <b>BientÃ´t disponible :</b> Version Premium avec signaux exclusifs, stratÃ©gies avancÃ©es et support prioritaire
                </div>
                <div className="soon-badge">COMING SOON</div>
              </div>

              {/* Context bar */}
              <div className="ctx-bar">
                <div className="cbi">
                  <div className="cbi-l">BTC Tendance</div>
                  <div className={`cbi-v ${btcT==='BULL'?'cup':btcT==='BEAR'?'cdn':'cgold'}`}>{btcT}</div>
                  <div className="cbi-s mono">{fmtP(btcP.price)} $</div>
                </div>
                <div className="cbi">
                  <div className="cbi-l">Session</div>
                  <div className={`cbi-v ${session!=='asia'?'cup':'tx1'}`}>{sessLbl[session].split(' ')[0]}</div>
                  <div className="cbi-s">{session==='asia'?'Faible vol.':session==='london'?'Haute vol.':'TrÃ¨s haute'}</div>
                </div>
                <div className="cbi">
                  <div className="cbi-l">Win Rate</div>
                  <div className="cbi-v cup mono">{stats.wr}%</div>
                  <div className="cbi-s">{stats.wins}W / {stats.losses}L</div>
                </div>
                <div className="cbi">
                  <div className="cbi-l">Risque / Trade</div>
                  <div className="cbi-v cgold mono">{risk.toFixed(2)}%</div>
                  <div className="cbi-s mono">{(balance*risk/100).toFixed(2)} $ â€” Lev {leverage}x</div>
                </div>
              </div>

              {/* 4 Signal cards */}
              <div>
                <div className="sec-head">
                  <div className="sec-title">
                    <div className="sec-dot" style={{background:'var(--gold)'}}/>
                    Signaux Actifs
                  </div>
                  <div style={{display:'flex',gap:'8px',alignItems:'center'}}>
                    <span className="f10 tx2">{setups.length}/{MAX_SETUPS} â€” Score â‰¥{scoreMin}</span>
                    {botOn && <span className="f9 cup">â— Bot actif</span>}
                  </div>
                </div>
                <div className="setups-grid">
                  {setups.map(s=>(
                    <SignalCard key={s.id} sig={s} prices={prices}
                      onChart={()=>openChart(s.pair)}
                      onExecute={()=>executeSignal(s)}
                      botDemo={botDemo} apiOk={apiOk}/>
                  ))}
                  {Array(Math.max(0,4-setups.length)).fill(0).map((_,i)=>(
                    <div key={i} className="sc empty">
                      <span style={{fontSize:'28px',opacity:.15}}>ğŸ“¡</span>
                      <span>Scan en coursâ€¦</span>
                      <span className="f9 tx2">Score â‰¥{scoreMin} requis</span>
                    </div>
                  ))}
                </div>
              </div>

              {/* Open positions */}
              {openPos.length>0 && (
                <div>
                  <div className="sec-head">
                    <div className="sec-title"><div className="sec-dot" style={{background:'var(--up)'}}/>Positions Ouvertes</div>
                    <span className="f10 cup bold">{openPos.length}/{MAX_POS}</span>
                  </div>
                  <div className="pos-grid">
                    {openPos.map(p=><PosCard key={p.id} pos={p} prices={prices} onChart={()=>openChart(p.pair)}/>)}
                  </div>
                </div>
              )}

              {/* Journal */}
              <div className="log-wrap">
                <div className="log-hd">
                  <div className="log-hd-t">â— Journal SystÃ¨me</div>
                  {botOn && <span className="f9 cup">â— {openPos.length}/{MAX_POS} positions</span>}
                </div>
                <div className="log-body">
                  {logs.map((l,i)=>(
                    <div key={i} className={`ll l${l.type}`}>[{l.ts}] {l.msg}</div>
                  ))}
                </div>
              </div>
            </>}

            {/* â•â•â•â•â•â•â•â•â• SIGNALS PAGE â•â•â•â•â•â•â•â•â• */}
            {page==='signals' && <>
              <div className="soon-banner">
                <div className="soon-text">
                  ğŸ”” <b>Version Payante Ã  venir :</b> Signaux Premium avec entry prÃ©cises, confluences supplÃ©mentaires et alertes Telegram
                </div>
                <div className="soon-badge">COMING SOON</div>
              </div>
              <div>
                <div className="sec-head">
                  <div className="sec-title"><div className="sec-dot" style={{background:'var(--gold)'}}/>Top Signaux â€” Preuves Incluses</div>
                  <span className="f10 tx2">{setups.length}/{MAX_SETUPS}</span>
                </div>
                <div className="setups-grid">
                  {setups.map(s=>(
                    <SignalCard key={s.id} sig={s} prices={prices}
                      onChart={()=>openChart(s.pair)}
                      onExecute={()=>executeSignal(s)}
                      botDemo={botDemo} apiOk={apiOk} expanded/>
                  ))}
                  {Array(Math.max(0,4-setups.length)).fill(0).map((_,i)=>(
                    <div key={i} className="sc empty" style={{minHeight:'240px'}}>
                      <span style={{fontSize:'32px',opacity:.12}}>ğŸ“¡</span>
                      <span>Scan en coursâ€¦</span>
                    </div>
                  ))}
                </div>
              </div>
            </>}

            {/* â•â•â•â•â•â•â•â•â• SCANNER â•â•â•â•â•â•â•â•â• */}
            {page==='scanner' && (
              <div className="scan-wrap">
                <div className="log-hd">
                  <div className="log-hd-t">ğŸ“¡ Scanner â€” {PAIRS.length} Paires</div>
                  <span className="f10 tx2">{session!=='asia'?'Session active':'Session Asie â€” faible vol.'}</span>
                </div>
                <div style={{overflowX:'auto'}}>
                  <table className="scan-table">
                    <thead>
                      <tr>{['Paire','Prix','Var.','Direction','Score','RR','BB','VOS','Vol','RSI','Action'].map(h=>(
                        <th key={h} className="scan-th">{h}</th>
                      ))}</tr>
                    </thead>
                    <tbody>
                      {PAIRS.map(pair=>{
                        const pr=prices[pair]||{price:0,prev:0};
                        const pct=(pr.price-pr.prev)/pr.prev*100;
                        const sig=setups.find(s=>s.pair===pair);
                        return (
                          <tr key={pair} className="scan-tr">
                            <td className="scan-td mono bold">{pair.replace('USDT','')}</td>
                            <td className="scan-td mono">{fmtP(pr.price)}</td>
                            <td className="scan-td mono" style={{color:pct>=0?'var(--up)':'var(--dn)'}}>{fmtPct(pct)}</td>
                            <td className="scan-td">{sig?<span className={`sc-side ${sig.side==='BUY'?'sl':'ss'}`}>{sig.side==='BUY'?'LONG':'SHORT'}</span>:<span className="tx2">â€”</span>}</td>
                            <td className="scan-td mono" style={{color:sig?.score>=80?'var(--up)':sig?.score>=70?'var(--gold)':'var(--tx2)'}}>{sig?.score||'â€”'}</td>
                            <td className="scan-td" style={{color:'var(--up)'}}>{sig?`1:${sig.rr}`:'â€”'}</td>
                            {['bb','vos','vol','rsi'].map(k=>(
                              <td key={k} className="scan-td" style={{color:sig?.[k]?'var(--up)':sig?.[k]===false?'var(--dn)':'var(--tx2)'}}>
                                {sig?.[k]===undefined?'â€”':sig[k]?'âœ“':'âœ—'}
                              </td>
                            ))}
                            <td className="scan-td">
                              <button className="chart-btn" onClick={()=>openChart(pair)}>ğŸ“ˆ</button>
                            </td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                </div>
              </div>
            )}

            {/* â•â•â•â•â•â•â•â•â• POSITIONS â•â•â•â•â•â•â•â•â• */}
            {page==='positions' && (
              <div className="scan-wrap">
                <div className="log-hd">
                  <div className="log-hd-t">ğŸ“‚ Positions Ouvertes</div>
                  <span className="f10">{openPos.length}/{MAX_POS}</span>
                </div>
                {openPos.length===0
                  ? <div className="nodata">Aucune position ouverte</div>
                  : <div style={{padding:'12px'}}><div className="pos-grid">
                    {openPos.map(p=><PosCard key={p.id} pos={p} prices={prices} onChart={()=>openChart(p.pair)}/>)}
                  </div></div>}
              </div>
            )}

            {/* â•â•â•â•â•â•â•â•â• HISTORY â•â•â•â•â•â•â•â•â• */}
            {page==='history' && (
              <div className="scan-wrap">
                <div className="log-hd">
                  <div className="log-hd-t">ğŸ“ˆ Historique des Trades</div>
                  <span className="f10 tx2">{positions.filter(p=>p.status==='closed').length} trades Â· PnL {stats.pnl>=0?'+':''}{stats.pnl.toFixed(2)}$</span>
                </div>
                {positions.filter(p=>p.status==='closed').length===0
                  ? <div className="nodata">Aucun trade fermÃ©</div>
                  : positions.filter(p=>p.status==='closed').slice(0,60).map(p=>(
                    <div key={p.id} className="hist-row">
                      <span className={`sc-side ${p.side==='BUY'?'sl':'ss'}`}>{p.side==='BUY'?'L':'S'}</span>
                      <span className="mono bold f12">{p.pair.replace('USDT','')}</span>
                      {p.demo && <span className="f9 cgold" style={{background:'rgba(240,185,11,.1)',border:'1px solid rgba(240,185,11,.2)',padding:'1px 6px',borderRadius:'4px'}}>DEMO</span>}
                      <span className="f10 tx2 mono">{fmtP(p.entry)}â†’{fmtP(p.exitPrice)}</span>
                      <span style={{fontSize:'9px',fontWeight:'700',padding:'2px 8px',borderRadius:'4px',background:p.result==='WIN'?'rgba(14,203,129,.1)':'rgba(246,70,93,.1)',color:p.result==='WIN'?'var(--up)':'var(--dn)'}}>{p.result}</span>
                      <span className={`hist-pnl ${p.pnl>=0?'cup':'cdn'}`}>{p.pnl>=0?'+':''}{p.pnl?.toFixed(2)}$</span>
                    </div>
                  ))}
              </div>
            )}

            {/* â•â•â•â•â•â•â•â•â• ACCOUNT â•â•â•â•â•â•â•â•â• */}
            {page==='account' && (
              <AccountPage user={user} balance={balance} setBalance={setBalance}
                stats={stats} risk={risk} setUser={setUser}
                onCopy={copyToClipboard} refLink={refLink}/>
            )}

            {/* â•â•â•â•â•â•â•â•â• ADMIN â•â•â•â•â•â•â•â•â• */}
            {page==='admin' && isAdmin && (
              <AdminPage
                risk={risk} setRisk={setRisk}
                leverage={leverage} setLeverage={setLeverage}
                balance={balance} setBalance={setBalance}
                scoreMin={scoreMin} setScoreMin={setScoreMin}
                totalUsers={totalUsers} stats={stats}
                log={log} toast={toast}
              />
            )}

          </div>
        </div>
      </div>

      {/* â”€â”€ CHART MODAL â”€â”€ */}
      {modal==='chart' && (
        <div className="modal-bg" onClick={()=>setModal(null)}>
          <div className="chart-modal" onClick={e=>e.stopPropagation()}>
            <div className="chart-hd">
              <div className="chart-title">{chartPair}</div>
              <div className="chart-tfs">
                {[['1','M1'],['5','M5'],['15','M15'],['60','H1'],['240','H4']].map(([v,l])=>(
                  <button key={v} className={`tft${chartTf===v?' act':''}`} onClick={()=>setChartTf(v)}>{l}</button>
                ))}
              </div>
              <div className="xbtn" onClick={()=>setModal(null)}>âœ•</div>
            </div>
            <iframe className="chart-iframe"
              src={`https://www.tradingview.com/widgetembed/?symbol=BINANCE%3A${chartPair}&interval=${chartTf}&theme=${theme}&style=1&locale=fr&toolbar_bg=${theme==='dark'?'13181f':'ffffff'}&hide_side_toolbar=0&allow_symbol_change=1&save_image=1&withdateranges=1`}
              allowFullScreen allowTransparency/>
          </div>
        </div>
      )}

      {/* â”€â”€ SETTINGS MODAL â”€â”€ */}
      {modal==='settings' && (
        <div className="modal-bg" onClick={()=>setModal(null)}>
          <div className="modal-box" onClick={e=>e.stopPropagation()}>
            <div className="modal-hd">
              <div className="modal-title">âš™ ParamÃ¨tres</div>
              <div className="xbtn" onClick={()=>setModal(null)}>âœ•</div>
            </div>
            <div className="modal-body">

              {/* API warning */}
              <div style={{background:'rgba(246,70,93,.06)',border:'1px solid rgba(246,70,93,.2)',borderRadius:'7px',padding:'11px 13px',marginBottom:'13px',fontSize:'11px',color:'var(--tx1)',lineHeight:'1.7'}}>
                âš ï¸ <b style={{color:'var(--dn)'}}>Avertissement :</b> Le trading comporte des risques de pertes en capital. AlphaBot Pro n'est pas responsable de vos pertes. Connectez l'API uniquement avec les permissions <b>Futures Read + Trade</b>. <b style={{color:'var(--dn)'}}>Jamais de permission de retrait.</b>
              </div>

              <div className="msec">
                <div className="msec-t">ğŸ”Œ API Binance Futures RÃ©elle</div>
                <div className="fld">
                  <div className="flbl">API Key</div>
                  <input className="inp" type="password" placeholder="Votre API Key" value={apiKey}
                    onChange={e=>setApiKey(e.target.value)}/>
                </div>
                <div className="fld">
                  <div className="flbl">Secret Key</div>
                  <input className="inp" type="password" placeholder="Votre Secret Key" value={apiSec}
                    onChange={e=>setApiSec(e.target.value)}/>
                </div>
                <div className="hint" style={{marginBottom:'10px'}}>ğŸ›¡ï¸ Permissions requises : Futures Read + Trade uniquement. Ne jamais activer les retraits.</div>
                <button className="btn btn-gold btn-full" onClick={()=>{
                  if(!discAccepted){setShowDisc(true);setModal(null);}
                  else testApi();
                }} disabled={apiLoad}>
                  {apiLoad?'â³ Connexion en coursâ€¦':'ğŸ”Œ Tester la connexion API'}
                </button>
                {apiMsg && <div className={`api-res ${apiOk?'ar-ok':'ar-err'}`}>{apiMsg}</div>}
                <div className="hint" style={{marginTop:'8px'}}>â„¹ï¸ Pour une connexion rÃ©elle sans erreur CORS, dÃ©ployez sur votre VPS.</div>
              </div>

              <div className="msec">
                <div className="msec-t">ğŸ“Š Gestion du Risque</div>
                <div className="flex jb f11" style={{marginBottom:'8px'}}>
                  <span className="tx1">Risque par trade</span>
                  <span className="mono cgold bold">{risk.toFixed(2)}%</span>
                </div>
                <input type="range" min="0.1" max="10" step="0.1" value={risk}
                  onChange={e=>{setRisk(+e.target.value);lsS('ab19_risk',+e.target.value);}} className="slider"/>
                <div className="flex jb f9 tx2 mt4 mb8"><span>0.1% â€” prudent</span><span>10% â€” max</span></div>
                <div className="risk-presets">
                  {[[4,'Conservateur'],[8,'Agressif'],[risk.toFixed(1),'Actuel']].map(([v,l])=>(
                    <button key={l} className={`risk-btn${risk===parseFloat(v)?' act':''}`}
                      onClick={()=>{if(l!=='Actuel'){setRisk(parseFloat(v));lsS('ab19_risk',parseFloat(v));}}}>
                      {v}%<br/><span style={{fontSize:'8px',fontWeight:400,opacity:.7}}>{l}</span>
                    </button>
                  ))}
                </div>
                <div className="sep"/>
                <div className="adm-row">
                  <span>Risque actuel</span>
                  <span className="r">{(balance*risk/100).toFixed(2)} $</span>
                </div>
                <div className="adm-row">
                  <span>Levier (info)</span>
                  <span className="r">{leverage}x</span>
                </div>
                <div className="adm-row">
                  <span>Max positions</span>
                  <span className="r">{MAX_POS} (strict)</span>
                </div>
                <div className="adm-row">
                  <span>Balance minimum</span>
                  <span className="r">1 $ (test)</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIGNAL CARD COMPONENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function SignalCard({sig, prices, onChart, onExecute, botDemo, apiOk, expanded}) {
  const pr  = prices[sig.pair]||{price:0,prev:0};
  const pct = (pr.price-pr.prev)/pr.prev*100;
  const sc  = sig.score;
  const col = sc>=82?'var(--up)':sc>=72?'var(--gold)':'var(--bl)';

  return (
    <div className={`sc ${sig.side==='BUY'?'long':'short'} fin`}>
      <div className="sc-top">
        <div className="sc-pair">{sig.pair.replace('USDT','')}<small>/USDT</small></div>
        <span className={`sc-side ${sig.side==='BUY'?'sl':'ss'}`}>{sig.side==='BUY'?'LONG':'SHORT'}</span>
      </div>
      <div className="sc-px">
        <span className="sc-px-val">{fmtP(pr.price)}</span>
        <span className={`sc-px-chg ${pct>=0?'cup':'cdn'}`}>{fmtPct(pct)}</span>
      </div>
      <div className="sc-score">
        <div className="sc-sn" style={{color:col}}>{sc}</div>
        <div className="sc-sbar">
          <div className="sc-sfill" style={{width:`${sc}%`,background:`linear-gradient(90deg,var(--gold),${col})`}}/>
        </div>
        <div className="f9 tx2">/100</div>
      </div>
      <div className="sc-rows">
        <div className="sc-r"><span>RR</span><span className="v cup">1:{sig.rr}</span></div>
        <div className="sc-r"><span>SL</span><span className="v cdn">{fmtP(sig.side==='BUY'?pr.price*(1-.008):pr.price*(1+.008))}</span></div>
        <div className="sc-r"><span>TP</span><span className="v cup">{fmtP(sig.side==='BUY'?pr.price*(1+.008*parseFloat(sig.rr)):pr.price*(1-.008*parseFloat(sig.rr)))}</span></div>
      </div>

      {/* Proof indicators */}
      <div className="sc-proof">
        {[['BB',sig.bb,'Breaker\nBlock'],['VOS',sig.vos,'Vol. of\nSpeed'],['Vol',sig.vol,'Volume\nHaut'],['RSI',sig.rsi,'RSI\nDiv.'],['BTC',sig.btcOk,'BTC\nAlignmt']].map(([l,v,title])=>(
          <div key={l} className="sp" title={title}>
            <div className={`sp-dot ${v?'sp-on':'sp-off'}`}>{v?'âœ“':l[0]}</div>
            <div className="sp-lbl">{l}</div>
          </div>
        ))}
      </div>

      <div className="sc-foot">
        <span className="sc-timer">â± {sig.validFor}s</span>
        <div style={{display:'flex',gap:'5px'}}>
          <button className="chart-btn" onClick={onChart}>ğŸ“ˆ</button>
          <button
            className={`exec-btn ${!botDemo&&apiOk?'exec-live':'exec-demo'}`}
            onClick={onExecute}
            title={botDemo?'Passer en mode RÃ©el':'ExÃ©cuter sur Binance'}>
            {botDemo?'ğŸ“‹ DÃ‰MO':'âš¡ BINANCE'}
          </button>
        </div>
      </div>
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   POSITION CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function PosCard({pos, prices, onChart}) {
  const cur    = prices[pos.pair]?.price||pos.entry;
  const dist   = Math.abs(pos.entry-pos.sl0);
  const pnlPct = pos.side==='BUY'?(cur-pos.entry)/pos.entry*100:(pos.entry-cur)/pos.entry*100;
  const pnl    = pnlPct/100*pos.riskAmt/0.008;
  const rr     = pos.rrR||0;
  return (
    <div className={`pc ${pos.side==='BUY'?'plong':'pshort'} fin`}>
      <div className="pc-head">
        <div className="flex g6">
          <span className={`sc-side ${pos.side==='BUY'?'sl':'ss'}`}>{pos.side==='BUY'?'L':'S'}</span>
          <span className="pc-pair">{pos.pair.replace('USDT','')}/USDT</span>
        </div>
        <span className="pc-pnl" style={{color:pnl>=0?'var(--up)':'var(--dn)'}}>{pnl>=0?'+':''}{pnl.toFixed(2)}$</span>
      </div>
      <div className="pc-body">
        <div className="pr"><span className="l">EntrÃ©e</span><span className="r mono">{fmtP(pos.entry)}</span></div>
        <div className="pr"><span className="l">Actuel</span><span className="r mono">{fmtP(cur)}</span></div>
        <div className="pr"><span className="l">SL{pos.trailActive?' ğŸ”’':''}</span><span className="r mono cdn">{fmtP(pos.sl)}</span></div>
        <div className="pr"><span className="l">TP</span><span className="r mono cup">{fmtP(pos.tp2)}</span></div>
        <div className="pr"><span className="l">RR</span><span className="r mono">1:{pos.rr}</span></div>
        <div className="rr-bar">
          <div className="rr-lbl">{rr.toFixed(1)}R en cours</div>
          <div className="rr-track">
            {[.5,1,1.5,2,3].map((r,i)=>(
              <div key={i} className={`rrs${rr>=r?' done':''}${r===1&&pos.trailActive?' be':''}`}/>
            ))}
          </div>
        </div>
      </div>
      <div className="pc-foot">
        {pos.demo?<span className="ptag pt-demo">DÃ‰MO</span>:<span className="ptag pt-real">RÃ‰EL</span>}
        {pos.trailActive&&<span className="ptag pt-trail">ğŸ”’ BE</span>}
        <button className="btn btn-out btn-sm" style={{marginLeft:'auto'}} onClick={onChart}>ğŸ“ˆ</button>
      </div>
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACCOUNT PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function AccountPage({user, balance, setBalance, stats, risk, setUser, onCopy, refLink}) {
  const [editBal, setEditBal] = useState(false);
  const [newBal,  setNewBal]  = useState(balance.toString());
  const db = () => lsG('ab19_udb', {});

  const leverageRec = balance>=1000?20:balance>=500?15:balance>=100?10:balance>=50?5:3;
  const memberSince = user.joinedAt ? new Date(user.joinedAt).toLocaleDateString('fr-FR') : 'â€”';
  const refCount = db()[user.email]?.refCount || user.refCount || 0;

  const saveBalance = () => {
    const v = parseFloat(newBal);
    if(isNaN(v)||v<1) return;
    setBalance(v); lsS('ab19_bal',v); setEditBal(false);
  };

  return (
    <div className="acc-grid">
      {/* Profile */}
      <div className="acc-card">
        <div className="acc-hd">ğŸ‘¤ Profil</div>
        <div className="acc-body">
          <div className="acc-av">{user.email[0].toUpperCase()}</div>
          <div style={{textAlign:'center',marginBottom:'12px'}}>
            <div className="bold f12">{user.email}</div>
            <div className="f9 tx2 mt4">Membre depuis {memberSince}</div>
            {user.isAdmin && <div className="f9" style={{color:'var(--purple)',marginTop:'4px'}}>âš™ Administrateur</div>}
          </div>
          <div className="sep"/>
          {[
            ['Balance',        `${balance.toFixed(2)} $`],
            ['Win Rate',       `${stats.wr}%`],
            ['Trades total',   stats.wins+stats.losses],
            ['Gagnants',       `${stats.wins} âœ…`],
            ['Perdants',       `${stats.losses} âŒ`],
            ['PnL total',      `${stats.pnl>=0?'+':''}${stats.pnl.toFixed(2)} $`],
            ['Risque/trade',   `${risk.toFixed(2)}%`],
            ['Parrainages',    `${refCount} utilisateurs`],
          ].map(([l,v])=>(
            <div key={l} className="arow"><span className="l">{l}</span><span className="r">{v}</span></div>
          ))}
          <div className="sep"/>
          {/* Balance editor */}
          {editBal ? (
            <div className="fld">
              <div className="flbl">Modifier le solde (min. 1$)</div>
              <div style={{display:'flex',gap:'7px'}}>
                <input className="inp" type="number" min="1" value={newBal}
                  onChange={e=>setNewBal(e.target.value)} style={{flex:1}}/>
                <button className="btn btn-up btn-sm" onClick={saveBalance}>OK</button>
                <button className="btn btn-out btn-sm" onClick={()=>setEditBal(false)}>âœ•</button>
              </div>
            </div>
          ) : (
            <button className="btn btn-out btn-full btn-sm mt8" onClick={()=>setEditBal(true)}>
              ğŸ’° Modifier le solde de test
            </button>
          )}
          <button className="btn btn-dn btn-full btn-sm mt8" onClick={()=>{lsS('ab19_user',null);setUser(null);}}>
            DÃ©connexion
          </button>
        </div>
      </div>

      {/* Referral */}
      <div className="acc-card">
        <div className="acc-hd">ğŸ”— Programme de Parrainage</div>
        <div className="acc-body">
          <div className="ref-box">
            <div className="f10 tx1 mb4">Votre code parrainage</div>
            <div className="ref-code-display" onClick={()=>onCopy(user.refCode,'Code copiÃ© !')}>
              {user.refCode || 'â€”'}
            </div>
            <div className="f9 tx2" style={{textAlign:'center',marginBottom:'8px'}}>Cliquez pour copier le code</div>
            <div className="ref-link" onClick={()=>onCopy(refLink,'Lien copiÃ© !')}>
              ğŸ”— {refLink}
            </div>
            <div className="f9 tx2" style={{textAlign:'center',marginTop:'5px'}}>Cliquez pour copier le lien</div>
          </div>
          <div className="ref-stats">
            <div className="ref-stat">
              <div className="ref-stat-v">{refCount}</div>
              <div className="ref-stat-l">ParrainÃ©s</div>
            </div>
            <div className="ref-stat">
              <div className="ref-stat-v">{user.refBy?'Oui':'Non'}</div>
              <div className="ref-stat-l">ParrainÃ© par</div>
            </div>
          </div>
          {user.refBy && <div className="hint" style={{textAlign:'center',marginTop:'8px'}}>InvitÃ© par : {user.refBy}</div>}
          <div className="soon-banner" style={{marginTop:'12px'}}>
            <div className="f10 tx1">ğŸ BientÃ´t : <b style={{color:'var(--gold)'}}>commission sur chaque parrainage</b> dans la version Premium</div>
          </div>
        </div>
      </div>

      {/* Levier recommandÃ© */}
      <div className="acc-card">
        <div className="acc-hd">âš¡ Levier RecommandÃ©</div>
        <div className="acc-body">
          <div style={{textAlign:'center',padding:'14px 0'}}>
            <div style={{fontSize:'44px',fontWeight:700,fontFamily:'JetBrains Mono,monospace',color:'var(--gold)'}}>{leverageRec}x</div>
            <div className="f10 tx2 mt4">BasÃ© sur votre solde actuel</div>
          </div>
          <div className="sep"/>
          {[
            ['â‰¥ 1 000 $','20x',balance>=1000],
            ['â‰¥ 500 $',  '15x',balance>=500&&balance<1000],
            ['â‰¥ 100 $',  '10x',balance>=100&&balance<500],
            ['â‰¥ 50 $',   '5x', balance>=50&&balance<100],
            ['< 50 $',   '3x', balance<50],
          ].map(([rng,lev,active])=>(
            <div key={rng} className="arow" style={{background:active?'rgba(240,185,11,.07)':'',borderRadius:'5px',padding:'4px 5px'}}>
              <span className="l f10" style={{color:active?'var(--gold)':'var(--tx2)'}}>{active?'â–¶ ':''}{rng}</span>
              <span className="r mono bold" style={{color:active?'var(--gold)':'var(--tx2)'}}>{lev}</span>
            </div>
          ))}
        </div>
      </div>

      {/* Features */}
      <div className="acc-card" style={{gridColumn:'1/-1'}}>
        <div className="acc-hd">â˜… FonctionnalitÃ©s</div>
        <div className="acc-body">
          <div className="feat-g">
            {[
              ['ğŸ¯','Trailing SL','Break-even auto Ã  RR1'],
              ['ğŸ“ˆ','Risk Scaling','+15% aprÃ¨s victoire'],
              ['ğŸ”','20 Paires','Scan marchÃ© complet'],
              ['ğŸ¤–','Bot RÃ©el','Ordres Binance Futures'],
              ['â‚¿','CorrÃ©lation BTC','Filtre de tendance'],
              ['â°','Sessions','Londres + New York'],
              ['ğŸ“Š','Graphiques','TradingView intÃ©grÃ©'],
              ['â­','4 Signaux','Score + 5 preuves'],
              ['ğŸ”—','Parrainage','Lien unique par compte'],
              ['ğŸ“§','Auth Email','VÃ©rification + reset'],
              ['ğŸ›¡ï¸','Disclaimer','Protection juridique'],
              ['ğŸ’','Premium Signals','BientÃ´t disponible',true],
            ].map(([ic,nm,ds,coming])=>(
              <div key={nm} className={`feat-i${coming?' coming':''}`}>
                <div className="fi-icon">{ic}</div>
                <div className="fi-nm">{nm}</div>
                <div className="fi-ds">{ds}</div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function AdminPage({risk,setRisk,leverage,setLeverage,balance,setBalance,scoreMin,setScoreMin,totalUsers,stats,log,toast}) {
  const [globalRisk,   setGlobalRisk]   = useState(risk);
  const [globalLev,    setGlobalLev]    = useState(leverage);
  const [globalScore,  setGlobalScore]  = useState(scoreMin);
  const [testBalance,  setTestBalance]  = useState(balance.toString());

  const apply = () => {
    setRisk(globalRisk); lsS('ab19_risk', globalRisk);
    setLeverage(globalLev); lsS('ab19_lev', globalLev);
    setScoreMin(globalScore);
    const b=parseFloat(testBalance); if(b>=1){setBalance(b);lsS('ab19_bal',b);}
    log(`âš™ Admin: Risque=${globalRisk}% Lev=${globalLev}x Score>=${globalScore}`,'wrn');
    toast('ParamÃ¨tres admin appliquÃ©s','success');
  };

  const db = lsG('ab19_udb',{});
  const users = Object.values(db);

  return (
    <div>
      <div className="adm-stats">
        <div className="adm-stat">
          <div className="adm-stat-v">{users.length}</div>
          <div className="adm-stat-l">Comptes crÃ©Ã©s</div>
        </div>
        <div className="adm-stat">
          <div className="adm-stat-v">{stats.wins+stats.losses}</div>
          <div className="adm-stat-l">Trades exÃ©cutÃ©s</div>
        </div>
        <div className="adm-stat">
          <div className="adm-stat-v" style={{color:stats.pnl>=0?'var(--up)':'var(--dn)'}}>{stats.pnl>=0?'+':''}{stats.pnl.toFixed(0)}$</div>
          <div className="adm-stat-l">PnL session</div>
        </div>
      </div>

      <div className="acc-grid">
        <div className="acc-card">
          <div className="acc-hd">âš™ ParamÃ¨tres Globaux</div>
          <div className="acc-body">
            <div className="fld">
              <div className="flbl">Risque par trade (max 10%)</div>
              <div className="flex g8 mb4">
                <span className="f11 mono cgold">{globalRisk.toFixed(1)}%</span>
              </div>
              <input type="range" min="0.1" max="10" step="0.1" value={globalRisk}
                onChange={e=>setGlobalRisk(+e.target.value)} className="slider"/>
              <div className="risk-presets" style={{marginTop:'8px'}}>
                {[[0.5,'TrÃ¨s prudent'],[1,'Prudent'],[2,'Normal'],[4,'Conservateur'],[8,'Agressif'],[10,'ExtrÃªme']].map(([v,l])=>(
                  <button key={l} className={`risk-btn${globalRisk===v?' act':''}`}
                    onClick={()=>setGlobalRisk(v)}>
                    {v}%<br/><span style={{fontSize:'7px',fontWeight:400}}>{l}</span>
                  </button>
                ))}
              </div>
            </div>
            <div className="fld">
              <div className="flbl">Levier (info affichage)</div>
              <div className="flex g8 mb4"><span className="f11 mono cgold">{globalLev}x</span></div>
              <input type="range" min="1" max="50" step="1" value={globalLev}
                onChange={e=>setGlobalLev(+e.target.value)} className="slider"/>
              <div className="flex jb f9 tx2 mt4"><span>1x sÃ©curisÃ©</span><span>50x extrÃªme</span></div>
            </div>
            <div className="fld">
              <div className="flbl">Score minimum signaux</div>
              <div className="flex g8 mb4"><span className="f11 mono cgold">{globalScore}/100</span></div>
              <input type="range" min="60" max="90" step="1" value={globalScore}
                onChange={e=>setGlobalScore(+e.target.value)} className="slider"/>
            </div>
            <div className="fld">
              <div className="flbl">Solde de test (min. 1$)</div>
              <input className="inp" type="number" min="1" value={testBalance}
                onChange={e=>setTestBalance(e.target.value)}/>
            </div>
            <button className="btn btn-gold btn-full" onClick={apply}>âœ… Appliquer les paramÃ¨tres</button>
          </div>
        </div>

        <div className="acc-card">
          <div className="acc-hd">ğŸ‘¥ Utilisateurs ({users.length})</div>
          <div className="acc-body" style={{maxHeight:'380px',overflowY:'auto'}}>
            {users.length===0 ? <div className="nodata">Aucun compte</div> : users.map(u=>(
              <div key={u.email} className="adm-row">
                <div>
                  <div className="f11 bold">{u.email.split('@')[0]}</div>
                  <div className="f9 tx2">{u.email} {u.isAdmin?'âš™':''} {!u.verified?'(non vÃ©rifiÃ©)':''}</div>
                </div>
                <div style={{textAlign:'right'}}>
                  <div className="f10 cgold mono">{u.refCode}</div>
                  <div className="f9 tx2">{u.refCount||0} parr.</div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
